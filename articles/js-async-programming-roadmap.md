---
title: "JSã®éåŒæœŸå‡¦ç†ã‚’ç†è§£ã™ã‚‹ãŸã‚ã«å¿…è¦ã ã£ãŸçŸ¥è­˜ã¨å­¦ç¿’ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—"
emoji: "ğŸ¦„"
type: "idea"
topics: [javascript, éåŒæœŸå‡¦ç†, ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—]
published: true
date: 2022-04-08
url: "https://zenn.dev/estra/articles/js-async-programming-roadmap"
aliases: [è¨˜äº‹_JSã®éåŒæœŸå‡¦ç†ã‚’ç†è§£ã™ã‚‹ãŸã‚ã«å¿…è¦ã ã£ãŸçŸ¥è­˜ã¨å­¦ç¿’ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—]
tags: [" #type/zenn #JavaScript/async  "]
---

## ã¯ã˜ã‚ã«
JavaScript ã®éåŒæœŸå‡¦ç†ã‚’å­¦ç¿’ã—ã¦ã¿ã¦ã€Œã‚ã‚‹ç¨‹åº¦è‡ªä¿¡ã‚’æŒã£ã¦ç†è§£ã§ããŸã¨è¨€ãˆã‚‹ã€çŠ¶æ…‹ã«åˆ°é”ã—ãŸã®ã§ã€ãã®æ„Ÿæƒ³ã¨ã€ã¾ã¨ã‚ã®å­¦ç¿’ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã¨ãã®ä¸­ã§ã©ã®ã‚ˆã†ãªçŸ¥è­˜ãŒå¿…è¦ã«ãªã‚‹ã‹ã‚’ç´¹ä»‹ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

ã“ã®è¨˜äº‹è‡ªä½“ã¯å¾Œã‹ã‚‰åˆ¥ã®è¨˜äº‹ã§å‚ç…§ã™ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€~~å…·ä½“çš„ãªè©±ã®ç„¡ã„æ°—è»½ãªå†…å®¹ãªã®ã§~~ã€æµã—èª­ã¿ç¨‹åº¦ã«è¦‹ã¦ã‚‚ã‚‰ãˆã‚‹ã¨ã„ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“(éåŒæœŸå‡¦ç†ã®å…·ä½“çš„ãªè©±ã‚‚å°‘ã—ç››ã‚Šè¾¼ã¿ã¾ã—ãŸ)ã€‚ã‚ã¨ã¯ã€è‡ªåˆ†ãŒå®Ÿéš›ã«å­¦ç¿’ã—ã¦ããŸé“ç­‹ã«åŸºã¥ã„ã¦ã„ã‚‹ã®ã§ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã¨ã—ã¦å‚è€ƒã«ã—ã¦ã‚‚ã‚‰ã£ãŸã‚Šã€ä½¿ãˆã‚‹ãƒªã‚½ãƒ¼ã‚¹ãªã©ã®æƒ…å ±ãŒå…±æœ‰ã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ã‚‚ã—ãã¯ã€ŒJavaScript åˆå¿ƒè€…ãŒéåŒæœŸå‡¦ç†ã‚’ç†è§£ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã¾ã§ã€ã¨ã„ã†ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã§ï¼‘ã¤ã®ã‚µãƒ³ãƒ—ãƒ«ã¨ã—ã¦è¦‹ã¦ã„ãŸã ã‘ã‚‹ã¨ã„ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

å…·ä½“çš„ãªéåŒæœŸå‡¦ç†ã«ã¤ã„ã¦ã®çŸ¥è¦‹ã¯ã„ãšã‚Œã¡ã‚‡ã“ã¡ã‚‡ã“ã‚¢ã‚¦ãƒˆãƒ—ãƒƒãƒˆã¨ã—ã¦æ›¸ã„ã¦ã„ã“ã†ã‹ãªã¨æ€ã„ã¾ã™ã€‚ã“ã®è¨˜äº‹è‡ªä½“ã«é–“é•ã„ã‚„ä¿®æ­£ã€æ›´æ–°ãŒã‚ã‚Œã°é©å®œä¿®æ­£ã—ã¦ã„ãã¾ã™ã€‚

:::details ChangeLog
- 2022-04-13
  - ã€Œè¿½è¨˜: ECMAScript ã®ã¿ã«æ³¨ç›®ã—ã¦ã‚‚ç†è§£ã§ããªã„ã€ã®é …ç›®ã‚’è¿½åŠ 
  - Web APIs / Runtime APIs ã®é …ç›®ãŒæŠœã‘ã¦ã„ãŸã®ã§è¿½åŠ 
  - await å¼ã®è£œè¶³ã‚’è¿½åŠ 
- 2022-04-14
  - ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã®è£œè¶³ã‚’è¿½åŠ 
  - ã€Œç’°å¢ƒã€ã¨ã€ŒéåŒæœŸå‡¦ç†ã®ä»•çµ„ã¿ã€ã«é–¢ã—ã¦ã®ã¾ã¨ã‚ã‚’è¿½è¨˜
  - Web Workers ã«ã¤ã„ã¦ã®è¨˜è¿°ã‚’è¿½åŠ 
:::

## éåŒæœŸå‡¦ç†ã®æ„Ÿæƒ³
ã¾ãšéåŒæœŸå‡¦ç†ã«ã¤ã„ã¦å­¦ã‚“ã§ã¿ã¦ã€ã€Œã‹ãªã‚Šé›£ã—ãã€å­¦ç¿’ã«æ™‚é–“ãŒã‹ã‹ã‚‹ã€ã¨ã„ã†å°è±¡ã‚’å—ã‘ã¾ã—ãŸã€‚ã‚¤ãƒ¡ãƒ¼ã‚¸ã¨ã—ã¦ã¯**å­¦ç¿’å‰äºˆæƒ³æ™‚ã®ï¼“å€**ã¯é›£ã—ã„ã§ã™ã€‚

å…¨ä½“ã¨ã—ã¦ã¯ã€éåŒæœŸå‡¦ç†ã®"åˆ¶å¾¡ã®æµã‚Œ"ãŒæ´ã¿ã¥ã‚‰ãã€ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ä½•ãŒèµ·ã“ã£ã¦ã„ã‚‹ã‹ã‚’æŠŠæ¡ã—ãªã„ã¨è‡ªåˆ†ã§æ›¸ã“ã†ã¨ã—ãŸã¨ãã«ã¾ã£ãŸãäºˆæ¸¬ãŒã§ãã¾ã›ã‚“ã€‚éåŒæœŸå‡¦ç†ã®æµã‚Œè‡ªä½“ãŒæ´ã¿ã¥ã‚‰ã„ã®ã§ã€åŒæœŸå‡¦ç†ã¨éåŒæœŸå‡¦ç†ãŒæ··ã˜ã£ã¦ã„ã‚‹ã¨ãã¯æ›´ã«äºˆæ¸¬ã—ãšã‚‰ããªã‚Šã¾ã™ã€‚åŠ ãˆã¦ã€éåŒæœŸå‡¦ç†ã«ã¯ç¨®é¡ãŒã‚ã‚Šã€**ãã®ç¨®é¡ã”ã¨ã«å®Ÿè¡Œã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒå®Ÿã¯ç•°ãªã‚‹**ã®ã§ã€ãã‚Œã‚‰ãŒå…¥ã‚Šäº¤ã˜ã‚‹ã“ã¨ã§æ›´ã«äºˆæ¸¬ãŒé›£ã—ããªã£ã¦ã„ã¾ã™ã€‚

ãã‚‚ãã‚‚ã€ã€ŒåŒæœŸã€ã¨ã€ŒéåŒæœŸã€ã¨ã„ã†è¨€è‘‰ã«é¨™ã•ã‚Œãã†ã«ãªã‚Šã¾ã™ã€‚

å±€æ‰€çš„ã«ã¯ Promise ã®æ¦‚å¿µãŒæ´ã¿ã¥ã‚‰ãã€ Promise ãƒã‚§ãƒ¼ãƒ³ã§ã¯ç‰¹ã«ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ãŒã‚­ãƒ¼ã«ãªã‚‹ã®ã§ã™ãŒã€ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å­¦ã¶ã“ã¨ã§ã‚ˆã†ã‚„ãä½¿ãˆã‚‹ãƒ¬ãƒ™ãƒ«ã®ç†è§£ã«åˆ°é”ã§ããŸã¨æ„Ÿã˜ã¾ã—ãŸã€‚

ã¾ãŸã€async/await ã«ã¤ã„ã¦ã‚‚ã€ãã‚‚ãã‚‚ Promise ãƒã‚§ãƒ¼ãƒ³ã‚’ç†è§£ã—ã¦ã„ãªã„ã¨ä½¿ã„ç‰©ã«ãªã‚‰ãšã€**ãã®åå‰ã‹ã‚‰æ˜ã‚‰ã‹ã«éåŒæœŸå‡¦ç†ã®ä¸»å½¹ãªã®ã§ã¯ãªã„ã‹ã¨æ„Ÿã˜ã‚‰ã‚Œã‚‹**ä¸€æ–¹ã§ã€å®Ÿä½“ã¯ç•°ãªã‚‹ã®ã§ã€Œã“ã‚Œã¯é¨™ã•ã‚Œã‚‹ãªã€ã¨ã„ã†å°è±¡ã‚’å—ã‘ã¾ã—ãŸã€‚async/await ã¨ Promise ã®é–¢ä¿‚ãŒæŠŠæ¡ã§ãã¦ã„ãªã„ã¨è‡´å‘½çš„ã«æ··ä¹±ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚éåŒæœŸé–¢æ•°ãŒ Promise ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¿”ã™ã“ã¨ã€await å¼ãŒ Promise ã®è©•ä¾¡å€¤ã‚’è¿”ã—ã€**éåŒæœŸé–¢æ•°å†…ã®å®Ÿè¡Œãƒ•ãƒ­ãƒ¼ã‚’åˆ†å‰²ã™ã‚‹ã“ã¨**ã€åŒæœŸå‡¦ç†ã¨éåŒæœŸå‡¦ç†ã‚’è¡Œã£ãŸã‚ŠããŸã‚Šã™ã‚‹ã“ã¨ã€ãã‚Œã¨**é€æ¬¡çš„ã«å‡¦ç†ã‚’è¡Œã†**ã“ã¨ãªã©ã¨ã®é•ã„ãªã©ã€ã“ã“ã‚‰ã¸ã‚“ã§ã¯ãƒˆãƒ©ãƒƒãƒ—ã¨ãªã‚‹ãƒã‚¤ãƒ³ãƒˆãŒã„ãã¤ã‚‚ã‚ã‚Šã¾ã™ã€‚

ã€ŒPromise ã¨ã‹ await ã¨ã‹ã£ã¦ã¯å®Ÿã¯éåŒæœŸå‡¦ç†ã§ã¯ãªã„ã®ã§ã¯ï¼ŸğŸ˜µâ€ğŸ’«ã€ã¨ã„ã†ã‚ˆã†ãªç–‘å•ãŒé€”ä¸­æ¹§ãä¸ŠãŒã£ãŸã‚Šã‚‚ã—ã¾ã™ãŒã€å€‹äººçš„ã«ã¯ãã®ç–‘å•ã‚’è§£æ¶ˆã™ã‚‹ã¨ã“ã‚ãŒã‚¿ãƒ¼ãƒ‹ãƒ³ã‚°ãƒã‚¤ãƒ³ãƒˆã«ãªã‚‹ãªã¨æ„Ÿã˜ã¾ã—ãŸã€‚

åŸºæœ¬çš„ã«ã¯ã€è§£èª¬è¨˜äº‹ã‚’èª­ã‚“ã§ç†è§£ã—ãŸã¤ã‚‚ã‚Šã«ãªã£ã¦ã‚‚ã€åˆ¶å¾¡ã®æµã‚Œã‚’ã‚³ãƒ¼ãƒ‰ã‹ã‚‰æƒ³åƒã—ã¦ã¿ãŸã‚Šã€å®Ÿéš›ã«æ‰‹ã‚’å‹•ã‹ã•ãªã„ã¨ç†è§£ã¯ã‹ãªã‚Šå³ã—ã„ã¨æ„Ÿã˜ã¾ã—ãŸã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã ã‘ã§ç†è§£ã™ã‚‹ã®ã¯ã‹ãªã‚Šå›°é›£ãªã®ã§æ˜ åƒã‚„å¯è¦–åŒ–ãƒ„ãƒ¼ãƒ«ã‚’ä½¿ã†ã“ã¨ã§æ¯”è¼ƒçš„ã¤ã‹ã¿ã‚„ã™ããªã‚Šã€å®Ÿéš›ã«ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§å®Ÿè¡Œã—ã¦ã¿ã‚‹ã“ã¨ã§ç†è§£ã§ãã€ã ã‚“ã ã‚“ã¨åˆ¶å¾¡ã®æµã‚ŒãŒæ¨æ¸¬ã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ãã¾ã™ã€‚

## å­¦ç¿’ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—
éåŒæœŸå‡¦ç†ã¨ã„ã†ã‚«ãƒ†ã‚´ãƒªã«ã¤ã„ã¦ã¯(ãã‚‚ãã‚‚ JavaScript ã¯)ã€å¤šãã®æœ‰ç”¨ãªãƒªã‚½ãƒ¼ã‚¹ãŒã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã§å…¬é–‹ã•ã‚Œã¦ã„ã‚‹ã®ã§æœ€å¤§é™ãã‚Œã‚‰ã‚’æ´»ç”¨ã—ã¦å­¦ç¿’ã‚’ã™ã™ã‚ã¦ã„ãã¾ã™ã€‚

ã¾ãšã¯éåŒæœŸå‡¦ç†ã®å‰ã«å¤–ã™ã“ã¨ã®ã§ããªã„å¿…è¦ãªçŸ¥è­˜ã¨ã—ã¦ä»¥ä¸‹ã®äº‹æŸ„ã‚’çŸ¥ã£ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚
- å¼(Expression)
- é–¢æ•°å¼
- ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°
- ç„¡åé–¢æ•°
- ã‚¢ãƒ­ãƒ¼é–¢æ•°ã¨çœç•¥å½¢
- å³æ™‚å®Ÿè¡Œé–¢æ•°

ã“ã®ã‚ãŸã‚Šã®çŸ¥è­˜ãŒä»–ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚„è§£èª¬ã‚’è¦‹ã‚‹æ™‚ã«**æš—é»™çš„ã«å¿…è¦**ã«ãªã£ã¦ãã¾ã™ã€‚ç‰¹ã«ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã¨ã‚¢ãƒ­ãƒ¼é–¢æ•°ã¯é‡è¦ã§ã™ã€‚async function ã‚’ä½¿ç”¨ã™ã‚‹éš›ã«ã¯å³æ™‚å®Ÿè¡Œé–¢æ•°ãŒã‚ˆãã§ã¦ãã¾ã™ã€‚await ã‚’ç†è§£ã™ã‚‹éš›ã«ã‚‚å¼ã®æ¦‚å¿µãŒã‚­ãƒ¼ã¨ãªã‚‹ã®ã§é‡è¦ã§ã™ã€‚éåŒæœŸå‡¦ç†ã¯ JavaScript ã®ä¸­ã§ã‚‚æ¯”è¼ƒçš„é«˜åº¦ãªå†…å®¹ã§ã‚ã‚Šã€ã“ã†ã„ã£ãŸçŸ¥è­˜ãŒå‰æã¨ã•ã‚ŒãŸçŠ¶æ…‹ã§è©±ãŒé€²ã‚“ã§ã„ãã¾ã™ã®ã§ç†è§£ã—ã¦ãŠãã®ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

ä¸å®‰ãŒã‚ã‚‹å ´åˆã«ã¯ã€azu æ°ã® "JavaScript Primer" ã§ã€Œå¼ã¨æ–‡ã€ã¨ã€Œé–¢æ•°ã€ã®é …ç›®ã‚’èª­ã‚“ã§ãŠãã®ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚

https://jsprimer.net/basic/statement-expression/

https://jsprimer.net/basic/function-declaration/

ä»¥ä¸ŠãŒç†è§£ã§ãã¦ã„ã‚‹ãªã‚‰ã€ã¾ãšã€ŒéåŒæœŸå‡¦ç†ã®åŸºç¤ã€ã‚’ä¸€ã‹ã‚‰å­¦ã¶ãŸã‚ã« "JavaScript Primer" ã®æ¬¡ã®é …ç›®ã‚’èª­ã¿ã™ã™ã‚ã¾ã—ã‚‡ã†(ãŸã ã—ã€ã„ããªã‚Šã™ã¹ã¦ç†è§£ã—ã‚ˆã†ã¨ã™ã‚‹ã®ã¯å›°é›£ãªã®ã§ã‚ã‚‹ç¨‹åº¦ã®ç†è§£åº¦ã§æœ€å¾Œã¾ã§é€²ã‚ã¦ã„ãã€ç´°ã‹ã„ç‚¹ã«ã¤ã„ã¦ã¯å¾Œã‹ã‚‰å‚ç…§ã—ã¦ã„ãå½¢ãŒã‚ˆã„ã¨æ€ã„ã¾ã™)ã€‚"JavaScript Primer" ã§ã¯ã€ã€ŒJavaScript ã®éåŒæœŸå‡¦ç†ã®æ­´å²çš„ãªç™ºå±•ã€ãŒä¿¯ç°ã§ãã€ã‚¨ãƒ©ãƒ¼ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ â†’ Promise â†’ async/await ã¨ã„ã†ã‚ˆã†ã«é †ã‚’è¿½ã£ã¦éåŒæœŸå‡¦ç†ã®å¿…è¦ãªçŸ¥è­˜ãŒä¸€é€šã‚Šå­¦ç¿’ã§ãã¾ã™ã€‚

https://jsprimer.net/basic/async/

https://jsprimer.net/use-case/ajaxapp/

:::message
ã¡ãªã¿ã«ã€è‡ªåˆ†ãŒéåŒæœŸå‡¦ç†ã‚’ã€Œæœ¬æ ¼çš„ã«ã€å­¦ç¿’ã—ã¯ã˜ã‚ãŸã®ã¯ JavaScript Primer ã‚’ã»ã¼èª­ç ´ã—ãŸå¾Œã§ã‚ã‚Šã€ä¸Šã§æŒ™ã’ãŸå‰æã¨ãªã‚‹çŸ¥è­˜ã‚„éåŒæœŸå‡¦ç†ã®å°å…¥ã¯ JavaScript Primer ã‚’èª­ã‚“ã§æ—¢ã«å®Œäº†æ¸ˆã¿ã¨ã„ã†å‰æãŒã‚ã‚‹ã®ã§æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

ã“ã‚Œä»¥é™ã®è©±ã¯ã€ãã†ã„ã£ãŸåŸºç¤ã«ã¤ã„ã¦ã¯ç†è§£ã§ããŸãŒ(ç†è§£ã§ããŸã¨æ€ã£ã¦ã„ãŸãŒ)ã€å®Ÿéš›ã«éåŒæœŸå‡¦ç†ã‚’æ›¸ã„ãŸã‚Šã€äººã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’èª­ã‚“ã ã‚Šã—ã‚ˆã†ã¨ã—ãŸéš›ã«ã€Œ**æ›¸ã‘ãªã„ãƒ»èª­ã‚ãªã„ãƒ»åˆ†ã‹ã‚‰ãªã„**ã€ã¨ã„ã†çŠ¶æ³ã«é™¥ã£ãŸãŸã‚ã«ã•ã‚‰ãªã‚‹ç†è§£ã‚’æ±‚ã‚ã¦å­¦ç¿’ã—ãŸå†…å®¹ã¨ãªã‚Šã¾ã™ã€‚
:::

ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’èª­ã¿çµ‚ãˆã¦ã€Œå®Œå…¨ã«ç†è§£ã—ãŸã€ã¨æ€ã£ã¦ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿéš›ã«æ›¸ã“ã†ã¨ã—ã¦ã‚‚(éåŒæœŸå‡¦ç†ã®åˆ¶å¾¡ãŒäºˆæ¸¬ã§ããš)ã‹ã‘ãªã„ã“ã¨ã«æ°—ã¥ãã®ã§æ¬¡ã«éåŒæœŸå‡¦ç†ã®ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã®å‹•ãã‚’å­¦ç¿’ã—ã¾ã™ã€‚

ã¾ãšã¯éåŒæœŸå‡¦ç†ã®æµã‚Œã‚’ç†è§£ã™ã‚‹ã®ã«å¿…è¦ãªç”¨èªçŸ¥è­˜ã‚’ç¢ºèªã—ã¦ãŠãã¾ã™ã€‚
- concurrent(ä¸¦è¡Œ)/parallel(ä¸¦åˆ—)
- asynchronous(éåŒæœŸ)/synchronous(åŒæœŸ)
- sequential(é€æ¬¡çš„)
- blocking/non-blocking
- single-thread/multi-thread
- Node.js ã‚„ V8 engine ã«ã¤ã„ã¦ã®åŸºç¤çŸ¥è­˜

ä¸Šè¨˜ã®å˜èªã«ã¤ã„ã¦ã¯ã€ã“ã“ã¾ã§ãã‚Œã°ã‚ã‚‹ç¨‹åº¦ã®è§£åƒåº¦ã§ç†è§£ã§ãã¦ã„ã‚‹ã¯ãšã§ã™ãŒã€ã„ã‚ã‚“ãªè¨˜äº‹ã‚’è¦‹ã¦ã‚‚ã“ã“ã‚‰ã¸ã‚“ã®è¨€è‘‰ã£ã¦å‰²ã¨å®šç¾©ãŒã‚ã„ã¾ã„ãªã®ã§ã€ãªã‚‹ã¹ãè§£åƒåº¦ã‚’ã‚ã’ã¦ãŠãã¨ã‚ˆã„ã¨æ€ã„ã¾ã™ã€‚å¤šåˆ† "synchronous" ã«æŒ¯ã‚Šå›ã•ã‚Œã‚‹ã®ã§ã€"sequential" ã¨ "blocking" ã‚’æ„è­˜ã§ãã‚‹ã‚ˆã†ã«æ³¨è¦–ã—ã¦ãŠãã¨è‰¯ã„ã¨æ€ã„ã¾ã™(è‡ªåˆ†ã¯é€”ä¸­ã§ã€ŒåŒæœŸçš„ã€ã¨ã„ã†æ¦‚å¿µãŒåˆ†ã‹ã‚‰ãªããªã‚Šéå¸¸ã«æ··ä¹±ã—ã¾ã—ãŸ)ã€‚

blocking/non-blocking ã«ã¤ã„ã¦ã¯ Node.js å…¬å¼ã‚µã‚¤ãƒˆã®æ¬¡ã®ãƒšãƒ¼ã‚¸ã‚’ä¸€èª­ã—ã¦ãŠãã¨ç†è§£ãŒé€²ã¿ã¾ã™ã€‚

https://nodejs.org/ja/docs/guides/blocking-vs-non-blocking/

blocking ã®ä¾‹ã¨ã—ã¦ Node.js ã®åŒæœŸ API (Synchronous API) ã«ã¤ã„ã¦ã‚‚çŸ¥ã£ã¦ãŠãã¨ã‚ˆã„ã§ã™ã€‚åŒæœŸ API ã¯ Node.js ã® Event loop ã¨å¾Œç¶šã® JavaScript ã®å‡¦ç†ã‚’ã€ãã® API ã®å‡¦ç†ãŒå®Œäº†ã™ã‚‹ã¾ã§ãƒ–ãƒ­ãƒƒã‚¯ã—ã¾ã™ã€‚ã“ã‚Œã‚‰ã® API ã¯ `readFileSync` ãªã©åå‰ã®æœ€å¾ŒãŒ `Sync` ã§çµ‚ã‚ã‚Šã¾ã™ã€‚

æ¬¡ã«éåŒæœŸå‡¦ç†ã®æµã‚Œã‚’äºˆæ¸¬ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ãŸã‚å¿…è¦ãªçŸ¥è­˜ã¨é“å…·ã‚’ç²å¾—ã—ã¾ã™ã€‚
- Event Loop
- Call Stack
- Heap
- **Web APIs** / Runtime APIs
- Microtask ã¨ Microtask Queue
- Macrotask ã¨ Macrotask Queue

ã“ã‚Œã‚‰ã®ç”¨èªã¯éåŒæœŸå‡¦ç†ã®ç¨®é¡ã‚’èªè­˜ã—ã¦ã€ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã®æµã‚Œã‚’ã‚ã‚‹ç¨‹åº¦ã®è§£åƒåº¦ã§ç†è§£ã™ã‚‹ã®ã«å¿…è¦ã«ãªã£ã¦ãã¾ã™ã€‚éåŒæœŸå‡¦ç†ã®æµã‚Œ(å®Ÿè¡Œé †ç•ª)ã‚’æŠŠæ¡ãƒ»äºˆæ¸¬ã™ã‚‹ãŸã‚ã«ã¯å¿…ãšç†è§£ã—ãŸã»ã†ãŒã‚ˆã„ã§ã™ã€‚ã“ã‚Œã‚‰ã®ã‚¢ã‚¤ãƒ†ãƒ ç„¡ã—ã§ã¯é€²ã‚€ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚

ã¾ãšã€Call Stack ã¨ Event Loop ã‚’ç†è§£ã™ã‚‹ãŸã‚ã« JSConf EU ã§ã® Philip Roberts æ°ã®è¬›æ¼”å‹•ç”»ã€ŒWhat the heck is the event loop anyway?ã€ã‚’è¦‹ã‚‹ã“ã¨ã‚’å¼·ãã‚ªã‚¹ã‚¹ãƒ¡ã—ã¾ã™ã€‚
@[youtube](8aGhZQkoFbQ)

ã“ã®å‹•ç”»ã¯è‰²ã€…ãªäººãŒã‚ªã‚¹ã‚¹ãƒ¡ã—ãŸã‚Šã€å¤šãã®è¨˜äº‹ã§å¼•ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚éå¸¸ã«åˆ†ã‹ã‚Šã‚„ã™ãèª¬æ˜ã•ã‚Œã¦ãŠã‚Šã€éåŒæœŸå‡¦ç†ã®ç‰‡æ–¹(Macrotask)ã‚’ç†è§£ã™ã‚‹ã®ã«å½¹ç«‹ã¡ã¾ã™ã€‚2014 å¹´ã®å‹•ç”»ã§ã™ãŒã€JSConf ã®å‹•ç”»ã¯ä»–ã«ã‚‚ã„ãã¤ã‹è¦‹ã¾ã—ãŸãŒã€ã“ã®å‹•ç”»ä»¥ä¸Šã«åˆ†ã‹ã‚Šã‚„ã™ãèª¬æ˜ã—ã¦ã„ã‚‹ã‚‚ã®ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

:::message
Chrome ãªã©ã®ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã¨ Node.js ã‚„ Deno ã®ç’°å¢ƒã§ã¯ JavaScript ã‚¨ãƒ³ã‚¸ãƒ³ã¨ã—ã¦åŒã˜ V8 ã‚¨ãƒ³ã‚¸ãƒ³ã‚’æ¡ç”¨ã—ã¦ã¾ã™ãŒã€Event Loop ã®å®Ÿè£…ã¯ãã‚Œãã‚Œé•ã„ã¾ã™ã€‚
- [Blink](https://www.chromium.org/blink/) (Chrome): Rendering engine
- [Tokio](https://tokio.rs) (Deno) : an asynchronous Rust runtime 
- [libuv](https://libuv.org) (Node.js) : a multi-platform support library with a focus on asynchronous I/O

V8 ã‚¨ãƒ³ã‚¸ãƒ³ãŒæ‹…å½“ã—ã¦ã„ã‚‹ã®ã¯ã€Heap ã¨ Call Stack ã§ã™ã€‚V8 ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã«ã¯ setTimeout ã‚„ DOMã€HTTP request ã¨ã„ã£ãŸ Web APIs ã¯å«ã¾ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

ä¸Šè¨˜ã®å‹•ç”»ã§è§£èª¬ã•ã‚Œã¦ã„ã‚‹ã®ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã§ã® Event Loop ã§ã™ã€‚Promise ãƒã‚§ãƒ¼ãƒ³ã‚„ async/await ã¨ã„ã£ãŸè¨€èªã¨ã—ã¦ã®éåŒæœŸå‡¦ç†ã‚’ç†è§£ã™ã‚‹ãƒ¬ãƒ™ãƒ«ã§ã®æŠ½è±¡åŒ–ãªã‚‰ã€Node.js ã§ã‚‚ Deno ã§ã‚‚åŒã˜ã‚ˆã†ã«è€ƒãˆã¦å¤§ä¸ˆå¤«ã§ã™(ã‚‚ã¡ã‚ã‚“é–‹ç™ºãƒ¬ãƒ™ãƒ«ã§å¿…è¦ãªã‚‰ I/O ã¨ã‹ã‚¿ã‚¤ãƒãƒ¼ã®æŒ¯ã‚‹èˆã„ã¯é•ã†å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§å…·ä½“çš„ã«çŸ¥ã‚‹å¿…è¦ã¯ã‚ã‚‹ã¨æ€ã„ã¾ã™ãŒ)ã€‚ãŸã ã—ã€Web APIs ã®éƒ¨åˆ†ã¯ãƒ–ãƒ©ã‚¦ã‚¶ç‰¹æœ‰ã®ã‚‚ã®ãªã®ã§ã€Node.js ã‚„ Deno ã§ã¯ãã‚Œã«å¯¾å¿œã™ã‚‹ã‚‚ã®ã¨ã—ã¦ Runtime APIs ã§ç½®ãæ›ãˆã¦è€ƒãˆã¾ã™ã€‚
:::

å‹•ç”»ã§æ¦‚è¦ã‚’ç†è§£ã—ãŸã‚‰åŒæ°ãŒé–‹ç™ºã—ãŸ JavaScript ã®å¯è¦–åŒ–ãƒ„ãƒ¼ãƒ«ã§ã‚ã‚‹ "Loupe" ã§å®Ÿéš›ã« `setTimeout()` é–¢æ•°ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚„ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãªã©ãŒã©ã®ã‚ˆã†ã«å‹•ãã‹å®Ÿé¨“ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

http://latentflip.com/loupe/

![js loupe image](/images/js-async/img_loupe-js-async.jpg)

Loupe ã§ã¯ï¼’ç¨®é¡ã‚ã‚‹éåŒæœŸå‡¦ç†ã®ç¨®é¡ã®å†…ã®ï¼‘ã¤(Macrotask: ãƒã‚¯ãƒ­ã‚¿ã‚¹ã‚¯)ã—ã‹ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ã®ã§ã€æ¬¡ã« Github ç¤¾ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã§ã‚ã‚‹ Andrew Dillon æ°ãŒé–‹ç™ºã—ãŸ "JavaScript Visualizer 9000" ã‚’ä½¿ç”¨ã—ã¦ Promise é–¢é€£ã®éåŒæœŸå‡¦ç†(Microtask: ãƒã‚¤ã‚¯ãƒ­ã‚¿ã‚¹ã‚¯)ã‚’ç†è§£ã™ã‚‹ãŸã‚ã«ä½¿ç”¨ã—ã¾ã™ã€‚

https://www.jsv9000.app

JavaScript Visualizer 9000 ã§ã¯ã‚µãƒ³ãƒ—ãƒ«ãŒã„ãã¤ã‚‚ç”¨æ„ã•ã‚Œã¦ãŠã‚Šã€ãã‚Œã‚‰ã‚’ç†è§£ã™ã‚‹ã ã‘ã§ã‚‚éå¸¸ã«æœ‰ç”¨ã§ã™ã€‚äºŒç¨®é¡ã®éåŒæœŸå‡¦ç†ã«ã¤ã„ã¦ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã®ã§è‡ªåˆ†ãŒæ›¸ã„ã¦ã¿ãŸéåŒæœŸå‡¦ç†ã‚’å®Ÿéš›ã«ã“ã®ã‚¢ãƒ—ãƒªã§å®Ÿè¡Œã—ã¦ã¿ã¦éåŒæœŸå‡¦ç†ã®æµã‚ŒãŒäºˆæ¸¬ã©ãŠã‚Šã‹ç¢ºèªã—ã¦ã„ãã“ã¨ã§éåŒæœŸå‡¦ç†ã®æµã‚ŒãŒèª­ã‚ã‚‹ã‚ˆã†ã«ãªã£ã¦ãã¾ã™ã€‚ãŸã ã—ã€async/await ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ãªã„ã®ã§ã™ãã“ã¯æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

![js visualizer 9000](/images/js-async/img_js-visualizer-9000.jpg)

JavaScript Visualizer 9000 ã‚’ä½¿ã£ã¦ã€Macrotask ã¨ Micortask ã®çµ„ã¿åˆã‚ã›ã«æ…£ã‚Œã¦ãã ã•ã„ã€‚ã“ã“ã§ã¯é‡è¦ãªã“ã¨ã¨ã—ã¦ã€ ~~Macrotask Queue (Task Queue) ã¯å®Ÿã¯**ã‚­ãƒ¥ãƒ¼ã§ã¯ãªãã‚»ãƒƒãƒˆ**ã§ã‚ã‚‹ã“ã¨ã‚’ç†è§£ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚è¤‡æ•°ã® `setTimeout()` é–¢æ•°ã‚’è‰²ã€…ãª delay æ™‚é–“ã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œã—ã¦ã¿ã‚Œã°ç†è§£ã§ãã¾ã™ãŒã€ã‚ãã‚‰ã‹ã«ã‚­ãƒ¥ãƒ¼ã§ã¯ãªã„ã§ã™ã€‚ã‚»ãƒƒãƒˆã§ã‚ã‚‹ã¨ã„ã†ã®ã‚‚ã€ãã‚‚ãã‚‚ä»•æ§˜ã¨ã—ã¦å®šç¾©ã•ã‚Œã¦ã„ã¾ã™~~ã€‚(ãŠãã‚‰ãé–“é•ã„)

https://html.spec.whatwg.org/multipage/webappapis.html#task-queue

>Task queues are sets, not queues, because step one of the event loop processing model grabs the first runnable task from the chosen queue, instead of dequeuing the first task.  
>(ä¸Šè¨˜ãƒšãƒ¼ã‚¸ã‚ˆã‚Šå¼•ç”¨)

è¿½è¨˜: ã“ã‚Œã¯ã€ãŠãã‚‰ãã€ŒTask queues(ã¨ã„ã†é›†åˆ)ã¯ãŸã ã®ã‚­ãƒ¥ãƒ¼ã®é›†åˆã§ã¯ãªãã€ã‚»ãƒƒãƒˆã§ã‚ã‚‹ã€ã¨ã„ã†ã“ã¨ã‚’æ„å‘³ã—ã¦ã„ã¦ã€å˜ä¸€ã® "Task queue" ã¯åå‰ã®é€šã‚Šã‚­ãƒ¥ãƒ¼ã§ã‚ã‚‹ã¨è€ƒãˆã‚‰ã‚Œã¾ã™ã€‚

ã¨ã«ã‹ãã€JavaScript Visualizer 9000 ã¯éåŒæœŸå‡¦ç†ã‚’ç†è§£ã™ã‚‹ã¾ã§é•·ã„ä»˜ãåˆã„ã«ãªã£ãŸã®ã§éå¸¸ã«ã‚ªã‚¹ã‚¹ãƒ¡ã§ã™ã€‚ã“ã‚ŒãŒç„¡ã‹ã£ãŸã‚‰éåŒæœŸå‡¦ç†ã‚’ç†è§£ã§ããªã‹ã£ãŸã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

:::message alert
JavaScript Visualizer 9000 ã‚’ä½¿ã£ã¦å¯è¦–åŒ–ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã€ãƒã‚¤ã‚¯ãƒ­ã‚¿ã‚¹ã‚¯ã‚„ãƒã‚¯ãƒ­ã‚¿ã‚¹ã‚¯ãŒ Call stack ã¨ Event Loop ã§ã©ã†å‹•ãã‹ã‚’äºˆæ¸¬ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ãŒã€JavaScript Visualizer 9000 ã§ã¯ Web APIs ã®è¦ç´ ãŒç„¡ã„ãŸã‚ã€å®Ÿã¯ã‚‚ã†ä¸€æ­©è¸ã¿è¾¼ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

ãªãœ **Web APIs** ã®è¦ç´ ã‚’çœã„ãŸã®ã‹ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚å®Ÿã¯ã“ã‚ŒãŒçœç•¥ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã«ã€Visualizer 9000 ã§è¤‡æ•°ã® `setTimeout()` é–¢æ•°ã‚’è‰²ã€…ãª delay æ™‚é–“ã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œã—ã¦ãƒã‚¯ãƒ­ã‚¿ã‚¹ã‚¯ã®å‹•ãã‚’è¦‹ã‚‹ã¨ã€Œã‚­ãƒ¥ãƒ¼ã€ã¨æ€ãˆãªã„æŒ™å‹•ã«è¦‹ãˆã¦ã—ã¾ã†ã“ã¨ã«æ°—ã¥ãã¾ã—ãŸã€‚åŸºæœ¬çš„ãªæµã‚Œã‚’ç†è§£ã™ã‚‹ã®ã«ã¯å•é¡Œãªã„ã§ã™ãŒã€æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

Visualizer 9000 ã§ã¯ç°¡å˜ã«ã‚³ãƒ¼ãƒ‰ãŒå…±æœ‰ã§ãã‚‹ã®ã§å®Ÿéš›ã«ä»¥ä¸‹ã®ãƒªãƒ³ã‚¯ã‹ã‚‰å®Ÿè¡Œã—ã¦æŒ™å‹•ã‚’è¦‹ã¦ã¿ã¦ãã ã•ã„â†“
[manySetTimeout.js](https://www.jsv9000.app/?code=Ly8gbWFueVNldFRpbWVvdXQuanMKc2V0VGltZW91dChmdW5jdGlvbiBiKCkgewogIGNvbnNvbGUubG9nKCJiOiBhZnRlciA1MDBtcyIpOwp9LCA1MDApOwpzZXRUaW1lb3V0KGZ1bmN0aW9uIGMoKSB7CiAgY29uc29sZS5sb2coImM6IGFmdGVyIDBtcyIpOwp9LCAwKTsKc2V0VGltZW91dChmdW5jdGlvbiBhKCkgewogIGNvbnNvbGUubG9nKCJhOiBhZnRlciAxMDAwbXMiKTsKfSwgMTAwMCk7CnNldFRpbWVvdXQoZnVuY3Rpb24gZCgpIHsKICBjb25zb2xlLmxvZygiZDogYWZ0ZXIgMTAwbXMiKTsKfSwgMTAwKTsKCmZ1bmN0aW9uIGQoKSB7CiAgY29uc29sZS5sb2coImQ6IHN5bmMgZnVuY3Rpb24gZXhlY3V0ZWQgaW1tZWRpYXRlbHkiKTsKfQoKZCgpOwo%3D)
:::

ã•ã¦ã€ã“ã“ã¾ã§ãã‚Œã°éåŒæœŸå‡¦ç†ãŒã‹ãªã‚Šç†è§£ã§ãã¦ã„ã‚‹ã¯ãšã§ã™ã€‚ãã£ã¨ã€ŒéåŒæœŸå‡¦ç†ã€å®Œå…¨ã«ç†è§£ã—ãŸğŸ˜¼ã€çŠ¶æ…‹ã§ã™ã­ã€‚
ã§ã¯ã€ãƒ†ã‚¹ãƒˆã¨ã—ã¦ã‚„ã£ã™ã‚“æ°ã®æ¬¡ã®å‹•ç”»ã§ã‚¯ã‚¤ã‚ºã‚’ã¨ã„ã¦ã¿ã¦ãã ã•ã„ã€‚

@[youtube](T-_0Pc5P12U)

ã„ã‹ã‹ã§ã™ã‹?
è‡ªåˆ†ã®å ´åˆã¯ã€Œä¿ºã€Promise ã¨ã‹ async/await ã®ã“ã¨å…¨ç„¶ã‚ã‹ã£ã¦ã­ãˆã˜ã‚ƒã‚“...ğŸ˜­ã€ã¨ãªã‚Šã¾ã—ãŸã€‚

å‹•ç”»ã‚’ã¿ã¦ã‚‚ã‚‰ã£ãŸã‚‰åˆ†ã‹ã‚‹ã¨æ€ã†ã®ã§ã™ãŒã€Promise ã¨ `await` å¼ã®é–¢ä¿‚ãŒåˆ†ã‹ã£ã¦ã„ãªã„ã¨ 1 ç•ªç›®ã¨ 2 ç•ªç›®ã®ã‚¯ã‚¤ã‚ºãŒè§£ã‘ã¾ã›ã‚“ã—ã€ãã—ã¦ Promise ãƒã‚§ãƒ¼ãƒ³ãŒç†è§£ã§ãã¦ã„ãªã„ã¨æœ€å¾Œã®ã‚¯ã‚¤ã‚ºãŒã¨ã‘ã¾ã›ã‚“ã€‚ãªã®ã§ã€ã“ã“ã‹ã‚‰ã¯å®Ÿéš›ã« Promise ãƒã‚§ãƒ¼ãƒ³ã‚’æ§‹ç¯‰ã™ã‚‹ã“ã¨ã«æ³¨åŠ›ã—ã¦å­¦ç¿’ã‚’ã™ã™ã‚ã¦ã„ãã¾ã™ã€‚ã¾ãŸã€Promise ã¾ã‚ã‚Šã®ç´°ã‹ã„ç–‘å•ã‚’èª¿ã¹å°½ãã—ã¦è§£æ¶ˆã—ã¦ã„ãã¾ã™ã€‚

- Microtask ã¨ Macrotask ã®ä¸¡æ–¹ã‚’å¿µé ­ã« Promise ãƒã‚§ãƒ¼ãƒ³ã‚’æ§‹ç¯‰ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
- åŒæœŸå‡¦ç†ã¨éåŒæœŸå‡¦ç†ã‚’æ··åœ¨ã•ã›ãŸ Promise ãƒã‚§ãƒ¼ãƒ³ã‚’æ§‹ç¯‰ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
- Promise ãƒã‚§ãƒ¼ãƒ³ã§å€¤ã‚’æ¬¡ã®ãƒã‚§ãƒ¼ãƒ³ã¸ã¨æ¸¡ã—ã€ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒæ­£ã—ãè¡Œãˆã‚‹ã‚ˆã†ãªãƒã‚§ãƒ¼ãƒ³æ§‹ç¯‰ã‚’ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹

ã“ã“ã§ Async function ã¨ `await` ã®ã“ã¨ã‚‚è€ƒãˆã¦ã—ã¾ã†ã¨ã‹ãªã‚Šæ··ä¹±ã™ã‚‹ã®ã§ Promise ãƒã‚§ãƒ¼ãƒ³ã®ã“ã¨ã«æ³¨åŠ›ã—ãŸæ–¹ãŒã„ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ã“ã®æ®µéšã§ã¯ azu æ°ã® "JavaScript Promise ã®æœ¬" ã®ã‚³ãƒ©ãƒ ãªã©ãŒéå¸¸ã«æœ‰ç”¨ã§ã—ãŸã€‚

https://azu.github.io/promises-book/#promise-is-always-async

ã¾ãŸã€mdn ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒè‰²ã€…ãªç–‘å•ã‚’è§£æ¶ˆã—ã¦ãã‚ŒãŸã®ã§ä¸»ã«æ¬¡ã®ãƒšãƒ¼ã‚¸ã‚’å«ã‚€éåŒæœŸå‡¦ç†ã«é–¢é€£ã™ã‚‹ãƒšãƒ¼ã‚¸ã‚’èª­ã‚“ã§ã„ãã®ãŒã„ã„ã¨æ€ã„ã¾ã™ã€‚

https://developer.mozilla.org/ja/docs/Web/JavaScript/Guide/Using_promises

ä¸Šè¨˜ã® mdn ã®è§£èª¬ã§ã‚‚ Promise ã«é–¢ã—ã¦ã®ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ãŒç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ãŒã€ä¸‹è¨˜ã®ãƒšãƒ¼ã‚¸ã«ãŠã„ã¦ã„ãã¤ã‚‚ã® Promise ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ã®ã§ï¼‘ã¤ãšã¤ç†è§£ã—ã¦ã„ãã¾ã™ã€‚

https://pouchdb.com/2015/05/18/we-have-a-problem-with-promises.html

ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ãã®ç†ç”±ã‚’ç†è§£ã™ã‚‹ã“ã¨ã«ã‚ˆã£ã¦ Promise ã®æ›–æ˜§ã ã£ãŸã¨ã“ã‚ãŒéå¸¸ã«ã‚¯ãƒªã‚¢ã«ãªã£ã¦ã„ãã®ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

ã•ã¦ã€ã“ã“ã¾ã§æ¥ã‚Œã°åŸºç¤çš„ãª Promise ãƒã‚§ãƒ¼ãƒ³ãŒã‚ã‚‹ç¨‹åº¦æ§‹ç¯‰ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã¨æ€ã„ã¾ã™ã€‚è‡ªåˆ†ã‚‚ã“ã®æ™‚ç‚¹ã§éåŒæœŸ API ãªã©ã®ä½¿ã„æ–¹ã‚‚ã‚ã‚‹ç¨‹åº¦ã‚ã‹ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

ã“ã“ã‹ã‚‰æœ¬æ ¼çš„ã« async/await ã‚’ç†è§£ã™ã‚‹ãŸã‚ã®å­¦ç¿’ãŒå§‹ã¾ã‚Šã¾ã™ã€‚ç‰¹ã« `await` ãŒã‚„ã£ã‹ã„ã§ã™ã€‚éåŒæœŸé–¢æ•°ã®å†…éƒ¨ã§ã® await ã«ã‚ˆã£ã¦ã€Œã“ã‚Œã¯åŒæœŸå‡¦ç†ãªã®ã‹ã€éåŒæœŸå‡¦ç†ãªã®ã‹ã€ãŒã‚ˆãã‚ã‹ã‚‰ãªããªã£ã¦ãã¾ã™ã€‚JavaScript Visualizer 9000 ã§ã¯ async/await ãŒä½¿ãˆãšå¯è¦–åŒ–ã§ããªã„ãŸã‚ã€æ‰‹å…ƒã§ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦å®Ÿè¡Œã—ã¦ã„ãã“ã¨ã‚’ãƒ¡ã‚¤ãƒ³ã«ã—ã¦ç†è§£ã—ã¦ã„ãã¾ã™ã€‚

è‡ªåˆ†ã®å ´åˆã¯ã€ã„ã¾ã¾ã§ã‚„ã£ã¦ããŸ Promies ã®è€ƒãˆæ–¹ã¨å™›ã¿åˆã‚ãªã‹ã£ãŸã‚Šã€Promise ã¨ã®çµ„ã¿åˆã‚ã›æ–¹ã‚’ç†è§£ã™ã‚‹ã¾ã§ã«æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã—ãŸã€‚ã“ã‚Œã¯ Promise ãŒç†è§£ã—ãã‚Œã¦ã„ãªã‹ã£ãŸã“ã¨ã‚’æ„å‘³ã—ã¦ã„ã¾ã™ã€‚**è¤‡æ•°ã® `await` å‡¦ç†ã®å…¥ã£ãŸè¤‡æ•°ã®éåŒæœŸé–¢æ•°ã®å‡¦ç†ã‚’ Promise ãƒã‚§ãƒ¼ãƒ³ã§å®Ÿç¾ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã“ã¨ãŒå¤§åˆ‡ã§ã™**ã€‚Promise ãƒã‚§ãƒ¼ãƒ³ãªã‚‰ JavaScript Visualizer 9000 ã§å¯è¦–åŒ–ã§ãã¾ã™ã®ã§ã€‚

ã¾ãŸã€æœ€åˆã¯ async/await ã«ã‚ˆã£ã¦ Promise ãŒã„ã‚‰ãªããªã£ã¦ã—ã¾ã†ã®ã‹ã¨ã‚‚æ€ã„ã¾ã—ãŸãŒã€ãã‚“ãªã“ã¨ã¯ç„¡ã‹ã£ãŸã§ã™ã€‚ã“ã‚Œã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã®è¤‡æ•°ã® Promise ã‚’æ‰±ã†ã“ã¨ã®ã§ãã‚‹é™çš„ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å­¦ç¿’ã™ã‚‹ã“ã¨ã§å˜ç´”ãª async/await ã§ã‚„ã‚‹ã‚ˆã‚Šã‚‚**åŠ¹ç‡çš„ã«ç›®çš„ã‚’ã¯ãŸã›ã‚‹**ã“ã¨ã‚’ç†è§£ã§ãã‚Œã°ä½“æ„Ÿã§ãã‚‹ã¯ãšã§ã™ã€‚

- [Promise.all()](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Promise/all)
- [Promise.race()](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Promise/race)
- [Promise.allSettled()](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Promise/allSettled) 
- [Promise.any()](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Promise/any)

mdn ã§å„ãƒ¡ã‚½ãƒƒãƒ‰ã®è§£èª¬ã‚„æ¬¡ã®è¨˜äº‹ã‚’èª­ã‚€ã®ã‚’ã‚ªã‚¹ã‚¹ãƒ¡ã—ã¾ã™ã€‚ãã‚Œãã‚Œã®ä½¿ã„ç”¨é€”ã‚„é•ã„ãªã©ãŒã‚ãã‚‰ã‹ã«ãªã‚‹ã¨ async/await ã§ã§ãã‚‹ã“ã¨ã€å˜ç´”ãª `await` å¼ã«ã®ã¿æ³¨åŠ›ã—ã¦ã—ã¾ã†ã¨ã‚„ã‚Šã¥ã‚‰ã„ã“ã¨ãŒé€†ã«åˆ†ã‹ã£ã¦ãã‚‹ã¯ãšã§ã™ã€‚

https://okapies.hateblo.jp/entry/2020/12/13/154311

æ›´ã«ã“ã‚Œã«ã‚ˆã£ã¦ async/await ãŒ Promise ã‚’ä»£æ›¿ã™ã‚‹ã®ã§ã¯ãªãã€Promise ãƒ™ãƒ¼ã‚¹ã®éåŒæœŸå‡¦ç†ã®åˆ©ä¾¿æ€§ã‚’ä¸€éƒ¨å‘ä¸Šã•ã›ã‚‹ Promise ã¨ã„ã†ã‚·ã‚¹ãƒ†ãƒ è‡ªä½“ã«åŸºã¥ã„ãŸæ‹¡å¼µçš„ãªæ©Ÿèƒ½ã§ã‚ã‚Šã€**Promise ã¨ä¸€ç·’ã«ä½¿ã£ã¦ã„ãã‚‚ã®**ã§ã‚ã‚‹ã¨ã„ã†ã“ã¨ãŒèªè­˜ã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚

ãã‚‚ãã‚‚ã€`await` å¼ã¯ã€Œå³è¾ºã® Promise ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒ Settled çŠ¶æ…‹(Fullfilled ã¾ãŸã¯ Rejected çŠ¶æ…‹)ã«ãªã‚‹ã¾ã§éåŒæœŸå‡¦ç†ã®å®Œäº†ã‚’å¾…ã¡ã€Promise ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®çŠ¶æ…‹ãŒå¤‰åŒ–ã—ãŸã‚‰ãã® Promise ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®**è©•ä¾¡çµæœã‚’å€¤ã¨ã—ã¦è¿”ã™**ã€ã‚‚ã®ãªã®ã§ã€Promise ã‚’æ‰±ã£ã¦ã„ã‚‹ã¨èªè­˜ã—ã¦ã—ãªã„ã¨ã‚„ã£ã™ã‚“æ°ã®å‹•ç”»ã§ç´¹ä»‹ã•ã‚ŒãŸãƒŸã‚¹(ãƒã‚¯ãƒ­ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆã™ã‚‹ `setTimeout` é–¢æ•°ã‚’ Promise ã§ãƒ©ãƒƒãƒ—ã™ã‚‹ã“ã¨ãªããã®ã¾ã¾ `await` ã—ã¦ã—ã¾ã†ãªã©)ã‚’çŠ¯ã—ã¦ã—ã¾ã„ã¾ã™ã€‚

:::message
`await` å¼ã§ã¯éåŒæœŸé–¢æ•°ã®å†…éƒ¨ã§éåŒæœŸå‡¦ç†ã®å®Œäº†ã‚’å¾…ã¡ã¾ã™ãŒã€ãã®"å¾…ã£ã¦ã„ã‚‹"ã¨ã„ã†ã®ã¯å®Ÿéš›ã«ã™ã¹ã¦ã®å‡¦ç†ãŒæ­¢ã¾ã£ã¦ã„ã‚‹ã‚ã‘ã§ã¯ãªãã€éåŒæœŸé–¢æ•°ã®å‘¼ã³å‡ºã—å…ƒã«ä¸€æ—¦åˆ¶å¾¡ãŒæˆ»ã£ã¦åˆ¥ã®å‡¦ç†ã‚’å†é–‹ã—ã€`await` ã§å¾…ã£ã¦ã„ãŸ Promise ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒè§£æ±ºã—ãŸå¾Œã«å†ã³éåŒæœŸé–¢æ•°ã«æˆ»ã£ã¦ `await` å¼ã®å¾Œã«ã‚ã‚‹æ¬¡ã®å‡¦ç†ã‚’å†é–‹ã™ã‚‹ã¨ã„ã†ã“ã¨ã‚’æ„å‘³ã—ã¦ã„ã¾ã™ã€‚

éåŒæœŸé–¢æ•°ã®ä¸­ã®å‡¦ç†ã¯ 1 ã¤ 1 ã¤å‡¦ç†ãŒçµ‚ã‚ã£ã¦ã‹ã‚‰é †ç•ªã«å‡¦ç†ãŒé€²ã‚€ã®ã§ã€ã€Œé€æ¬¡çš„(é †æ¬¡çš„)ãªå‡¦ç†ã€ãŒãŠã“ãªã‚ã‚Œã¦ã„ã¾ã™ãŒã€`await` å¼ã«å‡ºä¼šã†ãŸã³ã«ã€ä¸€åº¦åˆ¶å¾¡ã‚’å‘¼ã³å‡ºã—å…ƒã«æˆ»ã—ã¦åˆ¥ã®åŒæœŸå‡¦ç†ãªã©ã‚’å®Ÿè¡Œã—ã¤ã¤ã€`await` ã§å¾…ã£ã¦ã„ãŸ Promise ãŒè§£æ±ºã•ã‚ŒãŸã‚‰ã‚³ãƒ¼ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ã®çŠ¶æ³ã‚’è¦‹ã¦å†ã³åˆ¶å¾¡ãŒéåŒæœŸé–¢æ•°ã«æˆ»ã‚‹ã®ã§ã€å®Ÿéš›ã«åˆ¶å¾¡ã®æµã‚Œã¯ã€ŒåŒæœŸçš„ã€ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã‚Œã¯ Promise ãƒã‚§ãƒ¼ãƒ³ã§ã‚‚åŒã˜çŠ¶æ³ã¨ãªã‚Šã¾ã™ã€‚`then()` ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã¯ãƒã‚¤ã‚¯ãƒ­ã‚¿ã‚¹ã‚¯ã‚­ãƒ¥ãƒ¼ã¸ã¨ä¸€æ—¦é€ã‚‰ã‚Œã€åˆ¶å¾¡ã¯å‘¼ã³å‡ºã—å…ƒã«æˆ»ã‚Šã¾ã™ã€‚ä¹±æš´ãªè¨€ã„æ–¹ã§ã™ãŒã€async/await ã¯æœ¬è³ªçš„ã«ã¯ Promise ãƒã‚§ãƒ¼ãƒ³ã®æ›¸ãæ–¹ã‚’å¤‰ãˆã¦ã„ã‚‹ã ã‘ã§ã™ã€‚

ã‚‚ã—ã€ŒåŒæœŸçš„ã€ã«å‡¦ç†ãŒé€²ã‚“ã§ã„ã‚‹ãªã‚‰ã€éåŒæœŸé–¢æ•°ã®å†…éƒ¨ã§ `await` å¼ã«ã‚ˆã£ã¦ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ãŒå°‚æœ‰ã•ã‚Œã‚‹ã“ã¨ã§ã€Œãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ã€ãŒç™ºç”Ÿã—ã€ãã®é–“ã¯ä¸€åˆ‡ã®å‡¦ç†ãŒé€²ã¾ãªã„ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ã‚‚ã¡ã‚ã‚“ã€ãã‚“ãªã“ã¨ã¯èµ·ãã¦ã„ã¾ã›ã‚“ã€‚ãã‚“ãªã“ã¨ãŒèµ·ãã‚‹ãªã‚‰ã€ãã‚‚ãã‚‚ã€ŒéåŒæœŸå‡¦ç†ã€ã‚’è¡Œã†ãƒ¡ãƒªãƒƒãƒˆãªã‚“ã¦ãªã„ã§ã™ã‚ˆã­ã€‚

Prmoise ãƒã‚§ãƒ¼ãƒ³ã‚„ `await` å¼ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ Async function ã®åˆ¶å¾¡ãŒã€ŒåŒæœŸçš„ã€ã§ã‚ã‚‹ã¨æ··åŒã—ã¦ã—ã¾ã†ã®ã¯ã€ Promise ãƒã‚§ãƒ¼ãƒ³ã‚„éåŒæœŸé–¢æ•°å†…ã®å‡¦ç†ã®ã¿ã«ã¤ã„ã¦è€ƒãˆã‚Œã°ç¢ºã‹ã«ã‚¹ãƒ†ãƒƒãƒ—ã”ã¨ã«ã€Œé€æ¬¡çš„(é †æ¬¡çš„)ã€ã«å‡¦ç†ãŒé€²ã‚“ã§ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚ã—ã‹ã—ã€**ãã®ã‚¹ãƒ†ãƒƒãƒ—ã®é–“ã§ã¯åˆ¥ã®å‡¦ç†ãŒé€²ã‚“ã§ã„ã¾ã™**ã€‚

ã€ŒåŒæœŸã€ã‚„ã€ŒéåŒæœŸã€ã¨ã„ã†è¨€è‘‰ã«æŒ¯ã‚Šå›ã•ã‚Œã‚‹ã“ã¨ã«ã‚ˆã£ã¦ã€ã“ã‚Œã‚’ç†è§£ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ãŸã‚ã«ã‹ãªã‚Šæ™‚é–“ãŒã‹ã‹ã‚Šã¾ã—ãŸã€‚"blocking(ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°)" ã¨ "sequential(é€æ¬¡çš„)" ã¨ã„ã†è¨€è‘‰ã«æ³¨è¦–ã—ã¦ãŠãã¨è‰¯ã„ã¨è¨€ã£ãŸã®ã¯ã“ã®ãŸã‚ã§ã™ã€‚

ã€ŒPromise ã¨ã‹ await ã¨ã‹ã£ã¦ã¯å®Ÿã¯éåŒæœŸå‡¦ç†ã§ã¯ãªã„ã®ã§ã¯ï¼ŸğŸ˜µâ€ğŸ’«ã€ã¨ã„ã†å†’é ­ã®ç–‘å•ã¯ã“ã‚Œã§è§£æ¶ˆã§ãã‚‹ã¯ãšã§ã™ã€‚

async/await ã§ã¯ç„¡ã„ã§ã™ãŒï¼’ã¤ã® Promise ãƒã‚§ãƒ¼ãƒ³ã‚’åŒæ™‚ã«å®Ÿè¡Œã™ã‚‹ã®ã‚’å¯è¦–åŒ–ã—ã¦ã¿ã‚‹ã¨åˆ¶å¾¡ãŒè¡Œã£ãŸã‚Šæ¥ãŸã‚Šã—ã¤ã¤ã‚‚ã‚¹ãƒ†ãƒƒãƒ—ã”ã¨ã«å®Ÿè¡Œã—ã¦ã„ã‚‹æ§˜ãŒç†è§£ã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚Visualizer ã§å¯è¦–åŒ–ã—ã¦ã¿ãŸã®ã§ç¢ºèªã—ã¦ã¿ã¦ãã ã•ã„ã€‚
[doublePromiseChain.js - JS Visualizer 9000](https://www.jsv9000.app/?code=Ly8gZG91YmxlUHJvbWlzZUNoYWluLmpzCgovLyB0aGluayBhd2FpdCB3aXRoIHByb21pc2VzCi8vIHJlbW92ZSBuZXN0aW5nLCBhbHdheSBlbmRzIHdpdGggY2F0Y2goKSBtZXRob2QKZnVuY3Rpb24gcmV0dXJuUHJvbWlzZUZuQSgpIHsKICBjb25zb2xlLmxvZygiLS0%2BIEVudGVyIHJldHVyblByb21pc2VGbkEiKTsKICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKDEwMCkKICAgIC50aGVuKGZ1bmN0aW9uIGExKGRhdGEpIHsKICAgICAgY29uc29sZS5sb2coIi0tPiBFbnRlciB0aGVuIGNhbGxiYWNrOiBhMSIsIGRhdGEpOwogICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKDEwMSk7CiAgICB9KQogICAgLnRoZW4oZnVuY3Rpb24gYjEoZGF0YSkgewogICAgICBjb25zb2xlLmxvZygiLS0%2BIEVudGVyIHRoZW4gY2FsbGJhY2s6IGIxIiwgZGF0YSk7CiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoMTAyKTsKICAgIH0pCiAgICAudGhlbihmdW5jdGlvbiBjMShkYXRhKSB7CiAgICAgIGNvbnNvbGUubG9nKCItLT4gRW50ZXIgdGhlbiBjYWxsYmFjazogYzEiLCBkYXRhKTsKICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgxMDMpOwogICAgfSkKICAgIC50aGVuKGZ1bmN0aW9uIGQxKGRhdGEpIHsKICAgICAgY29uc29sZS5sb2coIi0tPiBFbnRlciB0aGVuIGNhbGxiYWNrOiBkMSIsIGRhdGEpOwogICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKDEwNCk7CiAgICB9KQogICAgLmNhdGNoKChlKSA9PiBjb25zb2xlLmVycm9yKGUpKTsKfQoKZnVuY3Rpb24gcmV0dXJuUHJvbWlzZUZuQigpIHsKICBjb25zb2xlLmxvZygiLS0%2BIEVudGVyIHJldHVyblByb21pc2VGbkIiKTsKICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKDIwMCkKICAgIC50aGVuKGZ1bmN0aW9uIGEyKGRhdGEpIHsKICAgICAgY29uc29sZS5sb2coIi0tPiBFbnRlciB0aGVuIGNhbGxiYWNrOiBhMiIsIGRhdGEpOwogICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKDIwMSk7CiAgICB9KQogICAgLnRoZW4oZnVuY3Rpb24gYjIoZGF0YSkgewogICAgICBjb25zb2xlLmxvZygiLS0%2BIEVudGVyIHRoZW4gY2FsbGJhY2s6IGIyIiwgZGF0YSk7CiAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoMjAyKTsKICAgIH0pCiAgICAudGhlbihmdW5jdGlvbiBjMihkYXRhKSB7CiAgICAgIGNvbnNvbGUubG9nKCItLT4gRW50ZXIgdGhlbiBjYWxsYmFjazogYzIiLCBkYXRhKTsKICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZSgyMDMpOwogICAgfSkKICAgIC50aGVuKGZ1bmN0aW9uIGQyKGRhdGEpIHsKICAgICAgY29uc29sZS5sb2coIi0tPiBFbnRlciB0aGVuIGNhbGxiYWNrOiBkMiIsIGRhdGEpOwogICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKDIwNCk7CiAgICB9KQogICAgLmNhdGNoKGUgPT4gY29uc29sZS5lcnJvcihlKSk7Cn0KCnJldHVyblByb21pc2VGbkEoKQogIC50aGVuKChkYXRhKSA9PiB7CiAgICBjb25zb2xlLmxvZygiQWZ0ZXIgZXhlY3V0aW5nIEZuQSIsIGRhdGEpOwogIH0pOwpyZXR1cm5Qcm9taXNlRm5CKCkKICAudGhlbigoZGF0YSkgPT4gewogICAgY29uc29sZS5sb2coIkFmdGVyIGV4ZWN1dGluZyBGbkEiLCBkYXRhKTsKICB9KTsKCgo%3D)
:::

"JavaScript Primer" ã«æˆ»ã£ã¦ãã‚‹ã¨ã€ã€ŒPromise ã¨ async/await ã¯ä¸€ç·’ã«ä½¿ã£ã¦ã„ãã‚‚ã®ã§ã‚ã‚‹ã€ã¨ã„ã†ã“ã¨ã‚’å†ç™ºè¦‹ã§ãã¾ã™ã€‚

https://jsprimer.net/basic/async/#relationship-promise-async-function

>ã“ã®ã‚ˆã†ã«Async Functionã‚„awaitå¼ã¯æ—¢å­˜ã®Promise APIã¨çµ„ã¿åˆã‚ã›ã¦åˆ©ç”¨ã§ãã¾ã™ã€‚ Async Functionã‚‚å†…éƒ¨çš„ã«Promiseã®ä»•çµ„ã¿ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ãŸã‚ã€ä¸¡è€…ã¯å¯¾ç«‹é–¢ä¿‚ã§ã¯ãªãå…±å­˜é–¢ä¿‚ã«ãªã‚Šã¾ã™ã€‚  
>(ä¸Šè¨˜ãƒšãƒ¼ã‚¸ã‚ˆã‚Šå¼•ç”¨)

Promise ã®é™çš„ãƒ¡ã‚½ãƒƒãƒ‰ã¨ `await` å¼ã‚’çµ„ã¿åˆã‚ã›ã‚‹ä¾‹ã¨ã—ã¦ã€è¤‡æ•°ã®ãƒªã‚½ãƒ¼ã‚¹éåŒæœŸçš„ã«å–å¾—ã™ã‚‹éš›ã« Async function å†…ã§ `await promise1; await promise2; await promise3;` ã®ã‚ˆã†ã«ï¼‘ã¤ãšã¤å–å¾—ãŒå®Œäº†ã™ã‚‹ã®ã‚’å¾…ã¤ã®ã§ã¯ãªãã€`await Promise.allSettled([promise1, promise2, promise3]);` ã¨ã—ã¦è¤‡æ•°ã®éåŒæœŸå‡¦ç†ã‚’ä¸¦è¡Œã—ã¦èµ°ã‚‰ã›ã‚‹ã“ã¨ã§ãƒªã‚½ãƒ¼ã‚¹ã®å–å¾—æ™‚é–“ã‚’å‰Šæ¸›ã§ãã‚‹ãªã©ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚

ã¤ã¾ã‚Šã€"async/await" ã§ã¯ãªãã€"**Promise with async/await**" çš„ãªãƒãƒªã§ã‚ã‚‹ã“ã¨ã‚’ç†è§£ã§ãã¾ã™ã€‚

ã¾ãŸã€ãƒ¢ãƒ€ãƒ³ãª JavaScript/TypeScript ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã§ã‚ã‚‹ Deno ã§ã¯ Node.js ã¨æ¯”è¼ƒã—ãŸã¨ãã®ç‰¹å¾´ã¨ã—ã¦ã€ŒDeno ã§ã®éåŒæœŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ã™ã¹ã¦ Promise ã‚’è¿”ã™ã€ã¨ã„ã†ç‚¹ã‚’ã‚ã’ã¦ã„ã¾ã™ã€‚

>All async actions in Deno return a promise. Thus Deno provides different APIs than Node.  
>([Introduction - Deno Manual](https://deno.land/manual#comparison-to-nodejs) ã‚ˆã‚Šå¼•ç”¨)

"Async/await-based" ã‚„ "Async/await-first" ã§ã¯ãªãã€"Promise-based "ã‚„ "Promise-first" ãªã©ã®è¨€è‘‰ã‚’èã„ãŸã“ã¨ãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚ãã®ç†ç”±ã¯ "Promise" ãŒå¸¸ã«éåŒæœŸå‡¦ç†ã®ä¸»å½¹ã ã‹ã‚‰ã§ã™ã€‚

ãã‚ŒãŒç†è§£ã§ããŸã‚‰ã€ä»Šåº¦ã“ã async/await ã®å¼·ã¿ã‚’ç†è§£ã™ã‚‹æ®µéšã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚

https://developers.google.com/web/fundamentals/primers/async-functions#%E4%BE%8B_%E3%83%AC%E3%82%B9%E3%83%9D%E3%83%B3%E3%82%B9%E3%81%AE%E3%82%B9%E3%83%88%E3%83%AA%E3%83%BC%E3%83%9F%E3%83%B3%E3%82%B0

éåŒæœŸå‡¦ç†ã®ãƒ«ãƒ¼ãƒ—ãªã©ã‚’æ§‹ç¯‰ã™ã‚‹éš›ã«ã€Promsie ãƒã‚§ãƒ¼ãƒ³ã§ã¯è¤‡é›‘ã«ãªã£ã¦ã—ã¾ã†ã‚³ãƒ¼ãƒ‰("ã‚¹ãƒãƒ¼ãƒˆ"ãªæ›¸ãæ–¹ã®ã‚³ãƒ¼ãƒ‰)ã‚’ã€Async function å†…ã§ã¯ `while` ãƒ«ãƒ¼ãƒ—ã‚„ `for` ãƒ«ãƒ¼ãƒ—ã¨ã„ã£ãŸ"ã‚·ãƒ³ãƒ—ãƒ«ã§èª­ã¿ã‚„ã™ã„å¹³å‡¡ãªæ›¸ãæ–¹"ã¸ã¨æŒã¡è¾¼ã‚ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

é€†ã«ã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã« Async function ã‚’ä½¿ã†æ™‚ã¯æ³¨æ„ã™ã‚‹å¿…è¦ãŒã‚ã£ãŸã‚Šã€ã©ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã©ã‚Œã‚’ await ã•ã›ã‚‹ã‹ãªã©ã®é›£ã—ã•ã‚‚åˆ†ã‹ã£ã¦ãã¾ã™ãŒã€‚

ãã‚ŒãŒå‡ºæ¥ãŸã‚‰ã€ä»•ä¸Šã’ã« "Top-level await" ã‚’å­¦ã³ã¾ã™ã€‚Top-level await ã§ `fetch` ãªã©ã®éåŒæœŸ API ãŒç°¡å˜ã«ä½¿ãˆã‚‹ã‹ã‚‰ã¨è¨€ã£ã¦ã€ã„ããªã‚Š Top-level await ã‚’å­¦ã‚“ã§ã—ã¾ã£ãŸå ´åˆã¯ **é€šå¸¸ã® async/await ã«ãŠã‘ã‚‹ã€ŒåŒæœŸã¨éåŒæœŸã€ãŒåˆ†ã‹ã‚‰ãªããªã£ã¦ã—ã¾ã„**ã€éå¸¸ã«æ··ä¹±ã™ã‚‹ã“ã¨ãŒäºˆæ¸¬ã•ã‚Œã‚‹ã®ã§ã€ã“ã®æœ€å¾Œã®æ®µéšã§å­¦ã¶ã“ã¨ã‚’ã‚ªã‚¹ã‚¹ãƒ¡ã—ã¾ã™ã€‚

https://qiita.com/uhyo/items/0e2e9eaa30ec2ff05260

ã•ã¦ã€ã“ã“ã¾ã§ãã‚Œã°ã€ã€ŒéåŒæœŸå‡¦ç†ã®åŸºç¤ãŒèº«ã«ã¤ã„ãŸã€ã¨ã„ãˆã‚‹çŠ¶æ…‹ã«ãªã£ãŸã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚ã‚‚ã¡ã‚ã‚“ã€éåŒæœŸå‡¦ç†ã®ã™ã¹ã¦ã‚’å­¦ã³ãã£ãŸè¨³ã§ã¯ãªã„ã®ã§ã€ä»Šå¾Œã‚‚å­¦ç¿’ã¯ç¶šãã¾ã™(éåŒæœŸã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ `for await...of` ã‚„ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ãªã©ã¯ã¾ã è‡ªåˆ†ã‚‚ã‚ã‹ã‚Šã¾ã›ã‚“)ã€‚

ä»¥ä¸ŠãŒè‡ªåˆ†ãªã‚Šã«ã€Œã‚ã‚‹ç¨‹åº¦ã€éåŒæœŸå‡¦ç†ãŒç†è§£ã§ããŸè¨€ãˆã‚‹çŠ¶æ…‹ã€ã¾ã§åˆ°é”ã™ã‚‹ã®ã«è¾¿ã£ã¦ããŸãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—ã§ã™ã€‚å„é …ç›®ã®é–“ã§æ™‚é–“ãŒç©ºã„ãŸã‚Šã—ã¦çµæ§‹ç„¡é§„ãŒå¤šã‹ã£ãŸã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãŒã€**éåŒæœŸå‡¦ç†ã¸ã®ç´å¾—æ„Ÿ**ã‚’é”æˆã™ã‚‹ã«ã¯ã“ã‚Œãã‚‰ã„ã¯å¿…è¦ã ã£ãŸã‹ãªã¨æ€ã„ã¾ã™ã€‚

å®Ÿéš›ã¯ç´¹ä»‹ã—ã¦ã„ãªã„ã‚‚ã£ã¨å¤šãã®ãƒªã‚½ãƒ¼ã‚¹ã‹ã‚‰ã‚‚å­¦ç¿’ã—ã¦ã„ã‚‹ã®ã§è‡ªåˆ†ã®ä¸­ã§ã®æœ€çŸ­ã¯ã“ã‚“ãªæ„Ÿã˜ã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã«ãªã‚Šã¾ã—ãŸã€‚æ¬¡ã®è¨˜äº‹ã‹ã‚‰ã¯å­¦ã³ã§å¾—ãŸå…·ä½“çš„ãªçŸ¥è¦‹ã‚’ã„ãã¤ã‹çµã£ã¦æ›¸ã„ã¦ã„ã“ã†ã‹ãªã¨æ€ã„ã¾ã™ã€‚è¨˜äº‹ã‚’æ›¸ã„ã¦ã„ã‚‹é€”ä¸­ã§åŠ é€Ÿçš„ã«ç†è§£ãŒé€²ã‚“ã ã‚Šã€ç†è§£ã™ã‚‹ãŸã‚ã«æ¬ ã‘ã¦ã„ãŸãƒ”ãƒ¼ã‚¹ãŒãƒãƒã‚‹ã®ã§éå¸¸ã«ã‚ªã‚¹ã‚¹ãƒ¡ã§ã™ã€‚

## è¿½è¨˜: ECMAScriptã®ã¿ã«æ³¨ç›®ã—ã¦ã‚‚ç†è§£ã§ããªã„
JavaScript ã«ãŠã‘ã‚‹éåŒæœŸå‡¦ç†ã®ä»•çµ„ã¿ã‚’ç†è§£ã—ã‚ˆã†ã¨æ€ã£ã¦ã€éåŒæœŸå‡¦ç†ã®ãŸã‚ã®ã€ŒECMAScriptã€ã®è¨€èªæ©Ÿèƒ½ã ã‘ã‚’è¦‹ã¦ã„ã¦ã‚‚ç†è§£ã§ãã¾ã›ã‚“ã€‚

:::message
å®Ÿã¯ã“ã®è¨˜äº‹ã‚’æ›¸ã„ã¦ã‹ã‚‰é•å’Œæ„ŸãŒã‚ã‚Šã€å†åº¦èª¿ã¹ç›´ã—ãŸçµæœã¨ã—ã¦ç†è§£ã§ãã¾ã—ãŸğŸ˜‡
é–“é•ã„ãŒã‚ã‚Œã°æŒ‡æ‘˜ã—ã¦ã„ãŸã ã‘ã‚‹ã¨åŠ©ã‹ã‚Šã¾ã™ã€‚
:::

"JavaScript" ã®å¢ƒç•Œç·šãŒã©ã“ã¾ã§ãªã®ã‹ã¯ã¯ã£ãã‚Šã—ã¾ã›ã‚“ãŒã€JavaScript ã¯å¸¸ã«å®Ÿè¡Œã™ã‚‹ç’°å¢ƒãŒã‚ã‚Šã€ãã®**ç’°å¢ƒã«ã‚ˆã£ã¦åˆ©ç”¨ã§ãã‚‹æ©Ÿèƒ½ãŒç•°ãªã‚‹**ã®ã§ã€ECMAScript(JavaScript ã®è¨€èªã‚³ã‚¢)ã«ãŠã‘ã‚‹éåŒæœŸå‡¦ç†ã®æ©Ÿèƒ½ã‚’è€ƒãˆã‚‹ã‚ˆã‚Šã‚‚ã€ã€Œç’°å¢ƒã¨çµã³ã¤ã„ãŸã‚‚ã®ã¨ã—ã¦ã® JavaScript ã®éåŒæœŸå‡¦ç†ã€ã€ã²ã„ã¦ã¯ã€Œç’°å¢ƒãã®ã‚‚ã®ã€ã®ã“ã¨ã‚’è€ƒãˆãªã„ã¨éåŒæœŸå‡¦ç†ã‚’ç†è§£ã§ãã¾ã›ã‚“ã€‚

ã¨ã„ã†ã®ã‚‚ã€`setTimeout()` ã®ã‚¿ã‚¤ãƒãƒ¼å‡¦ç†ã‚„ `fetch()` ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚’ã—ã¦ãƒ‡ãƒ¼ã‚¿å–å¾—ã™ã‚‹ã¨ã„ã†ã€Œæ ¹æœ¬çš„ãªå‡¦ç†ã€ã‚’å®Ÿéš›ã«ã€Œãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã®ä¸¦åˆ—(parallel)å‡¦ç†ã§ã€è¡Œã£ã¦ãã‚Œã¦ã„ã‚‹ã®ã¯æ¬¡ã®ã‚‚ã®ã ã‹ã‚‰ã§ã™ã€‚

- Web APIs ã‚’æä¾›ã™ã‚‹ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒ (Chrome ã®å ´åˆ)
- Runtime APIs ã‚’æä¾›ã™ã‚‹ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç’°å¢ƒ (Node.js ã‚„ Deno ã®å ´åˆ)

https://www.freecodecamp.org/news/async-await-javascript-tutorial/

>It turns out that it is **the environment** that takes on the work, and the way to get the environment to do that work, is to use functionality that belongs to the environment. For example fetch or setTimeout in the browser environment.
>(ä¸Šè¨˜ãƒšãƒ¼ã‚¸ã‚ˆã‚Šå¼•ç”¨)

å¾“ã£ã¦ã€ECMAScript ã®è¨€èªã¨ã—ã¦ã®ã€ŒPromise ã‚„ async/await ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã€ã‚„ã€Œã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã¨ä¸¦è¡Œ(concurrent)å‡¦ç†ã€ã‚’è€ƒãˆã¦ã„ã¦ã‚‚ç¾å®Ÿã«èµ·ã“ã‚‹ã€ŒéåŒæœŸå‡¦ç†ã®ä»•çµ„ã¿ã€ã«ã¤ã„ã¦ã®è¬ãŒæ°¸é ã«è§£ã‘ã¾ã›ã‚“ã€‚

ä¾‹ãˆã°ã€`fetch()` ãƒ¡ã‚½ãƒƒãƒ‰ã¯ ECMAScript ã®ä¸€éƒ¨ã§ã¯ãªãã€Web APIs(Web Platform APIs) ã®ä¸€éƒ¨ã§ã‚ã‚‹ Fetch API ã®ãƒ¡ã‚½ãƒƒãƒ‰ã§ã‚ã‚Šã€å®Ÿéš›ã«ãã®æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹ã®ã¯ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã‚„ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç’°å¢ƒã§ã™ã€‚

Chrome ã¨ã„ã£ãŸãƒ¢ãƒ€ãƒ³ãªãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã‚’ä»£è¡¨ã¨ã—ã¦è€ƒãˆã‚‹ã¨ã€ãƒ–ãƒ©ã‚¦ã‚¶ã¯ãã‚‚ãã‚‚æ§˜ã€…ãªã‚¿ã‚¹ã‚¯ã‚’è¡Œã£ã¦ã„ã‚‹ã®ã§ã€"ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰"ãªã©ã§ã¯ãªãã€ãƒãƒ«ãƒãƒ—ãƒ­ã‚»ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã‚ã‚Šã€æ§˜ã€…ãªã‚¿ã‚¹ã‚¯ã®è²¬å‹™ã‚’æŒã¤åˆ†é›¢ã—ãŸãƒ—ãƒ­ã‚»ã‚¹ã®ä¸­ã«è¤‡æ•°ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’æŒã¤å½¢ã«ãªã£ã¦ã„ã¾ã™ã€‚

https://developer.chrome.com/blog/inside-browser-part2/

Chrome ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªè¤‡æ•°ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒä½œæˆã•ã‚Œã¾ã™ã€‚
- Browser process
- Renderer process
- GPU process
- Plugin process
- Extensions process
- Utility process

`setTimeout(cb, delay)` ã®ä¾‹ã§ã¯ã€æŒ‡å®šã—ãŸæ™‚é–“å¾Œã«ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ Macrotask queue ã¸ã¨è¿½åŠ ã—ã€Event Loop ã«ã‚ˆã£ã¦ Call stack ã¸ã¨é‹ã‚“ã§ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œã—ã¦ã„ã‚‹ã®ã§ã€ã“ã‚Œã‚’ã€Œã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã€ã§å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹ã¨è§£é‡ˆã™ã‚‹ã“ã¨ã¯å¯èƒ½ã§ã™ãŒã€ã€Œç¾å®Ÿã®ã‚¿ã‚¤ãƒãƒ¼å‡¦ç†ã€ã¯ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã§è¡Œã‚ã‚Œã¦ã„ã‚‹ã‚ã‘ã§ã¯ãªã„ã§ã™ã€‚ã‚‚ã—ã‚¿ã‚¤ãƒãƒ¼å‡¦ç†ãŒãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã§è¡Œã‚ã‚Œã¦ã„ã‚‹ãªã‚‰ãã‚Œã“ã**ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ãŒç™ºç”Ÿã™ã‚‹ã¯ãš**ã§ã™ã‹ã‚‰ã€‚
`setTimeout()` ãƒ¡ã‚½ãƒƒãƒ‰ã¯ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã‚„ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç’°å¢ƒãŒæä¾›ã™ã‚‹ API ã§ã‚ã‚Šã€ãã®ã€Œã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ ã™ã‚‹ã¾ã§ã®æ™‚é–“ã‚’å›³ã‚‹ã€ã¨ã„ã†å‡¦ç†è‡ªä½“ã¯ç’°å¢ƒã®åˆ¥ã‚¹ãƒ¬ãƒƒãƒ‰ã§è¡Œã‚ã¦ã„ã‚‹ã¯ãšã§ã™ã€‚

ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯è‡ªä½“ã¯ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã§å‡¦ç†ã•ã‚Œã‚‹ãŒã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ã‚­ãƒ¥ãƒ¼ã«è¿½åŠ ã™ã‚‹ãŸã‚ã®ã‚¿ã‚¤ãƒãƒ¼å‡¦ç†ã¯åˆ¥ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã§è¡Œã‚ã‚Œã¦ãŠã‚Šã€ã€ŒéåŒæœŸå‡¦ç†=éåŒæœŸçš„ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†=ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã€ã¨è€ƒãˆã‚‹ãªã‚‰ã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã®å‡¦ç†ã¨ã„ã†éåŒæœŸå‡¦ç†ãã®ã‚‚ã®ã¯ä¸¦è¡Œ(concurrent)ã«å‡¦ç†ã•ã‚Œã¦ã„ã¾ã™ãŒã€éåŒæœŸå‡¦ç†ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’å›³ã£ã¦ã„ã‚‹ã‚¿ã‚¤ãƒãƒ¼ã®å‡¦ç†ã¯ç’°å¢ƒã®åˆ¥ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã‚ã‚Šã€ä¸¦åˆ—(parallel)ã«å®Ÿè¡Œã—ã¦ã„ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

ã¾ãŸã€`fetch(url)` ã‚‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®æ¥ç¶šã‚’ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã„ã‚‹ã®ã«**ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ã—ãªã„ã§ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§è¡Œã†ã“ã¨ãŒã§ãã‚‹**ã®ã¯ã€ã€Œç¾å®Ÿã®ãƒ‡ãƒ¼ã‚¿å–å¾—å‡¦ç†ã€ãŒãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã§è¡Œã‚ã‚Œã¦ã„ãªã„ã‹ã‚‰ã§ã™ã€‚`fetch(url)` ãã®ã‚‚ã®ã®å‡¦ç†ãŒç’°å¢ƒã®åˆ¥ã‚¹ãƒ¬ãƒƒãƒ‰ã§ä¸¦åˆ—(parallel)ã«è¡Œã‚ã‚Œã¦ã‚‹ä¸€æ–¹ã§ã€`fetch(url).then(cb)` ã® `cb` ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã«ã¤ã„ã¦ã€ŒéåŒæœŸå‡¦ç†=éåŒæœŸçš„ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†=ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã€ã¨ã—ã¦è€ƒãˆã‚‹ãªã‚‰ã€ãŸã—ã‹ã«ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã®å‡¦ç†ã¨ã„ã†éåŒæœŸå‡¦ç†ãã®ã‚‚ã®ã¯ä¸¦è¡Œ(concurrent)ã«å‡¦ç†ã•ã‚Œã¦ã„ã¾ã™ã€‚

å®Ÿéš›ã€JavaScript ã®éåŒæœŸå‡¦ç†ã§ã‚ˆãèªã‚‰ã‚Œã‚‹ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã¯ç¾å®Ÿã®ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒ(Chrome)ã§ã¯ã€ŒRenderer Process ã® Main threadã€ã®ã“ã¨ã§ã‚ã‚Šã€`fetch()` ãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã‚„ãƒªã‚¯ã‚¨ã‚¹ãƒˆãªã©ã®å‡¦ç†ã‚’è¡Œã£ã¦ã„ã‚‹ã®ã¯ã€ŒBrowser process ä¸Šã® Network threadã€ã§ã™ã€‚

`await` å¼ã®å‰å¾Œã‚„ Promise ãƒã‚§ãƒ¼ãƒ³ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯è‡ªä½“ã¯ç¢ºã‹ã«ã€ŒéåŒæœŸå‡¦ç†=éåŒæœŸçš„ãªã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å®Ÿè¡Œã•ã‚Œã‚‹å‡¦ç†ã€ã§ã‚ã‚Šã€ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã§ä¸¦è¡Œ(concurrent)ã«å‡¦ç†ã•ã‚Œã¦ã„ã¾ã™ãŒã€ãã‚Œã‚’ Micortask queue ã‚„ Macrotask queue ã¸ã¨è¿½åŠ ã™ã‚‹ãŸã‚ã®å‡¦ç†è‡ªä½“ã¯ä¸¦åˆ—(parallel)ã§ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã§èµ·ãã¦ã„ã¾ã™ã€‚

ã€Œä¸¦åˆ—(parallel)å‡¦ç†ã¨ä¸¦è¡Œ(concurrent)å‡¦ç†ãŒåŒæ™‚ã«èµ·ãã¦ã„ã‚‹ã€ã€ã€Œã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã‚ã‚Šã€ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰ã§ã‚ã‚‹ã€ã¨ã„ã†æ–‡å­—ã«ã™ã‚‹ã¨é ­ãŒæ··ä¹±ã™ã‚‹ã‚ˆã†ãªè©±ã§ã™ãŒã€**å¯¾ç«‹ã™ã‚‹æ¦‚å¿µãŒåŒå±…ã—ã¦ã€ŒéåŒæœŸå‡¦ç†ã€ã®ä»•çµ„ã¿ã‚’å®Ÿç¾ã—ã¦ã„ã‚‹**ã¨è€ƒãˆãªã„ã¨ã¤ã˜ã¤ã¾ãŒåˆã‚ãªã„ã®ã§ã€ã“ã†ãªã‚Šã¾ã™ã€‚

ã“ã®çµè«–ã«è‡³ã‚‹å‚è€ƒã¨ã—ã¦æ¬¡ã®æ–‡çŒ®ãŒãƒ¡ã‚¤ãƒ³ã¨ã—ã¦å‚è€ƒã«ãªã‚Šã¾ã—ãŸã€‚

https://www.telerik.com/blogs/angular-basics-introduction-processes-threads-web-ui-developers

ãã—ã¦ Event Loop ã¨ Call Stack ã‚’ç†è§£ã™ã‚‹ãŸã‚ã®å‹•ç”»ã¨ã—ã¦ç´¹ä»‹ã—ãŸã€ŒWhat the heck is the event loop anyway?ã€ã§ã¯ã€Œ**Web APIs ãŒå®Ÿè³ªçš„ã«ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã‚ã‚‹**ã€ã¨ã„ã†ã“ã¨ãŒå®Ÿã¯èªã‚‰ã‚Œã¦ã„ã¾ã—ãŸã€‚ã“ã®å‹•ç”»ã§ã¯ã€Œãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã€ã®ã“ã¨ã«ã¤ã„ã¦ã‚‚èªã‚‰ã‚Œã¦ã„ã‚‹ã®ã§ã€Promsie ãƒã‚§ãƒ¼ãƒ³ãªã©ãŒç†è§£ã§ããŸå¾Œã‚‚ä½•åº¦è¦‹è¿”ã—ã¦ã‚‚ã‚ˆã„ã¨æ€ã„ã¾ã™ã€‚

>Right, so I've been kind of partially lying do you and telling you that JavaScript can only do one thing at one time. That's true the JavaScript Runtime can only do one thing at one time. It can't make an AJAX request while you're doing other code. It can't do a setTimeout while you're doing another code. The reason we can do things concurrently is that the browser is more than just the Runtime. So, remember this diagram, the JavaScript Runtime can do one thing at a time, but the browser gives us these other things, gives us these we shall APIs, these are effectively threads, you can just make calls to, and those pieces of the browser are aware of this concurrency kicks in.
>(ä»¥ä¸‹ã®æ›¸ãèµ·ã“ã—ãƒšãƒ¼ã‚¸ã‹ã‚‰å¼•ç”¨)

https://2014.jsconf.eu/speakers/philip-roberts-what-the-heck-is-the-event-loop-anyway.html

:::message
è£œè¶³: Philip Roberts æ°ãŒè¨€ã† "Runtime" ã¨ã¯ Chrome ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã® JS ã‚¨ãƒ³ã‚¸ãƒ³ã§ã‚ã‚‹ V8 ã®ã“ã¨ã‚’è¨€ã£ã¦ã„ã¾ã™ã€‚Deno ã‚„ Node ã¯ V8 ã‚’å«ã‚“ã "ç’°å¢ƒ"ã§ã‚ã‚Šã€è‰²ã€…ãª API ã‚’æä¾›ã™ã‚‹ã®ã§ã€ã“ã“ã§ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã¨ç­‰ä¾¡ãªã‚‚ã®ã¨ã—ã¦è€ƒãˆã¦ãã ã•ã„ã€‚

ãã‚Œãã‚Œå…¬å¼ã‚µã‚¤ãƒˆã§ã®æ–‡è¨€ã€‚
- [Deno is a simple, modern and secure runtime for JavaScript and TypeScript that uses V8 and is built in Rust.](https://deno.land)
- [Node.jsÂ® is a JavaScript runtime built on Chrome's V8 JavaScript engine.](https://nodejs.org/en/)
:::

â†“ æ›¸ãèµ·ã“ã—ãŒå®Ÿéš›ã®è¨€è‘‰ã¨è‹¥å¹²é•ã£ã¦ã„ã‚‹ã®ã§å‹•ç”»ã§ç¢ºèªã™ã‚‹ã¨ 11:48 ã®ã¨ã“ã‚ã§ã™ã€‚
[ã‚¤ãƒ™ãƒ³ãƒˆãƒ«ãƒ¼ãƒ—ã¨ã¯ä¸€ä½“ä½•ã§ã™ã‹ï¼Ÿ | Philip Roberts | JSConf EU](https://youtu.be/8aGhZQkoFbQ?t=708)

æœ€å¾Œã«ã‚‚ã†ä¸€åº¦æµã‚Œã‚’ã¾ã¨ã‚ã¾ã™ã¨ã€ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã«ãŠã„ã¦ `setTimeout()` ã¨ `fetch()` ã¯ **web API** ã§ã™(ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç’°å¢ƒã§ã¯ Runtime API)ã€‚ECMAScript è¨€èªã®ä¸€éƒ¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä¸¡æ–¹ã¨ã‚‚è‡ªåˆ†ã§å®šç¾©ã—ãŸé–¢æ•°ã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ã®ã§ã¯ãªã API ã®å‘¼ã³å‡ºã—ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚API ã‚’ä»‹ã—ã¦ã€Œæ™‚é–“ã‚’å›³ã‚‹ã€ã€ã€Œãƒªã‚½ãƒ¼ã‚¹ã‚’å–å¾—ã™ã‚‹ã€ã¨ã„ã£ãŸã‚¿ã‚¹ã‚¯ãŒã€Œç’°å¢ƒã€ã¸å§”ä»»(Delegate)ã•ã‚Œã€ãã®ã‚¿ã‚¹ã‚¯ã‚’ã€Œç’°å¢ƒãã®ã‚‚ã®ã€ãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ä¸¦åˆ—(parallel)ã«è¡Œã„ã¾ã™ã€‚ã€Œç’°å¢ƒã«å§”ä»»ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã—ãŸã‚‰ä½•ã‹ã‚’ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã§è¡Œã†ã€ã¨ã„ã†**ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã®å½¢**ã§ç™»éŒ²ã—ã¦ãŠã„ãŸåˆ¥ã®ã‚¿ã‚¹ã‚¯(=éåŒæœŸå‡¦ç†)ã¯ã€å§”ä»»ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯ã‚’çµ‚ã‚ã‚‰ã›ãŸæ™‚ç‚¹ã§ç’°å¢ƒã‹ã‚‰ Macrotask queue ã‚„ Microtask queue ã¸ã¨é€ã‚‰ã‚Œã€Event Loop ã«ã‚ˆã£ã¦ Call stack ã¸ã¨é‹ã°ã‚ŒãŸæ™‚ç‚¹ã§ JavaScript ã®ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚ã“ã‚ŒãŒ JavaScript ã«ãŠã‘ã‚‹éåŒæœŸå‡¦ç†ã®ä»•çµ„ã¿ã§ã™ã€‚

çµå±€ã®æ‰€ã€éåŒæœŸå‡¦ç†ã®ä»•çµ„ã¿ã‚’ç†è§£ã™ã‚‹ã«ã¯ã€ŒPromise ã‚„ async/await ã¨ã„ã£ãŸè¨€èªæ©Ÿèƒ½ã®æ¦‚å¿µã¨ãã®ä½¿ã„æ–¹ã€ã ã‘ã§ãªãã€Œ**API ã‚’æä¾›ã™ã‚‹ç’°å¢ƒ**ã€ã®ã“ã¨ã‚’çŸ¥ã‚‹ã“ã¨ãŒå¿…è¦ã ã£ãŸã€ã¨ã„ã†è¨³ã§ã™ã€‚

æœ¬æ¥æ™‚é–“ã®ã‹ã‹ã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚’ä»‹ã—ãŸãƒ‡ãƒ¼ã‚¿å–å¾—(`fetch()`)ã‚„ I/O (`Deno.readFile()` ã‚„ `fsPromise.readFile()`)ãªã©ã®å‡¦ç†ã¯åŸºæœ¬çš„ã«ç’°å¢ƒãŒ API ã¨ã—ã¦ç”¨æ„ã—ã¦ãã‚Œã¦ã„ã¾ã™ã€‚ã‚‚ã¡ã‚ã‚“ã™ã¹ã¦ã® API ãŒæ™‚é–“ã®ã‹ã‹ã‚‹å‡¦ç†ã§ã¯ãªãã€ä¾‹ãˆã°ã€`console.log()` ã‚„ `URL()` ãªã©ã‚‚ Web API ãªã®ã§ç’°å¢ƒã®æä¾›ã™ã‚‹æ©Ÿèƒ½ã§ã™ãŒã€é€šä¿¡ã‚„ I/O ã«æ¯”ã¹ã¦ã™ãã«å‡¦ç†ãŒçµ‚äº†ã™ã‚‹ã®ã§ã€éåŒæœŸã§ã¯ãªãåŒæœŸçš„ãªã‚‚ã®ã¨ãªã£ã¦ã„ã¾ã™ã€‚

:::message
"blocking" ã®ç”¨èªã®ã¨ã“ã‚ã§ç´¹ä»‹ã—ã¾ã—ãŸãŒã€Node ã‚„ Deno ã®ç’°å¢ƒã§ã¯é•·æ™‚é–“ã‹ã‹ã‚‹å‡¦ç†ã®å®Œäº†ã‚’å¾…ã£ã¦ã€ã‚ãˆã¦ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã® Event Loop ã‚’ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ã™ã‚‹åŒæœŸ API (Synchronous APIs) ã‚’æä¾›ã—ã¦ã„ã¾ã™ã€‚Node ãªã‚‰ `fs.readFileSync()`ã€Deno ãªã‚‰ `Deno.readFileSync()` ãªã©ãŒè©²å½“ã—ã¾ã™ã€‚ç”¨é€”ã¨ã—ã¦ã¯ã€ã€Œã‚¹ãƒ‹ãƒšãƒƒãƒˆç¨‹åº¦ã®ã‚³ãƒ¼ãƒ‰ã ã‹ã‚‰ã‚ã–ã‚ã–éåŒæœŸå‡¦ç†ã«ã™ã‚‹ã¾ã§ã‚‚ãªã„ã€ã¨ã„ã†ã¨ãã‚„ã€ä»–ã®ä½•ã‚‰ã‹ã®ç†ç”±ã§ã‚ãˆã¦éåŒæœŸå‡¦ç†ã«ã—ãŸããªã„çŠ¶æ³ãªã©ã§ä½¿ç”¨ã—ãŸã‚Šã—ã¾ã™ã€‚

>The synchronous APIs perform all operations synchronously, **blocking the event loop until the operation completes or fails**.
> ([File system | Node.js v17.9.0 Documentation](https://nodejs.org/api/fs.html#synchronous-api) ã‚ˆã‚Šå¼•ç”¨)
:::

API ã‚’ä»‹ã—ã¦æ™‚é–“ã®ã‹ã‹ã‚‹å‡¦ç†ã¯ç’°å¢ƒã¸å§”ä»»ã•ã‚Œã¾ã™ãŒã€ã‚‚ã—ç’°å¢ƒãŒ API ã¨ã—ã¦ç”¨æ„ã—ã¦ã„ãªã„ã‚ˆã†ãªæ™‚é–“ãŒã‹ã‹ã‚‹ã‚¿ã‚¹ã‚¯(CPU-intensitve ã§ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’é•·æ™‚é–“å°‚æœ‰ã—ã¦ã—ã¾ã†ã‚ˆã†ãªå‡¦ç†)ã‚’è‡ªåˆ†ã§å®šç¾©ã—ãŸåŒæœŸé–¢æ•°ãªã©ã§è¡Œã†å ´åˆã¯ã€Web Workers ã§ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã‹ã‚‰åˆ†é›¢ã—ãŸåˆ¥ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ä½œæˆã—ã¦ã€ãã®ã‚¹ãƒ¬ãƒƒãƒ‰ã§ä¸¦åˆ—(parallel)ã«å‡¦ç†ã‚’èµ°ã‚‰ã›ã‚‹ã“ã¨ã§**ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã® Event Loop ã‚’ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ã›ãšã«æ¸ˆã¾ã›ã‚‹**ã“ã¨ãŒã§ãã¾ã™ã€‚ã‚‚ã¡ã‚ã‚“ã“ã‚Œã‚‚ Web API ã§ã™ã€‚

https://developer.mozilla.org/ja/docs/Web/API/Web_Workers_API/Using_web_workers

## å‚è€ƒæ–‡çŒ®ã¨ãƒ„ãƒ¼ãƒ«ã®ã¾ã¨ã‚

éåŒæœŸå‡¦ç†ã‚’ç†è§£ã™ã‚‹ã®ã«å¿…è¦ä¸å¯æ¬ ãªé“å…·ã€‚
- [Loupe](http://latentflip.com/loupe/)
- [JS Visualizer 9000](https://www.jsv9000.app)
- ã™ãã« JS ã‚’å®Ÿè¡Œã§ãã‚‹ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç’°å¢ƒ(Deno or Node)

éåŒæœŸå‡¦ç†ã®åŸºç¤ã‚’ç†è§£ã™ã‚‹ãŸã‚ã«å¿…è¦ãªåŸºæœ¬ãƒªã‚½ãƒ¼ã‚¹ã€‚
- [JavaScript Primer - è¿·ã‚ãªã„ãŸã‚ã®å…¥é–€æ›¸](https://jsprimer.net/)
- [What the heck is the event loop anyway? | Philip Roberts | JSConf EU - YouTube](https://www.youtube.com/watch?v=8aGhZQkoFbQ&t=804s)
- [mdn](https://developer.mozilla.org/ja/docs/Learn/JavaScript/Asynchronous)

åˆ†ã‹ã£ã¦ããŸã¨æ€ã£ãŸã“ã‚ã«åˆ†ã‹ã£ã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã®ã«å½¹ç«‹ã£ãŸãƒªã‚½ãƒ¼ã‚¹ã€‚
- [JavaScriptã®async/await ç†è§£ã—ã¦ã¾ã™ã‹ï¼Ÿ èª¬æ˜ã§ãã¾ã™ã‹ï¼Ÿ ã‚¯ã‚¤ã‚ºã«ç­”ãˆã¦ã‚‚ã‚‰ã£ã¦è‰¯ã„ã§ã™ã‹ï¼Ÿ - YouTube](https://www.youtube.com/watch?v=T-_0Pc5P12U&t=36s)

ã‚ã‚‹ç¨‹åº¦è‡ªä¿¡ã‚’æŒã£ã¦ç†è§£ã—ãŸã¨è¨€ãˆã‚‹ã‚ˆã†ã«ãªã‚‹ãŸã‚ã®ãƒªã‚½ãƒ¼ã‚¹ã€‚
- [JavaScript Promiseã®æœ¬](https://azu.github.io/promises-book/)ã®ã‚³ãƒ©ãƒ 
- [We have a problem with promises](https://pouchdb.com/2015/05/18/we-have-a-problem-with-promises.html)
- [mdn](https://developer.mozilla.org/ja/docs/Learn/JavaScript/Asynchronous)(åˆæ­©ã«ã—ã¦çœŸé«„çš„ãªã¨ã“ãŒã‚ã‚‹)

ç’°å¢ƒã«ãŠã‘ã‚‹éåŒæœŸå‡¦ç†ã®ä»•çµ„ã¿ã«ã¤ã„ã¦ç†è§£ã™ã‚‹ãŸã‚ã®ãƒªã‚½ãƒ¼ã‚¹ã€‚
- [Inside look at modern web browser (part 2) - Chrome Developers](https://developer.chrome.com/blog/inside-browser-part2/)
- [Angular Basics: Introduction to Processes, Threadsâ€”Web UI](https://www.telerik.com/blogs/angular-basics-introduction-processes-threads-web-ui-developers)
- [What the heck is the event loop anyway? | Philip Roberts | JSConf EU - YouTube](https://www.youtube.com/watch?v=8aGhZQkoFbQ&t=804s)

