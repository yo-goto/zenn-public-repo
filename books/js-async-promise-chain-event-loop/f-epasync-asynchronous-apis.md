---
title: "éžåŒæœŸ API ã¨ç’°å¢ƒ"
cssclass: zenn
date: 2022-05-06
modified: 2022-11-14
AutoNoteMover: disable
tags: [" #type/zenn/book  #JavaScript/async "]
aliases: Promiseæœ¬ã€ŽéžåŒæœŸ API ã¨ç’°å¢ƒã€
---

# ã“ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã«ã¤ã„ã¦

ã“ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã§ã¯éžå¸¸ã«é‡è¦ãªè©±ã‚’ã—ã¾ã™ãŒã€ãã‚Œã‚’ç†è§£ã™ã‚‹ãŸã‚ã®å‰æçŸ¥è­˜ãŒã„ãã¤ã‹å¿…è¦ã«ãªã£ã¦ãã‚‹ãŸã‚ç¬¬ï¼’ç« ã‚„ç¬¬ï¼“ç« ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã§è§£èª¬ã™ã‚‹çŸ¥è­˜ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚åˆ†ã‹ã‚‰ãªã„éƒ¨åˆ†ã«ã¤ã„ã¦ã¯ã™ãã«ç†è§£ã§ããªãã¦ã‚‚ã„ã„ã®ã§èª­ã¿é€²ã‚ã¦ã‹ã‚‰æˆ»ã£ã¦ãã¦ãã ã•ã„ã€‚

ãã‚Œã§ã¯ã‚¤ãƒ™ãƒ³ãƒˆãƒ«ãƒ¼ãƒ—ã‚„ Promise chain ã®è©±ã¸å…¥ã‚‹å‰ã«ã€éžåŒæœŸå‡¦ç†ã§å¤§åˆ‡ãªã€ŒAPI ã¨ç’°å¢ƒã€ã®è©±ã‚’ã—ã¦ãŠãã¾ã™ã€‚ãªãœã“ã®è©±ã‚’æœ€åˆã«ã—ã¦ãŠãã‹ã¨ã„ã†ã¨ã€ç­†è€…è‡ªèº«ãŒã“ã®è©±é¡Œã®é‡è¦æ€§ã‚’ç†è§£ã™ã‚‹ã¾ã§ã«ã‹ãªã‚Šã®æ™‚é–“ãŒã‹ã‹ã£ãŸãŸã‚ã§ã™ã€‚

éžåŒæœŸå‡¦ç†ã®å­¦ç¿’ã«ã¯å¤šãã®ãƒˆãƒ©ãƒƒãƒ—ãŒã‚ã‚Šæ§˜ã€…ãªèª¤è§£ã‚’ã—ãŒã¡ã§ã™ãŒã€ãã‚‚ãã‚‚ã®è©±ã¨ã—ã¦ã€ŒãªãœéžåŒæœŸå‡¦ç†ã‚’ã™ã‚‹ã®ã‹ã€ã«ã¤ã„ã¦ç†è§£ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã“ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã§ã¯ API ã¨ç’°å¢ƒã®è©±ã‚’é€šã—ã¦éžåŒæœŸå‡¦ç†ã‚’è¡Œã†ç›®çš„ã‚’è€ƒãˆã€ãã®å…¨ä½“çš„ãªä»•çµ„ã¿ã‚’æŽ´ã¿ã¾ã™ã€‚

:::message
**éžåŒæœŸå‡¦ç†ã®å­¦ç¿’ã§ã¯è¨€è‘‰ã«æƒ‘ã‚ã•ã‚Œãªã„ã“ã¨ãŒé‡è¦**

ã€ŒéžåŒæœŸã€ã‚„ã€ŒåŒæœŸã€ã€ã€Œawaitã€ã¨ã„ã£ãŸå˜èªžãƒ¬ãƒ™ãƒ«ã§ã‚‚ãã†ã§ã™ãŒã€éžåŒæœŸå‡¦ç†ã‚’å­¦ç¿’ã™ã‚‹éŽç¨‹ã§ã¯ã€èª¬æ˜Žã‚„è§£èª¬ã«ä½¿ã‚ã‚Œã‚‹è¨€è‘‰ãã®ã‚‚ã®ã«æƒ‘ã‚ã•ã‚Œã‚‹(æ··ä¹±ã•ã›ã‚‰ã‚Œã‚‹)ã‚±ãƒ¼ã‚¹ãŒéžå¸¸ã«å¤šã„ã¨æ„Ÿã˜ã¾ã—ãŸã€‚å®Ÿéš›ã€éžåŒæœŸå‡¦ç†ã®å­¦ç¿’ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ãªè§£èª¬ã«ã‚ˆãä½¿ç”¨ã•ã‚Œã‚‹æ–‡è¨€ã«å¯¾ã—ã¦ç–‘ã£ãŸã‚Šã€æ…Žé‡ã«è€ƒãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

- ã€ŒJavaScript ã¯ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œã•ã‚Œã‚‹ã€
- ã€ŒéžåŒæœŸå‡¦ç†ã¯ä¸¦åˆ—å‡¦ç†ã§ã¯ãªã„ã€
- ã€ŒPromise ã¯åŒæœŸå‡¦ç†ã€
- ã€Œasync/await ã¯ Promise ã‚’æ„è­˜ã™ã‚‹ã“ã¨ãªãéžåŒæœŸå‡¦ç†ãŒæ›¸ã‘ã‚‹ã€
- ã€Œawait ã¯éžåŒæœŸå‡¦ç†ã®å®Œäº†ã‚’å¾…ã¤ã€

é–“é•ã„ã§ã¯ãªã„ãŒç¾å®Ÿã®ã™ã¹ã¦ã‚’èªžã£ã¦ã„ãªã„æ–‡è¨€ã€ç•°ãªã‚‹æƒ…å ±ã‚’å¯¾æ¯”ã•ã›ãªã„ã¨èª¤è§£ã‚’æ‹›ãæ–‡è¨€ã€å€‹äººã®ä¸»å¼µã§ã‚ã‚‹æ–‡è¨€ãªã©ã€ãƒˆãƒ©ãƒƒãƒ—ðŸ’£ãŒç››ã‚Šã ãã•ã‚“ã§ã™ã€‚

ç­†è€…ã®ä½“æ„Ÿçš„ã«ã¯ã€å¿…è¦ãªæƒ…å ±ãŒæ¬ è½ã—ã¦ã„ã‚‹ã›ã„ã§èª­è€…å´ã®æŽ¨è«–ã‚„ç›´æ„Ÿçš„ãªç†è§£ã¨çŸ›ç›¾ã—ã¦ã—ã¾ã†ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒå¤šãã€åˆå­¦è€…ã®è¦–ç‚¹ã ã¨ã“ã‚Œã‚‰ã®è¨€è‘‰ã«æƒ‘ã‚ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒéžå¸¸ã«é«˜ã„ã®ã§æ³¨æ„ã—ã¦ãã ã•ã„(ç­†è€…è‡ªèº«ãŒå®Ÿéš›ã«æƒ‘ã‚ã•ã‚ŒãŸçµŒé¨“ãŒã‚ã‚Šã¾ã™)ã€‚
:::

# éžåŒæœŸå‡¦ç†ã®è§£èª¬ã§è¦‹éŽã”ã•ã‚ŒãŒã¡ãªè©±

éžåŒæœŸå‡¦ç†ã®å­¦ç¿’ã«ãŠã„ã¦è¦‹é€ƒã•ã‚ŒãŒã¡ãªã‚‚ã®ã®ï¼‘ã¤ã¨ã—ã¦ "API" ãŒæŒ™ã’ã‚‰ã‚Œã¾ã™ã€‚å®Ÿã¯éžåŒæœŸå‡¦ç†ã®åŸºæœ¬çš„ãªä»•çµ„ã¿ã‚’ç†è§£ã™ã‚‹ãŸã‚ã«ã¯ã“ã® "API" ã®è©±ã‚’æ¬ ã‹ã™ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚

:::message alert
éžåŒæœŸå‡¦ç†ã®å­¦ç¿’ã«ãŠã„ã¦**æœ€ã‚‚ãƒˆãƒ©ãƒƒãƒ—ã¨ãªã‚‹ãƒã‚¤ãƒ³ãƒˆ**ãŒã“ã®è©±ã ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚ãã‚Œæ•…ã«ã“ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã‚’æœ€åˆã«æŒã£ã¦ãã¾ã—ãŸã€‚
:::

éžåŒæœŸå‡¦ç†ã¨ã„ã†ã®ã¯ JavaScript ã®ä¸­ã§ã‚‚æ¯”è¼ƒçš„é«˜åº¦ãªè©±é¡Œã§ã‚ã‚Šã€ãã®ã‚«ãƒ†ã‚´ãƒªã®ä¸­ã ã‘ã§ã‚‚åºƒç¯„å›²ãªå†…å®¹ã‚„çŸ¥è­˜ã‚’æ‰±ã†ãŸã‚ã«ã€Promise ã‚„ async/await ã¨ã„ã£ãŸ ECMAScript(JavaScript ã®è¨€èªžä»•æ§˜) ã®æ©Ÿèƒ½ã«ç›®ãŒè¡ŒããŒã¡ã§ã™ã€‚ãã—ã¦ Promise ã‚’æ‰±ã†è§£èª¬è¨˜äº‹ãªã©ã§ã¯ã€éžåŒæœŸå‡¦ç†å…¨èˆ¬ã®è§£èª¬ã®ãŸã‚ã« `setTimeout()` ã¨ã„ã† API ã‚’ã„ããªã‚Šä½¿ã£ã¦ã—ã¾ã£ã¦ã„ã‚‹ã“ã¨ãŒã‚ˆãã‚ã‚‹ãŸã‚ã€ã“ã® API ãŒä½•ã‚’ã‚„ã£ã¦ã„ã‚‹ã®ã‹ã«ç€ç›®ã—ã¥ã‚‰ã„ã¨ã„ã†å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚

éžåŒæœŸå‡¦ç†ã§ã¯ ECMAScript ã®æ©Ÿèƒ½ã ã‘ã§ãªãã€ã€ŒéžåŒæœŸ API + ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã€ã‚„ã€Œ`await` å¼ + éžåŒæœŸ APIã€ã¨ã„ã†å½¢ã®å‡¦ç†ãŒå¤šãã€ECMAScript ã®è¨€èªžæ©Ÿèƒ½(ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã€Promiseã€async/await ãªã©)ã«éžåŒæœŸ API (`fetch()` ã‚„ `setTimeout()` ãªã©)ã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ãŒã€ŒéžåŒæœŸå‡¦ç†ã€ã®ãƒ™ãƒ¼ã‚·ãƒƒã‚¯ãªè€ƒãˆæ–¹ãƒ»ä½¿ã„æ–¹ã¨ãªã‚Šã¾ã™ã€‚

ãã†ã„ã†è¨³ã§ã€éžåŒæœŸå‡¦ç†ã‚’ç†è§£ã™ã‚‹ã«ã¯éžåŒæœŸ API ã®è©±é¡Œã‚’çµ¶å¯¾ã«æ¬ ã‹ã™ã“ã¨ã¯ã§ãã¾ã›ã‚“ã—ã€ãã® API ã®æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹**ç’°å¢ƒã«æ³¨ç›®ã™ã‚‹ã“ã¨**ãŒé‡è¦ã¨ãªã‚Šã¾ã™ã€‚éžåŒæœŸå‡¦ç†ã®è©±é¡Œã§ç›®ã«ã¤ã Promise ã‚„ async/await ã¨ã„ã£ãŸ ECMAScript ã®è¨€èªžæ©Ÿèƒ½ã ã‘ã‚’è¦‹ã¦ã„ã¦ã‚‚éžåŒæœŸå‡¦ç†ã®ä»•çµ„ã¿ã‚„å®Ÿè¡Œé †åºã«ã¤ã„ã¦ç†è§£ã§ããªã„ã®ã§æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ã¤ã¾ã‚Šã€ã“ã®è©±ãŒéžåŒæœŸå‡¦ç†ã®å­¦ç¿’ã«ãŠã„ã¦æœ€å¤§ã®ç½ ã¨ãªã£ã¦ã„ã‚‹ã¯ **Promise ã‚„ async/await ã®è©±ã ã‘ã‚’è¿½ã£ã¦ã‚‚ã€ŒéžåŒæœŸå‡¦ç†ã«ã¤ã„ã¦ã®è¬Žã€ãŒæ°¸é ã«è§£ã‘ãªã„ã‚ˆã†ãªã‚«ãƒ©ã‚¯ãƒªã¨ãªã£ã¦ã„ã‚‹**ã‹ã‚‰ã§ã™ã€‚

# API ã®æ©Ÿèƒ½ã‚’æä¾›ã™ã‚‹ç’°å¢ƒã«ã¤ã„ã¦

ãã‚‚ãã‚‚ã€JavaScript ã¨ã„ã†ã‚‚ã®ã«ã¯å¸¸ã«å®Ÿè¡Œã™ã‚‹ãŸã‚ã®**ç’°å¢ƒ**(**environment**)ãŒã‚ã‚Šã€ãã®ç’°å¢ƒã«ã‚ˆã£ã¦åˆ©ç”¨ã§ãã‚‹æ©Ÿèƒ½ãŒç•°ãªã‚Šã¾ã™ã€‚ç’°å¢ƒã«ã¯ã„ãã¤ã‚‚ç¨®é¡žãŒã‚ã‚Šã€å„ç’°å¢ƒã§ã®ç›¸é•ç‚¹ã¨ã—ã¦é¡•è‘—ãªã‚‚ã®ãŒç’°å¢ƒã®æä¾›ã™ã‚‹æ©Ÿèƒ½ã§ã‚ã‚‹ API ã§ã™ã€‚

ä¸€æ–¹ã§ã€[JavaScript ã¯ ECMAScript ã¨ã„ã†ä»•æ§˜ã«åŸºã¥ã„ã¦å‹•ä½œãŒå®šã‚ã‚‰ã‚Œã¦ã„ã‚‹ãŸã‚](https://jsprimer.net/basic/introduction/#javascript-ecmascript)ã€å®Ÿè¡Œã™ã‚‹ç’°å¢ƒãŒç•°ãªã£ã¦ã‚‚å…±é€šã™ã‚‹å‹•ä½œãŒã‚ã‚Šã¾ã™ã€‚åˆ¥ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã§è§£èª¬ã—ã¾ã™ãŒã€å®Ÿéš›ã«ã¯ç’°å¢ƒã«åŸ‹ã‚è¾¼ã¾ã‚ŒãŸ JavaScript ã‚¨ãƒ³ã‚¸ãƒ³ãŒã“ã® ECMAScript ã¨ã„ã†ä»•æ§˜ã‚’å®Ÿè£…ã—ã¦ã„ã¾ã™ã€‚ã¨ã„ã†ã“ã¨ã§ã€ã‚ˆã‚Šæ­£ç¢ºã«è¡¨ç¾ã™ã‚‹ãªã‚‰ "ECMAScript ã‚¨ãƒ³ã‚¸ãƒ³" ã¨å‘¼ã¹ã‚‹ä»£ç‰©ã§ã™ã­ã€‚ä¾‹ãˆã° Chrome ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã«åŸ‹ã‚è¾¼ã¾ã‚Œã¦ã„ã‚‹ V8 ã¨ã„ã† JavaScript ã‚¨ãƒ³ã‚¸ãƒ³ã¯ Node ã‚„ Deno ã¨ã„ã£ãŸãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç’°å¢ƒã«ã‚‚åˆ©ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰(ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒ)ã‚„ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰(ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç’°å¢ƒ)ã§ JavaScript ãŒåŒã˜ã‚ˆã†ã«ä½¿ãˆã‚‹ã®ã¯ã“ã® JavaScript ã‚¨ãƒ³ã‚¸ãƒ³ã®ãŠã‹ã’ã§ã™ã€‚

API ã¯ ECMAScript ã¨ã¯ã»ã¨ã‚“ã©é–¢ä¿‚ãªãç’°å¢ƒãŒç‹¬è‡ªã«å®šç¾©ã—ã¦æä¾›ã—ã¦ã„ã‚‹ã‚‚ã®ã§ã™ã€‚ãŸã ã—ã€`setTimeout()` ã‚„  `console.log()` ãªã©æ§˜ã€…ãªç’°å¢ƒã«ãŠã„ã¦åŒã˜åå‰ã§ API ãŒæä¾›ã•ã‚Œã¦ã„ã‚‹å ´åˆãŒã‚ˆãã‚ã‚Šã¾ã™ã€‚å®Ÿéš›ã«ã¯æ©Ÿèƒ½çš„ã«ãã‚Œãžã‚Œå¾®å¦™ã«ç•°ãªã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™(ã“ã®äº‹å®Ÿã«åˆå­¦è€…ã¯æœ€åˆæ°—ã¥ã‘ãšã«æ··ä¹±ã—ã¾ã™)ã€‚

é‡è¦ãªã®ã§å†ç¢ºèªã—ã¾ã™ãŒã€API ã¨ã„ã†ã®ã¯**ç’°å¢ƒã«ç‰¹æœ‰ã®æ©Ÿèƒ½**ã§ã‚ã‚Šã€ECMAScript ã®ä¸€éƒ¨ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

> It turns out that the way we farm out work in JavaScript is **to use environment-specific functions and APIs. And this is a source of great confusion in JavaScript**.
>
> **JavaScript always runs in an environment**.
>
> Often, that environment is the browser. But it can also be on the server with NodeJS. But what on earth is the difference?
>
> The difference â€“ and this is important â€“ is that the browser and the server (NodeJS), functionality-wise, **are not equivalent. They are often similar, but they are not the same**.
> ([Async Await JavaScript Tutorial â€“ How to Wait for a Function to Finish in JS](https://www.freecodecamp.org/news/async-await-javascript-tutorial/) ã‚ˆã‚Šå¼•ç”¨ã€å¤ªå­—ã¯ç­†è€…å¼·èª¿)

ã“ã®ã€Œç’°å¢ƒã€ã§ã™ãŒã€ä¾‹ãˆã°ã€ã“ã®æœ¬ã‚’è¦‹ã¦ã„ã‚‹ Chrome ã‚„ Safari ãªã©ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚‚ç’°å¢ƒã®ï¼‘ã¤ã§ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒä»¥å¤–ã«ã¯ã€Node ã‚„ Deno ãªã©ã®ã‚µãƒ¼ãƒãƒ¼ã‚µã‚¤ãƒ‰ã§ä½¿ãˆã‚‹ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç’°å¢ƒãªã©ã‚‚ã‚ã’ã‚‰ã‚Œã¾ã™ã€‚

- ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒ : Chrome, Safari, Firefox ãªã©
- ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç’°å¢ƒ : Node, Deno ãªã©

API ã«ã‚‚è‰²ã€…ãªç¨®é¡žã¨åˆ†ã‘æ–¹ãŒã‚ã‚Šã¾ã™ãŒã€ãƒ–ãƒ©ã‚¦ã‚¶ã«ã‚ˆã£ã¦æä¾›ã•ã‚Œã‚‹ã‚‚ã®ã¯ MDN ã®ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãƒšãƒ¼ã‚¸ã§ã¯ **Web API** ã¨ã—ã¦å‘¼ã°ã‚Œã¦ã„ã¾ã™ã€‚ã“ã®åå‰ã¯ã‹ãªã‚Šæ··ä¹±ã‚’ç”Ÿã˜ã•ã›ã‚‹ã‚‚ã®ã§ã™ã€‚å®Ÿæ…‹ã¨ã—ã¦ã¯ **Browser API** ã¨å‘¼ã¶ã¹ãã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã«ã‚ˆã£ã¦æä¾›ã•ã‚Œã‚‹ API ã®ã“ã¨ã‚’æŒ‡ã—ã¦ã„ã‚‹å ´åˆãŒå¤šã„ã§ã™ã€‚å¤§æŠµã®å ´åˆã¯ã€Web API ã¨ã„ã£ãŸã‚‰ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒãŒæä¾›ã™ã‚‹æ©Ÿèƒ½ã®ã“ã¨ã ã¨è€ƒãˆã¦ãã ã•ã„ã€‚

https://developer.mozilla.org/ja/docs/Web/API

ã¡ãªã¿ã«ã€ŒWeb APIã€ã‹ã‚‰ç›´æ„Ÿçš„ã«æƒ³èµ·ã™ã‚‹ Web ä¸Šã§æä¾›ã•ã‚Œã¦ã„ã‚‹ API(ä½•ã‚‰ã‹ã® Web ã‚µãƒ¼ãƒ“ã‚¹ã‹ã‚‰æä¾›ã•ã‚Œã‚‹ API)ã¯ MDN ã§ã¯ã€Œ[ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ API(Third-party APIs)](https://developer.mozilla.org/ja/docs/Learn/JavaScript/Client-side_web_APIs/Third_party_APIs)ã€ã¨ã—ã¦å‘¼ã°ã‚Œã¦ã„ã¾ã™ã€‚

:::message
ã“ã®æœ¬ã§åº¦ã€…åˆ©ç”¨ã™ã‚‹ URL ã§ã‚ã‚‹ `https://api.github.com/zen` ã§ã™ãŒã€ã“ã‚Œã¯ GitHub ã‹ã‚‰æä¾›ã•ã‚Œã¦ã„ã‚‹ [Zen of GitHub](https://docs.github.com/en/rest/meta#get-the-zen-of-github) ã¨ã„ã†ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ API ã®ï¼‘ã¤ã§ã€GitHub ã®è¨­è¨ˆæ€æƒ³ã‹ã‚‰ãƒ©ãƒ³ãƒ€ãƒ ã«ï¼‘ã¤æ–‡ã‚’å–å¾—ã§ãã‚‹ã¨ã„ã†ã‚‚ã®ã§ã™ã€‚ã“ã®ã‚¿ã‚¤ãƒ—ã® API ã¯ [RESTful API](https://developer.mozilla.org/ja/docs/Glossary/REST) ã‚ã‚‹ã„ã¯ REST API ã¨å‘¼ã°ã‚Œã‚‹ç¨®é¡žã®ã‚‚ã®ã§ã€ç‰¹å®šã® URL ã« HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’è¡Œã£ã¦ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’è¡Œã†ã“ã¨ã§ãã¾ã™ã€‚
:::

ä¸Šè¨˜ã®ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãƒšãƒ¼ã‚¸ã§ã¯ãƒ–ãƒ©ã‚¦ã‚¶ API ã®ã“ã¨ã‚’ Web API ã¨èª­ã‚“ã§ã„ã‚‹ãŸã‚æ··ä¹±ã—ã¦ã—ã¾ã„ã¾ã™ãŒã€ä»¥ä¸‹ã® MDN ã®å­¦ç¿’ãƒšãƒ¼ã‚¸ã§ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã«ãŠã‘ã‚‹ API ã«ã¤ã„ã¦ãƒ–ãƒ©ã‚¦ã‚¶ API ã¨ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ API ã¨ã„ã†ï¼’ã¤ã®ã‚«ãƒ†ã‚´ãƒªã«åˆ†ã‘ã‚‰ã‚Œã‚‹ã¨ã—ã£ã‹ã‚Šè§£èª¬ã•ã‚Œã¦ã„ã‚‹ã®ã‚’è¦‹ã¤ã‘ãŸã®ã§è©³ã—ãçŸ¥ã‚ŠãŸã„å ´åˆã«ã¯å‚ç…§ã—ã¦ãã ã•ã„ã€‚

https://developer.mozilla.org/ja/docs/Learn/JavaScript/Client-side_web_APIs/Introduction

ä¸€æ–¹ã€ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç’°å¢ƒã§æä¾›ã•ã‚Œã‚‹ API ã«ã¤ã„ã¦ã¯ã“ã®æœ¬ã§ã¯ä¾¿å®œçš„ã«ã¾ã¨ã‚ã¦ Runtime API ã¨ã—ã¦å‘¼ç§°ã—ã¾ã™ã€‚

Web API ã¨ Runtime API ã«ã¯ãã‚Œãžã‚ŒåŒæœŸåž‹ã® API ã¨éžåŒæœŸåž‹ã® API ãŒå­˜åœ¨ã—ã¦ã„ã¾ã™ã€‚ä¾‹ãˆã°ã€`setTimeout()` ãŒéžåŒæœŸã® API ã§ã™ã€‚Nodeã€Denoã€Chrome ãªã©ã®å®Ÿè¡Œç’°å¢ƒã«é–¢ã‚ã‚‰ãšåŒã˜åå‰ã® API ã¨ã—ã¦ `setTimeout()` ãŒæä¾›ã•ã‚Œã¦ãŠã‚Šä½¿ã„å‹æ‰‹ã‚‚ã»ã¨ã‚“ã©åŒã˜ã§ã™ãŒã€ãã‚Œã‚‰ã¯ç’°å¢ƒãŒç‹¬è‡ªã«å®šç¾©ã—ã¦ã„ã‚‹ã“ã¨ã«æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

ä¾‹ãˆã°ã€Node ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ãŠã„ã¦ã€Œ`setTimeout()` ã¯ãƒ–ãƒ©ã‚¦ã‚¶ API ã‚’æ¨¡å€£ã—ã¦ã„ã‚‹ãŒã€[å¾®å¦™ã«å®Ÿè£…ãŒç•°ãªã‚‹](https://nodejs.org/en/docs/guides/timers-in-node/#controlling-the-time-continuum-with-node-js)ã€ã¨ã„ã†ã“ã¨ãŒå®Ÿéš›ã«è¿°ã¹ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚

:::message
ã¡ãªã¿ã« Deno ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç’°å¢ƒã§æä¾›ã•ã‚Œã‚‹ Runtime API ã¯å¤§ããä»¥ä¸‹ã®ï¼’è¦ç´ ã§æˆã‚Šç«‹ã£ã¦ã„ã¾ã™ã€‚

- 1. [Web Platform APIs](https://deno.land/manual/runtime/web_platform_apis): `fetch()` ã®ã‚ˆã†ãª Web APIs ã¨åŒã˜åå‰ã€åŒã˜ä½¿ã„å‹æ‰‹ã«ãªã‚‹ã‚ˆã†ã«æä¾›ã•ã‚Œã¦ã„ã‚‹ API ç¾¤
- 2. Deno global: éžåŒæœŸ I/O ãªã©ã«é–¢ã™ã‚‹ Deno ç’°å¢ƒã§ã®å®Œå…¨ç‹¬è‡ªå®šç¾©ã® API ç¾¤(global ã® `Deno` ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã«å«ã¾ã‚Œã‚‹ `Deno.readFile()` ã¨ã„ã†ã‚ˆã†ã« `Deno` ã‹ã‚‰å§‹ã¾ã‚‹åå‰ã®é–¢æ•°ãªã©)

å‚è€ƒ: [The Runtime | Manual | Deno](https://deno.land/manual/runtime)
:::

JavaScript ã¯å…ƒã€…ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã§ã®ã¿ä½¿ã‚ã‚Œã‚‹è¨€èªžã ã£ãŸã®ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã®æä¾›ã™ã‚‹ Web API æ­´å²ã®æ–¹ãŒé•·ã„è¨³ã§ã™ã€‚å¾“ã£ã¦ã€Node ã‚„ Deno ã¨ã„ã£ãŸãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç’°å¢ƒã§ã¯ã“ã® Web API ã‚’åŒã˜ä½¿ã„å‹æ‰‹ã®åŒã˜åå‰ã§é–‹ç™ºè€…ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ç”¨æ„ã—ã¦ãã‚Œã¦ã„ã¾ã™ã€‚Console API ã® `console.log()` ãƒ¡ã‚½ãƒƒãƒ‰ãŒåˆ†ã‹ã‚Šã‚„ã™ã„ã§ã—ã‚‡ã†ã€‚ã“ã® `console.log()` ã¯åŸºæœ¬çš„ã«ã©ã‚“ãªç’°å¢ƒã§ã‚‚ä½¿ãˆã¾ã™ã€‚ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç’°å¢ƒã¯ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã§èµ°ã‚‹ JavaScript ã¨ã®äº’æ›æ€§ã‚’é«˜ã‚ã¦ã€JavaScript ãƒ—ãƒ­ã‚°ãƒ©ãƒžãƒ¼ãŒã‚ã‚‹ç¨‹åº¦åŒã˜ä½¿ã„å‹æ‰‹ã®ã‚‚ã¨ã—ã¦æœŸå¾…ã—ã¦ä½¿ãˆã‚‹ã‚ˆã†ã«æº–å‚™ã—ã¦ãã‚Œã¦ã„ã‚‹è¨³ã§ã™ã€‚

ãŸã ã—ã€ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã¨ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç’°å¢ƒã§ Web API(ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç’°å¢ƒã§ã¯ Web Platform API ã¨å‘¼ã°ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹) ã®äº’æ›æ€§ãŒã‚ã‚‹ç¨‹åº¦ã‚ã£ãŸã¨ã—ã¦ã‚‚ã€ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã«ç„¡ã„ã‚ˆã†ãª API(Deno ãªã‚‰ Deno globals) ã«ã¤ã„ã¦ã¯ãã‚Œãžã‚Œã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç’°å¢ƒãŒç‹¬è‡ªã«å®šç¾©ã—ã¦ã„ã‚‹ãŸã‚ã«åŸºæœ¬çš„ã«ã¯äº’æ›æ€§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚Node ã‚„ Deno ã§ã¯ãã†ã„ã£ãŸ API ã®åå‰ã‚„è¨­è¨ˆæ€æƒ³ã®ç•°ãªã‚‹ç‚¹ãŒã‚ã‚Šã¾ã™ã‹ã‚‰ã­ã€‚

ã¡ãªã¿ã«ã€æœ€è¿‘ã«ãªã£ã¦ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç’°å¢ƒé–“ã§ã® Web API ã®äº’æ›æ€§ã‚’é«˜ã‚ã‚‹ç›®çš„ã§ [WinterCG(Web-interoperable Runtimes Community Group)](https://wintercg.org)ã¨ã„ã†å›£ä½“ãŒç™ºè¶³ã—ã¾ã—ãŸã€‚ã‚µãƒ¼ãƒãƒ¼ãƒ©ãƒ³ã‚¿ã‚¤ãƒ (Deno / Node.js) ã¨ã‚¨ãƒƒã‚¸ãƒ©ãƒ³ã‚¿ã‚¤ãƒ (Cloudflare Workers / Deno)ã®ç’°å¢ƒé–“ã§ Web Platform API (`fetch()` ã‚„ `setTimeout()` ã‚„ `queueMicrotask()` ãªã©)ã®[äº’æ›æ€§ã‚’é«˜ã‚ã‚ˆã†ã¨ã„ã†ã®ãŒç›®çš„](https://wintercg.org/faq#what-are-we-trying-to-do)ã§ã™ã€‚é–‹ç™ºè€…ã¯ä»Šå¾Œã€ã‚ˆã‚Šäº’æ›æ€§ã®é«˜ã„ JavaScript ã§é–‹ç™ºãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã¨æœŸå¾…ã§ãã¾ã™ã€‚

# ã€ŒéžåŒæœŸå‡¦ç†ã€ã®ç›®çš„ã¨ä»•çµ„ã¿

ç’°å¢ƒã¨ API ã«ã¤ã„ã¦ã®äºˆå‚™çŸ¥è­˜ã‚’å…¥ã‚ŒãŸã®ã§ã€ã“ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã®æœ¬é¡Œã§ã‚ã‚‹ã€ŒéžåŒæœŸå‡¦ç†ã®ç›®çš„ã€ã«ã¤ã„ã¦è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚

ãã‚‚ãã‚‚ã€ŒéžåŒæœŸå‡¦ç†ã€ã§ã™ãŒã€ã‚ã–ã‚ã–**å®Ÿè¡Œã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’ãšã‚‰ã—ã¦**ã€éžåŒæœŸçš„ã«ä½•ã‹ã‚’ã™ã‚‹å¿…è¦ãŒãªãœã‚ã‚‹ã®ã§ã—ã‚‡ã†ã‹ï¼Ÿ

:::message alert
ã€ŒéžåŒæœŸã€ã®æ¦‚å¿µãã®ã‚‚ã®ã«ã¤ã„ã¦ã¯ã“ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã®æœ€å¾Œã§è§£èª¬ã—ã¾ã™ã€‚ä»Šã¯å®Ÿè¡Œã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒã‚³ãƒ¼ãƒ‰ã®é…ç½®ã¨ãšã‚Œã¦ã—ã¾ã†å‡¦ç†ã®ã“ã¨ã‚’æŒ‡ã—ã¦ã„ã‚‹ã¨è€ƒãˆã¦ãã ã•ã„ã€‚ã€ŒåŒæœŸã€ã‚‚ã“ã®æ™‚ç‚¹ã§ã¯ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®é…ç½®ã¨å®Ÿè¡Œã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒãšã‚Œãªã„ã‚‚ã®ã§ã‚ã‚‹ã¨è€ƒãˆã¦ãã ã•ã„ã€‚
:::

ã“ã“ã§ã€éžåŒæœŸ API ã§ã‚ã‚‹ `fetch()` ãƒ¡ã‚½ãƒƒãƒ‰ã«ã¤ã„ã¦è€ƒãˆã¦ã¿ã¾ã—ã‚‡ã†ã€‚`fetch()` ã¯å¼•æ•°ã« URL ã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æŽ¥ç¶šã‚’ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ãã¾ã™ã€‚ã—ã‹ã—ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æŽ¥ç¶šã¨ã„ã†ã®ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æŠ•ã’ã¦å¿œç­”ãŒã‚ã‚‹ã¾ã§æ™‚é–“ãŒã‹ã‹ã‚‹ã‚‚ã®ã§ã™ã€‚

ã¨ã“ã‚ã§ã€JavaScript ã¯ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰è¨€èªžã§ã‚ã‚Šã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã¯**ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰(å˜ä¸€ã®ã‚¹ãƒ¬ãƒƒãƒ‰)ã§å®Ÿè¡Œ**ã•ã‚Œã¾ã™ã€‚ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œã•ã‚Œã‚‹ã¨ã¯ã¤ã¾ã‚Šã€**å˜ä¸€ã‚³ãƒ¼ãƒ«ã‚¹ã‚¿ãƒƒã‚¯(single callstack)ã§å®Ÿè¡Œã•ã‚Œã‚‹** ã¨ã„ã†ã“ã¨ã§ã™(ã“ã‚Œã«ã¤ã„ã¦ã¯åˆ¥ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã€Ž[ã‚³ãƒ¼ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ã¨å®Ÿè¡Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ](b-epasync-callstack-execution-context)ã€ã§è§£èª¬ã—ã¾ã™)ã€‚ã“ã®ã€Œã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã€ã§ã™ãŒã€ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã®æ–‡è„ˆã§è¨€ãˆã° JavaScript ã¯**ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰**(Main thread))å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚

JavaScript ã¯ã€Œã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰(å˜ä¸€ã®ã‚¹ãƒ¬ãƒƒãƒ‰)ã§å®Ÿè¡Œã•ã‚Œã‚‹ã€ã‚ã‘ã§ã™ã‹ã‚‰ã€ã“ã®"ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰"ã¨ã‚„ã‚‰ã‚’é•·æ™‚é–“å°‚æœ‰ã—ã¦ã—ã¾ã†ã‚ˆã†ãªå‡¦ç†ãŒã‚ã‚‹ã¨ã€ãã®é–“ã¯ä½•ã‚‚ã§ããªããªã£ã¦ã—ã¾ã†ã‚ã‘ã§ã™ã€‚å®Ÿéš›ã«é•·æ™‚é–“ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’å°‚æœ‰ã™ã‚‹ã“ã¨ã‚’ã€Œ**ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°(blocking)**ã€ã¨è¨€ã„ã¾ã™ã€‚

ã¡ãªã¿ã«ã€ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰(Main thread)ã«ã¤ã„ã¦ã¯ MDN ã§æ¬¡ã®ã‚ˆã†ã«èª¬æ˜Žã•ã‚Œã¦ã„ã¾ã™ã€‚

> ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ãŒãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚„æç”»ã‚’å‡¦ç†ã™ã‚‹ã¨ã“ã‚ã§ã™ã€‚æ—¢å®šã§ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ã¯å˜ä¸€ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ãƒšãƒ¼ã‚¸å†…ã®ã™ã¹ã¦ã® JavaScript ã‚’ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€å†ãƒ•ãƒ­ãƒ¼ã€ã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ãªã©ã¨åŒæ§˜ã«å®Ÿè¡Œã—ã¾ã™ã€‚ã¤ã¾ã‚Šã€**å®Ÿè¡Œã«æ™‚é–“ãŒã‹ã‹ã‚‹ JavaScript é–¢æ•°ãŒã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ãƒ–ãƒ­ãƒƒã‚¯ã—ã€ãƒšãƒ¼ã‚¸ãŒåå¿œã—ãªããªã‚Šã€ä½¿ã„å‹æ‰‹ãŒæ‚ªããªã‚Šã¾ã™**ã€‚
> ([Main thread (ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰) - MDN Web Docs ç”¨èªžé›†: ã‚¦ã‚§ãƒ–é–¢é€£ç”¨èªžã®å®šç¾© | MDN](https://developer.mozilla.org/ja/docs/Glossary/Main_thread) ã‚ˆã‚Šå¼•ç”¨ã€å¤ªå­—ã¯ç­†è€…å¼·èª¿)

`fetch()` ã®è©±ã«æˆ»ã‚Šã¾ã™ãŒã€ã¨ã„ã†ã“ã¨ã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æŽ¥ç¶šã¨ã„ã†æ™‚é–“ã®ã‹ã‹ã‚‹å‡¦ç†ã‚’ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã§è¡Œã£ã¦ã—ã¾ã£ãŸã‚‰ã€ãã®æœ€ä¸­ã«ã¯ä½•ã‚‚ã§ããªããªã£ã¦ã—ã¾ã„ã¾ã™ã€‚ãƒ–ãƒ©ã‚¦ã‚¶ãªã‚‰ã‚¯ãƒªãƒƒã‚¯ã‚„ãƒ†ã‚­ã‚¹ãƒˆé¸æŠžã¨ã„ã£ãŸæ“ä½œãªã©ã¯ä½•ã‚‚ã§ãã¾ã›ã‚“ã€‚ã¾ãŸã€å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦ä½•ã‹ã‚’ã—ãŸã„å ´åˆã‚‚ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ãã‚‹ã¾ã§ã¯ãã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã£ãŸå‡¦ç†ã¯ä½•ã‚‚ã§ãã¾ã›ã‚“ã€‚

ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã§ã¯ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°å‡¦ç†ã‚„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãªã©ã‹ã‚‰ç™ºç«ã•ã‚Œã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã®å‡¦ç†ã‚‚ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã§è¡Œã‚ã‚Œã¦ã„ã¾ã™ã€‚ã‚‚ã—ã‚‚ `fetch()` ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã‚„ã£ã¦ã—ã¾ã£ãŸã‚‰ã€ãã‚Œã“ããƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ãŒèµ·ãã‚‹ã¯ãšã§ã€ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ãŒèµ·ãã¦ã„ã‚‹é–“ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒ†ã‚­ã‚¹ãƒˆé¸æŠžã‚„ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯ã¨ã„ã£ãŸæ“ä½œã¯ä½•ã‚‚ã§ããªã„æ™‚é–“ãŒã§ãã¦ã—ã¾ã„ã¾ã™ã€‚

ãã†ã„ã†è¨³ã§ `fetch()` ã§ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æŽ¥ç¶šã¨ã„ã£ãŸæ™‚é–“ãŒã‹ã‹ã‚‹ API ã¨ã—ã¦æä¾›ã•ã‚Œã¦ã‚‹å‡¦ç†ãã®ã‚‚ã®ã«ã¤ã„ã¦ JavaScript ã‚¨ãƒ³ã‚¸ãƒ³(ã‚³ãƒ¼ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ã‚’ç®¡ç†ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ)ã¯ç›´æŽ¥é–¢ä¸Žã—ã¾ã›ã‚“ã€‚ãã®ã‚¨ãƒ³ã‚¸ãƒ³ã‚’åŸ‹ã‚è¾¼ã‚“ã§ã„ã‚‹ç’°å¢ƒãŒè£å´ã§ãã®å‡¦ç†ã‚’ä»£ã‚ã‚Šã«è¡Œã£ã¦ãã‚Œã¦ã„ã¾ã™ã€‚

ãƒ‡ãƒ¼ã‚¿ãŒå–å¾—ã§ããŸã‚‰ã‚³ãƒ¼ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ã«ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã®å½¢ã§**å–å¾—ãƒ‡ãƒ¼ã‚¿ã¨å…±ã«é€šçŸ¥ã•ã›ã¦**ã€ãã®ãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã†å‡¦ç†ã‚’ãã®æ™‚ç‚¹ã§è¡Œãˆã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚ã“ã‚ŒãŒéžåŒæœŸå‡¦ç†ã§ã™ã€‚

éžåŒæœŸå‡¦ç†ã¯ä¸¦åˆ—å‡¦ç†ã¨ã‚ˆãå‹˜é•ã„ã•ã‚Œã‚‹ãŸã‚ã«ã€ã€Œ**éžåŒæœŸå‡¦ç†ã¯ä¸¦åˆ—å‡¦ç†ã§ã¯ãªã„**ã€ã¨ã„ã†æ³¨æ„æ›¸ãã‚„ã€ã€Œ**JavaScript ã¯ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œã•ã‚Œã‚‹**ã€ã¨ã„ã†ã“ã¨ãŒå¼·èª¿ã•ã‚ŒãŒã¡ã§ã™ã€‚

ã“ã‚Œã‚‰ã®å‘½é¡Œã¯ç¢ºã‹ã«çœŸå®Ÿã§ã¯ã‚ã‚Šã¾ã™ãŒã€**ç¾å®Ÿã®ã™ã¹ã¦ã‚’èªžã£ã¦ã¯ã„ã¾ã›ã‚“**ã€‚

`fetch(url)` ã®ä»–ã«ã‚‚éžåŒæœŸ API ã¨ã—ã¦ä¸Šã§æŒ™ã’ãŸ `setTimeout(callback, delay)` ã¨ã„ã†æŒ‡å®šæ™‚é–“ãŒçµŒéŽã—ãŸã‚‰ç™»éŒ²ã—ã¦ãŠã„ãŸã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã„ã†ã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯ã€ç¬¬ä¸€å¼•æ•°ã«æ¸¡ã—ãŸã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ãŒæŒ‡å®šæ™‚é–“å¾Œã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã™ã‚‹è¨³ã§ã™ã‹ã‚‰ã€**ä¸¦è¡Œ(concurrent)å‡¦ç†**ã§ã‚ã‚‹ã¨ã¿ãªã›ã¾ã™ã€‚ãã—ã¦ã€ã“ã® API ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€æŒ‡å®šæ™‚é–“ãŒçµŒéŽã™ã‚‹ã¾ã§ã®é–“ã«**ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã¯åˆ¥ã®ã“ã¨ãŒã§ãã¾ã™**ã€‚ã§ã™ãŒã€Œæ™‚é–“ã‚’å›³ã‚‹ã€ã¨ã„ã†ä½œæ¥­ã‚’ã—ã¤ã¤åˆ¥ã®ã“ã¨ãŒã§ãã‚‹ã®ã¯ãªãœã§ã—ã‚‡ã†ã‹ï¼Ÿ

ä¾‹ãˆã°ã€æ¬¡ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ã€ã‚¿ã‚¤ãƒžãƒ¼ã‚’é †ç•ªã«èµ·å‹•ã—ã¾ã™ãŒã€‚ã‚¿ã‚¤ãƒžãƒ¼è‡ªä½“ã®ã€Œæ™‚é–“ã‚’å›³ã‚‹ã€ã¨ã„ã†ä½œæ¥­ãŒçµ‚ã‚ã£ã¦ã„ãªã„ã«ã‚‚é–¢ã‚ã‚‰ãšæ¬¡ã®ã‚¿ã‚¤ãƒžãƒ¼ã‚’èµ·å‹•ã§ããŸã‚Šã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã—ãŸã‚Šã§ãã‚‹ã®ã¯ä½•æ•…ã§ã—ã‚‡ã†ã‹ï¼Ÿ

```js:parallelTimer
// ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’ã‚¢ãƒ­ãƒ¼é–¢æ•°ã§å®šç¾©
setTimeout(() => {
  console.log("[A] ä¸¦åˆ—çš„ãªã‚¿ã‚¤ãƒžãƒ¼");
}, 1000);
console.log("ä¸Šã®ã‚¿ã‚¤ãƒžãƒ¼å‡¦ç†ãŒçµ‚ã‚ã£ã¦ã„ãªã„ã®ã«ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¸å‡ºåŠ›ã—ã€æ¬¡ã®ã‚¿ã‚¤ãƒžãƒ¼ã‚’èµ·å‹•");

setTimeout(() => {
  console.log("[B] ä¸¦åˆ—çš„ãªã‚¿ã‚¤ãƒžãƒ¼");
}, 1500);
console.log("ä¸Šã®ã‚¿ã‚¤ãƒžãƒ¼å‡¦ç†ãŒçµ‚ã‚ã£ã¦ã„ãªã„ã®ã«ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¸å‡ºåŠ›ã—ã€æ¬¡ã®ã‚¿ã‚¤ãƒžãƒ¼ã‚’èµ·å‹•");

setTimeout(() => {
  console.log("[C] ä¸¦åˆ—çš„ãªã‚¿ã‚¤ãƒžãƒ¼");
}, 500);
console.log("ä¸Šã®ã‚¿ã‚¤ãƒžãƒ¼å‡¦ç†ãŒçµ‚ã‚ã£ã¦ã„ãªã„ã®ã«ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¸å‡ºåŠ›");

console.log("ã‚¿ã‚¤ãƒžãƒ¼ã‚’èµ·å‹•ã—ã¦ã„ã‚‹ã®ã«ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ãŒã§ãã¦ã—ã¾ã†");
```

å®Ÿéš›ã«ã“ã®ã‚³ãƒ¼ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨æ¬¡ã®å‡ºåŠ›ã‚’å¾—ã¾ã™ã€‚

```sh
â¯ deno run parallelTimer.js
ä¸Šã®ã‚¿ã‚¤ãƒžãƒ¼å‡¦ç†ãŒçµ‚ã‚ã£ã¦ã„ãªã„ã®ã«ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¸å‡ºåŠ›ã—ã€æ¬¡ã®ã‚¿ã‚¤ãƒžãƒ¼ã‚’èµ·å‹•
ä¸Šã®ã‚¿ã‚¤ãƒžãƒ¼å‡¦ç†ãŒçµ‚ã‚ã£ã¦ã„ãªã„ã®ã«ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¸å‡ºåŠ›ã—ã€æ¬¡ã®ã‚¿ã‚¤ãƒžãƒ¼ã‚’èµ·å‹•
ä¸Šã®ã‚¿ã‚¤ãƒžãƒ¼å‡¦ç†ãŒçµ‚ã‚ã£ã¦ã„ãªã„ã®ã«ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¸å‡ºåŠ›
ã‚¿ã‚¤ãƒžãƒ¼ã‚’èµ·å‹•ã—ã¦ã„ã‚‹ã®ã«ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ãŒã§ãã¦ã—ã¾ã†
[C] ä¸¦åˆ—çš„ãªã‚¿ã‚¤ãƒžãƒ¼
[A] ä¸¦åˆ—çš„ãªã‚¿ã‚¤ãƒžãƒ¼
[B] ä¸¦åˆ—çš„ãªã‚¿ã‚¤ãƒžãƒ¼
```

`setTimeout()` ã«ã¤ã„ã¦ã¯ã€Ž[ã‚¿ã‚¹ã‚¯ã‚­ãƒ¥ãƒ¼ã¨ãƒžã‚¤ã‚¯ãƒ­ã‚¿ã‚¹ã‚¯ã‚­ãƒ¥ãƒ¼](d-epasync-task-microtask-queues#settimeout-api)ã€ã§è©³ã—ãè§£èª¬ã—ã¾ã™ãŒã€ã“ã®ã‚ˆã†ãªã‚¿ã‚¤ãƒžãƒ¼ã«ã‚ˆã£ã¦ã€Œæ™‚é–“ã‚’æ¸¬ã‚‹ã€ã¨ã„ã†ã“ã¨ã¯æ˜Žã‚‰ã‹ã«ä½œæ¥­ã§ã™ã€‚æ™‚é–“ã‚’å›³ã‚‹ä½œæ¥­ãŒãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã§è¡Œã‚ã‚Œã¦ã„ãŸã‚‰**ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã¯ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ã•ã‚Œã¦ãã®é–“ã¯ä½•ã‚‚ã§ãã¾ã›ã‚“**ã€‚ã‚‚ã—ãã†ãªã‚‰ã‚¿ã‚¤ãƒžãƒ¼ã®å‡¦ç†ãªã©ã»ã¼æ„å‘³ãŒã‚ã‚Šã¾ã›ã‚“ã­ã€‚

```js
// ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’ã‚¢ãƒ­ãƒ¼é–¢æ•°ã§å®šç¾©
setTimeout(() => {
  console.log("[2] 1000ãƒŸãƒªç§’æ¸¬ã‚‹ã‚¿ã‚¤ãƒžãƒ¼");
}, 1000);
// ã‚‚ã—ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ã•ã‚Œã¦ã„ãŸã‚‰æ¬¡ã®å‡¦ç†ã¯ã‚¿ã‚¤ãƒžãƒ¼ãŒçµ‚ã‚ã£ã¦ã‹ã‚‰ã§ãªã„ã¨å®Ÿè¡Œã§ããªã„
consle.log("[1] å®Ÿéš›ã«ã¯æ™‚é–“ã‚’å›³ã‚Šã¤ã¤ä»–ã®ã“ã¨ãŒã§ãã‚‹");

/* ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¸ã®å‡ºåŠ›ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚‹
[1] å®Ÿéš›ã«ã¯æ™‚é–“ã‚’å›³ã‚Šã¤ã¤ä»–ã®ã“ã¨ãŒã§ãã‚‹
[2] 1000ãƒŸãƒªç§’æ¸¬ã‚‹ã‚¿ã‚¤ãƒžãƒ¼
*/
```

ç¾å®Ÿã§ã¯ã€æ™‚é–“ã‚’å›³ã‚‹ã¨ã„ã†ä½œæ¥­ã‚’ã—ã¤ã¤ä»–ã® JavaScript ã‚³ãƒ¼ãƒ‰ã‚’å‡¦ç†ã—ã¦ã„ã‚‹ã‚ã‘ã§ã€æ˜Žã‚‰ã‹ã«**åŒæ™‚ã«è¤‡æ•°ã®ã“ã¨ã‚’ã‚„ã£ã¦ã„ã‚‹**ã‚ã‘ã§ã™ã€‚ã“ã‚Œã‚’ç„¡è¦–ã™ã‚‹ã¨å¤§ããªæ··ä¹±ã‚’å¼•ãèµ·ã“ã™ä¸Šã«èª¬æ˜Žãƒ­ã‚¸ãƒƒã‚¯ãŒçŸ›ç›¾ã—ã¦ã—ã¾ã„ã¾ã™ã€‚

ã¨ã„ã†ã‚ã‘ã§ã€æ™‚é–“ã‚’æ¸¬ã‚‹ã¨ã„ã†ä½œæ¥­ã‚„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚’ä»‹ã—ãŸãƒ‡ãƒ¼ã‚¿å–å¾—ãªã©ã®è¡Œç‚ºã¯å®Ÿã¯ API ã‚’ä»‹ã—ã¦**ç’°å¢ƒãŒä»£ã‚ã‚Šã«ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ä¸¦åˆ—çš„ã«è¡Œã£ã¦ãã‚Œã¾ã™**ã€‚ã¤ã¾ã‚Šã€ API ã®å‘¼ã³å‡ºã—ã¯**ç’°å¢ƒã¸ä½œæ¥­ã‚’å§”ä»»(delegate)ã™ã‚‹ã¨ã„ã†è¡Œç‚º**ã ã£ãŸè¨³ã§ã™ã€‚

:::message
å¼•ç”¨ã® freecodecamp ã®è¨˜äº‹ã§è§£èª¬ã•ã‚Œã¦ã„ã¾ã™ãŒã€ä¾‹ãˆã°ã‚¸ãƒ£ã‚°ãƒªãƒ³ã‚°ã‚’ã—ã¦ã„ã¦ä¸¡æ‰‹ãŒãµã•ãŒã£ã¦ã„ã‚‹æœ€ä¸­ã«æ–°ã—ããƒœãƒ¼ãƒ«ã‚’è¿½åŠ ã—ã‚ˆã†ã¨ã—ãŸã‚‰ã€èª°ã‹ã«æ‰‹ä¼ã£ã¦ã‚‚ã‚‰ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä¸€äººã§ã¯åŒæ™‚ã«è¤‡æ•°ã®ã“ã¨ãŒã§ããªãã¦ã‚‚ã€èª°ã‹ã«ä½œæ¥­ã‚’å§”ä»»(delegate)ã—ã¦æ‰‹ä¼ã£ã¦ã‚‚ã‚‰ã†ã“ã¨ã§ã€åŠ¹çŽ‡ã‚ˆãä½œæ¥­ã‚’ã™ã™ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

> The solution? **Delegate the work to a friend or family member**. They aren't juggling, so they can go and get the ball for you, then toss it into your juggling at a time when your hand is free and you are ready to add another ball mid-juggle.
> (ä¸­ç•¥)
> **It turns out that it is the environment that takes on the work, and the way to get the environment to do that work, is to use functionality that belongs to the environment**. For example fetch or setTimeout in the browser environment.
> ([Async Await JavaScript Tutorial â€“ How to Wait for a Function to Finish in JS](https://www.freecodecamp.org/news/async-await-javascript-tutorial/) ã‚ˆã‚Šå¼•ç”¨ã€å¤ªå­—ã¯ç­†è€…å¼·èª¿)

ãã—ã¦ã€JavaScript ã®æ–‡è„ˆã§è¨€ãˆã°ã€ä½œæ¥­ã‚’æ‰‹ä¼ã£ã¦ãã‚Œã‚‹ã®ãŒã€Œç’°å¢ƒã€ã¨ã„ã†ã‚ã‘ã§ã™ã€‚å®Ÿéš›ã«ã‚¸ãƒ£ã‚°ãƒªãƒ³ã‚°ã—ã¦ã„ã‚‹ã®ã¯ã€ŒRuntime(JavaScript ã‚¨ãƒ³ã‚¸ãƒ³)ã€ã§ã‚ã‚Šã€ãã®ä½œæ¥­ã‚’æ‰‹ä¼ã£ã¦ãã‚Œã‚‹ã®ãŒã€Œç’°å¢ƒ(ã®ã©ã“ã‹ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ)ã€ã§ã™ã€‚
:::

ã•ã¦ã€JavaScript ã¯ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œã•ã‚Œã‚‹[^ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰å®Ÿè¡Œ]ã¯ãšã§ã—ãŸãŒã€ã“ã®ã‚ˆã†ã«éžåŒæœŸ API ã‚’ä»‹ã—ã¦**åŒæ™‚ã«è¤‡æ•°ã®ã“ã¨ãŒã§ãã‚‹**ã®ã¯ã€**ç’°å¢ƒãŒ JavaScript ã‚¨ãƒ³ã‚¸ãƒ³ã ã‘ã§ã¯ãªãè‰²ã€…ãªã‚‚ã®ã‚’æ©Ÿèƒ½ã¨ã—ã¦æŒã£ã¦ã„ã‚‹ã‹ã‚‰ã§ã™**ã€‚ãã—ã¦**ç’°å¢ƒã¯ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ãªã©ã§ã¯ã‚ã‚Šã¾ã›ã‚“**ã€‚

  [^ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰å®Ÿè¡Œ]: JavaScript ã®éžåŒæœŸå‡¦ç†ã«ãŠã„ã¦ã€Œã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã®å®Ÿè¡Œã€ãŒã‚„ãŸã‚‰å¼·èª¿ã•ã‚Œã‚‹èƒŒæ™¯ã¯ä»–ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªžã§ã®éžåŒæœŸã®ä»•çµ„ã¿ã¨ã®æ¯”è¼ƒã‹ã‚‰æ¥ã¦ã„ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ã§ã™ã€‚

ä¾‹ãˆã° Chrome ã¨ã„ã£ãŸãƒ¢ãƒ€ãƒ³ãªãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã‚’ä»£è¡¨ã¨ã—ã¦è€ƒãˆã‚‹ã¨ Chrome ãƒ–ãƒ©ã‚¦ã‚¶ã¯ãã‚‚ãã‚‚æ§˜ã€…ãªã‚¿ã‚¹ã‚¯ã‚’è¡Œã£ã¦ãŠã‚Šã€ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ãªã©ã§ã¯ãªãã€**ãƒžãƒ«ãƒãƒ—ãƒ­ã‚»ã‚¹ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**ã§ã™ã€‚ãã®ä¸­ã§ã¯æ§˜ã€…ãªã‚¿ã‚¹ã‚¯ã®è²¬å‹™ã‚’æŒã¤åˆ†é›¢ã—ãŸãƒ—ãƒ­ã‚»ã‚¹ã®ä¸­ã«è¤‡æ•°ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’æŒã¤å½¢ã«ãªã£ã¦ã„ã¾ã™ã€‚

https://developer.chrome.com/blog/inside-browser-part2/

Chrome ã§ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãã‚Œãžã‚Œãƒ–ãƒ©ã‚¦ã‚¶ã®ç•°ãªã‚‹æ©Ÿèƒ½ã‚’æ‹…å½“ã™ã‚‹è¤‡æ•°ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒä½œæˆã•ã‚Œã¾ã™ã€‚

- Browser process
- Renderer process
- GPU process
- Plugin process
- Extensions process
- Utility process

å®Ÿéš›ã€JavaScript ã®éžåŒæœŸå‡¦ç†ã§ã‚ˆãèªžã‚‰ã‚Œã‚‹ã‚·ãƒ³ã‚°ãƒ«ã‚¹ãƒ¬ãƒƒãƒ‰ã¯ç¾å®Ÿã®ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒ(Chrome)ã§ã¯ã€ŒRenderer Process ã® Main threadã€ã®ã“ã¨ã§ã‚ã‚Šã€`fetch(url)` ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æŽ¥ç¶šã‚„ãƒªã‚¯ã‚¨ã‚¹ãƒˆãªã©ã®å‡¦ç†ã‚’è¡Œã£ã¦ã„ã‚‹ã®ã¯ã€ŒBrowser process ã® Network threadã€ã§ã™ã€‚

å‚è€ƒ
https://www.telerik.com/blogs/angular-basics-introduction-processes-threads-web-ui-developers

ãã‚‚ãã‚‚æœ€åˆã«è¦‹ã¦ã‚‚ã‚‰ã£ãŸã€ŽWhat the heck is the event loop anyway?ã€ã§ã¯ã€Œ**ä¸€åº¦ã«è¤‡æ•°ã®ã“ã¨ãŒã§ãã‚‹ã®ã¯ãƒ–ãƒ©ã‚¦ã‚¶ãŒãƒ©ãƒ³ã‚¿ã‚¤ãƒ ä»¥ä¸Šã®ã‚‚ã®ã§ã‚ã‚‹ã‹ã‚‰ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰æä¾›ã•ã‚Œã‚‹ Web APIs ã¯å®Ÿè³ªçš„ã«ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã‚ã‚‹**ã€ã¨ã„ã†ã“ã¨ãŒå®Ÿã¯èªžã‚‰ã‚Œã¦ã„ã¾ã—ãŸã€‚

> Right, so I've been kind of partially lying do you and telling you that JavaScript can only do one thing at one time. That's true the JavaScript Runtime can only do one thing at one time. It can't make an AJAX request while you're doing other code. It can't do a setTimeout while you're doing another code. **The reason we can do things concurrently is that the browser is more than just the Runtime**. So, remember this diagram, **the JavaScript Runtime can do one thing at a time, but the browser gives us these other things, gives us these we shall APIs, these are effectively threads**, you can just make calls to, and those pieces of the browser are aware of this concurrency kicks in. If you're back end person this diagram looks basically identical for node, **instead of web APIs we have C++ APIs and the threading is being hidden from you by C++**.
> (ä»¥ä¸‹ã®æ›¸ãèµ·ã“ã—ãƒšãƒ¼ã‚¸ã‹ã‚‰å¼•ç”¨ã€å¤ªå­—ã¯ç­†è€…å¼·èª¿)

https://2014.jsconf.eu/speakers/philip-roberts-what-the-heck-is-the-event-loop-anyway.html

:::message
**è£œè¶³**

Philip Roberts æ°ãŒè¨€ã† "Runtime" ã¨ã¯ Chrome ãƒ–ãƒ©ã‚¦ã‚¶ç’°å¢ƒã® JS ã‚¨ãƒ³ã‚¸ãƒ³ã§ã‚ã‚‹ V8 ã®ã“ã¨ã‚’è¨€ã£ã¦ã„ã¾ã™ã€‚Deno ã‚„ Node ã¯ V8 ã‚’å«ã‚“ã "ç’°å¢ƒ"ã§ã‚ã‚Šã€è‰²ã€…ãª API ã‚’æä¾›ã™ã‚‹ã®ã§ã€ã“ã“ã§ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã¨åŒç­‰ãªã‚‚ã®ã¨ã—ã¦è€ƒãˆã¦ãã ã•ã„ã€‚

ã¡ãªã¿ã«ãã‚Œãžã‚Œå…¬å¼ã‚µã‚¤ãƒˆã§ã®æ–‡è¨€ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚
- [Deno is a simple, modern and secure runtime for JavaScript and TypeScript that uses V8 and is built in Rust.](https://deno.land)
- [Node.jsÂ® is a JavaScript runtime built on Chrome's V8 JavaScript engine.](https://nodejs.org/en/)

ã¾ãŸã€å¼•ç”¨ã® "we shall APIs" ã¯ãŠãã‚‰ãæ›¸ãèµ·ã“ã—ã®é–“é•ã„ã§ã€å®Ÿéš›ã®å‹•ç”»ã§ã¯ "Web APIs" ã¨è¨€ã£ã¦ã„ã¾ã™ã€‚
:::

ã“ã“ã¾ã§ãã‚Œã°éžåŒæœŸå‡¦ç†ã®å…¨ä½“çš„ãªä»•çµ„ã¿ã‚„ç›®çš„ãŒãªã‚“ã¨ãªãåˆ†ã‹ã‚‹ã¨æ€ã„ã¾ã™ã€‚

ã€Œ**ç’°å¢ƒãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ä¸¦åˆ—çš„ã«ä½œæ¥­ã—ã¦ã„ã‚‹é–“ã‚‚ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ã™ã‚‹ã“ã¨ãªãåˆ¥ã®ä½œæ¥­ã‚’ç¶šã‘ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ã“ã¨**ã€ãŒã€ŒéžåŒæœŸå‡¦ç†(ã¨ã„ã†ãƒ†ãƒ¼ãƒž)ã€ã®å¤§ããªç›®çš„ã¨ãªã‚Šã¾ã™ã€‚ã‚ˆã‚Šæ­£ç¢ºã«ã¯ã€ŒéžåŒæœŸ API ã®ç›®çš„ã€ã§ã™ãŒã€ä¸€èˆ¬çš„ã«ããã‚‰ã‚Œã¦ã—ã¾ã†å¤§ããªãƒ†ãƒ¼ãƒžã§ã‚ã‚‹ã€ŒéžåŒæœŸå‡¦ç†ã€ã®ç›®çš„ã¯ã“ã‚Œã§ã™ã€‚æ¬¡ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã§è§£èª¬ã—ã¾ã™ãŒã€éžåŒæœŸ API ã«ä»˜éšã—ã¦çµæžœã¨ã—ã¦é…ç½®ã¨ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒãšã‚Œã¦å‡¦ç†ã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ã¯éžåŒæœŸå‡¦ç†ã§ã™ãŒã€ã“ã‚Œè‡ªä½“ã¯å˜ãªã‚‹ã€Œçµæžœã€ã§ã‚ã£ã¦ã€Œç›®çš„ã€ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

ãã—ã¦ã€Œ**ç’°å¢ƒãŒæä¾›ã™ã‚‹æ©Ÿèƒ½ã§ã‚ã‚‹ API ã‚’ä»‹ã—ã¦æ™‚é–“ã®ã‹ã‹ã‚‹å‡¦ç†ã‚’ç’°å¢ƒã«å§”ä»»ã—ã€ãã‚ŒãŒå®Œäº†ã—ãŸã‚‰ JavaScript ã®ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã«ãã®å‡¦ç†çµæžœã¨ãªã‚‹ãƒ‡ãƒ¼ã‚¿ã¨å…±ã«é€šçŸ¥ã•ã›ã¦ãã®ä½œæ¥­ã«é–¢é€£ã™ã‚‹ä½•ã‹åˆ¥ã®ä½œæ¥­ã‚’ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãªã©ã®å½¢å¼ã§è¡Œã†**ã€ã¨ã„ã†ã®ãŒã€ŒéžåŒæœŸå‡¦ç†ã€ã®å…¨ä½“çš„ãªä»•çµ„ã¿ã¨ãªã‚Šã¾ã™ã€‚

ã“ã‚Œã‚’ç†è§£ã™ã‚‹ã“ã¨ã§ã€éžåŒæœŸå‡¦ç†ã®å­¦ç¿’ã«ã‚ã‚ŠãŒã¡ãªèª¤è§£ã‚’è§£ãã“ã¨ãŒã§ãã¾ã™ã€‚

éžåŒæœŸå‡¦ç†ãã®ã‚‚ã®ã¯ç¢ºã‹ã«ä¸¦åˆ—å‡¦ç†ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€ã€Œ**API ã‚’ä»‹ã—ã¦ç’°å¢ƒã«å§”ä»»ã—ãŸä½œæ¥­ã¯ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ä¸¦åˆ—çš„ã«è¡Œã‚ã‚Œã€ãã‚ŒãŒå®Œäº†ã—ãŸã‚‰é–¢é€£ã™ã‚‹ä½œæ¥­ã‚’ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã§éžåŒæœŸçš„ã«è¡Œã†**ã€ã¨ã„ã†ã‚ˆã†ã«ã€ç’°å¢ƒå…¨ä½“ã§ã¯ã€ŒéžåŒæœŸ APIã€+ã€ŒéžåŒæœŸå‡¦ç†ã€ã¨ã—ã¦ã€Œä¸¦åˆ—ã€ã¨ã€ŒéžåŒæœŸã€ã®ä¸¡æ–¹ãŒçµ„ã¿åˆã‚ã•ã£ã¦èµ·ãã¦ã„ã‚‹ã¨ã„ã†ä»•çµ„ã¿ã‚’ç†è§£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

:::message alert
å®Ÿéš›ã«ã¯ã€Œä¸¦åˆ—(parallel)ã€ã¨ã¯è¨€ã„åˆ‡ã‚Œãªã„ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒã‚ã£ãŸã‚Šã—ã¾ã™ãŒã€**JavaScript (JS ã‚¨ãƒ³ã‚¸ãƒ³)ã®è¦–ç‚¹ã§è¦‹ã‚Œã°åˆ¥ã®ã¨ã“ã‚ã§åŒæ™‚ã«èµ·ãã¦ã„ã‚‹ã“ã¨**ã‚’ç†è§£ã™ã‚‹ã«ã¯ã€Œä¸¦åˆ—ã€ã¨ã—ã¦ä¾¿å®œçš„ã«è€ƒãˆãªã„ã¨ç†è§£ãŒé€²ã¾ãªã„ã¨ã„ã†ã‚¸ãƒ¬ãƒ³ãƒžãŒã‚ã‚Šã¾ã™ã€‚åŽ³å¯†ãªå®šç¾©ã®ä¸¦åˆ—(parallel)ã‚’ä½¿ã£ã¦ä¸€èˆ¬çš„ã«èª¬æ˜Žã—ã‚ˆã†ã¨ã™ã‚‹ã¨ä½¿ãˆãªããªã£ã¦ã—ã¾ã†ã®ã§ã€**ãŠèŒ¶ã‚’æ¿ã™ã—ã‹ãªã„**ã¨ã„ã†ã®ãŒå®Ÿæƒ…ã§ã‚ã‚‹ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚

ã¤ã¾ã‚Šã€ã€ŒåŒæ™‚ã«è¤‡æ•°ã®ã“ã¨ã‚’ã§ãã‚‹ã€ã‹ã‚‰ã¨è¨€ã£ã¦å¿…ãšã—ã‚‚è¤‡æ•°ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’åˆ©ç”¨ã—ãŸåŽ³å¯†ãªã€Œä¸¦åˆ—(parallel)ã€ã§ã¯ãªã„è¨³ã§ã™ã€‚ã€ŽWhat the heck is the event loop anyway?ã€ã§ã‚‚ã€Œ**ä¸€åº¦ã«è¤‡æ•°ã®ã“ã¨ãŒã§ãã‚‹ã®ã¯ãƒ–ãƒ©ã‚¦ã‚¶ãŒãƒ©ãƒ³ã‚¿ã‚¤ãƒ ä»¥ä¸Šã®ã‚‚ã®ã§ã‚ã‚‹ã‹ã‚‰ã§ã€ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰æä¾›ã•ã‚Œã‚‹ Web APIs ã¯å®Ÿè³ªçš„ã«ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã‚ã‚‹**ã€ã¨ã„ã†è©±ãŒã•ã‚Œã¦ã„ã¾ã—ãŸãŒã€ã‚ãã¾ã§ã€Œå®Ÿè³ªçš„ã«ã€ã¨ã„ã†æ³¨é‡ˆãŒã¤ãã¾ã™ã€‚Node ãªã©ã§ã¯è¤‡æ•°ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’ã‚»ãƒƒãƒˆã«ã—ãŸã‚¹ãƒ¬ãƒƒãƒ‰ãƒ—ãƒ¼ãƒ«ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ãŒã‚ã‚‹ã®ã§å®Ÿéš›ã€Œä¸¦åˆ—(parallel)ã€ã¨è¨€ã£ã¦ã‚‚ã‚ˆã„ã‚‚ã®ã‚„ãƒãƒ¼ãƒªãƒ³ã‚°ã®éš›ã«ã¾ã¨ã‚ã¦æœ‰åŠ¹æœŸé™ã®åˆ‡ã‚ŒãŸã‚¿ã‚¤ãƒžãƒ¼ã‚’ä¸€æ‹¬å‡¦ç†ã™ã‚‹ãªã©ãŒã‚ã‚‹ã®ã§ã‹ãªã‚Šã‚„ã‚„ã“ã—ã„è©±ã«ãªã£ã¦ã„ã¾ã™ã€‚åŸºæœ¬çš„ã« JS ã®æ–‡è„ˆã§èªžã‚‰ã‚Œã‚‹ã€Œä¸¦åˆ—ã€ã¨ã„ã†è¨€è‘‰ã¯ä¿¡ç”¨ã›ãšã«è©±åŠåˆ†ã§èžã„ã¦ãŠãã®ãŒè‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

ä¾‹ãˆã° `Promise.all()` ãªã©ã®é™çš„ãƒ¡ã‚½ãƒƒãƒ‰ã®è©±é¡Œã§ã€Œä¸¦åˆ—åŒ–ã€ã¨ã„ã†è¨€è‘‰ã‚’ã‚ˆãèžãã¨æ€ã„ã¾ã™ãŒã€**ãã®å®Ÿä½“ãŒä½•ãªã®ã‹æ„è­˜ã•ã‚Œãšã«ã€Œä¸¦åˆ—åŒ–ã€ã¨ã„ã†è¨€è‘‰ãŒæ°—è»½ã«ä½¿ã‚ã‚Œã¦ã„ã‚‹ã‚±ãƒ¼ã‚¹ãŒå¤šã„**ã®ã§ã€èª­ã¿æ‰‹å´ã‚‚æ„è­˜ã—ã™ãŽã¦ã—ã¾ã†ã¨æ··ä¹±ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚éžåŒæœŸ API ã‚„ç’°å¢ƒã«ã¤ã„ã¦ã®æƒ…å ±ãŒæŠœã‘è½ã¡ã¦ã„ã‚‹å ´åˆã«ã¯ã€ã€Œä¸¦åˆ—å‡¦ç†ã§ã¯ãªã„ã€ã¨ã„ã†è§£èª¬ã¨ã€Œä¸¦åˆ—åŒ–ã€ã¨ã„ã†ç”¨èªžãŒçµ„ã¿åˆã‚ã•ã£ã¦ã—ã¾ã†ã“ã¨ã§ã€Œä¸¦åˆ—å‡¦ç†ã§ã¯ãªã„ã®ã«ä¸¦åˆ—åŒ–ãŒã§ãã‚‹?ã€ã¨ã„ã£ãŸå…·åˆã«æ„å‘³ä¸æ˜Žã¨ãªã‚Šæ··ä¹±ã™ã‚‹ã“ã¨ãŒå¤šã„ã§ã™ã€‚ã“ã‚Œã«ã¤ã„ã¦ã¯ã€Ž[Promise ã®é™çš„ãƒ¡ã‚½ãƒƒãƒ‰ã¨ä¸¦åˆ—åŒ–](17-epasync-static-method)ã€ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã§è§£èª¬ã—ã¾ã™ã€‚

ã“ã®æœ¬ã®ä¸­ã§å‡ºã¦ãã‚‹ã€Œä¸¦åˆ—çš„ã€ã‚„ã€Œä¸¦åˆ—åŒ–ã€ã¨ã„ã†è¨€è‘‰ã¯è¤‡æ•°ã‚¹ãƒ¬ãƒƒãƒ‰ãŒçµ¡ã‚€åŽ³å¯†ãªã€Œä¸¦åˆ—(parallel)ã€ã§ã¯ãªãã€ã€Œ**è¤‡æ•°ã®ä½œæ¥­ãŒæ™‚é–“çš„ã«åŒæ™‚ã«ã•ã‚Œã¦ã„ã‚‹**ã€ã¨ã„ã†ã“ã¨ã‚’æŒ‡ã™ã®ã§æ³¨æ„ã—ã¦ãã ã•ã„ã€‚åŽ³å¯†ãªä¸¦åˆ—ã‚’æŒ‡ã™å ´åˆã«ã¯å¿…ãšã€Œä¸¦åˆ—(parallel)å‡¦ç†ã€ã¨è¨˜è¼‰ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

è‹±èªžã§ã‚‚ãã†ãªã®ã§ã™ãŒã€å°‚é–€ç”¨èªžã¨ä¸€èˆ¬çš„é€šå¿µã¨ã—ã¦ã®è¨€è‘‰ãŒæ··ã˜ã£ã¦èªžã‚‰ã‚Œã‚‹å ´åˆãŒã‚ˆãã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°ã€Œconcurrentlyã€ã¨ã„ã†å‰¯è©žã¯å¿…ãšã—ã‚‚ã€Œä¸¦è¡Œ(concurrent)å‡¦ç†ã€ã‚’è¡¨ã™ã®ã§ã¯ãªãå˜ã«ã€ŒåŒæ™‚ã€ã¨ã„ã†æ„å‘³ã«éŽãŽãªã„å ´åˆãªã©ãŒã‚ã‚Šã¾ã™ã€‚
:::

çµæžœã‚’å–å¾—ã§ãã‚‹ã¾ã§æ™‚é–“ã®ã‹ã‹ã‚‹ä½œæ¥­ãªã©ã‚’ã€Œä¸¦åˆ—çš„ã«ã€ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§è¡Œã„ãŸã„ã‹ã‚‰éžåŒæœŸå‡¦ç†ã¨ã„ã†å½¢ã§ãã®å®Œäº†ã‚’é€šçŸ¥ã•ã›ã‚‹ã‚ã‘ã§ã™ã€‚

ã‚‚ã¡ã‚ã‚“ç’°å¢ƒãŒæä¾›ã§ãã‚‹ API ã«ã¯é™ã‚ŠãŒã‚ã‚Šã¾ã™ã—ã€è‡ªåˆ†ã§å®šç¾©ã—ãŸæ™‚é–“ã®ã‹ã‹ã‚‹ã‚ˆã†ãªç‹¬è‡ªã®å‡¦ç†ã‚’è¡Œã„ãŸã„å ´åˆã«ã¯æ™®é€šã® API ã§ã¯ã©ã†ã«ã‚‚ãªã‚Šã¾ã›ã‚“ã€‚ã—ã‹ã—ã€Web worker API (ã“ã‚Œã‚‚ Web API)ã‚’ä½¿ã†ã“ã¨ã§ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã¯ãªãåˆ¥ã®ã‚¹ãƒ¬ãƒƒãƒ‰ã«åˆ†é›¢ã—ã¦ãã®ã‚ˆã†ãªæ™‚é–“ã®ã‹ã‹ã‚‹å‡¦ç†ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ã§æœ¬å½“ã«ä¸¦åˆ—ãªã‚‚ã®ã¨ã—ã¦ã€Œä¸¦åˆ—(parllel)å‡¦ç†ã€ã‚’è¡Œã†ã“ã¨ãŒã§ãã¾ã™ã€‚

https://developer.mozilla.org/ja/docs/Web/API/Web_Workers_API/Using_web_workers

ã“ã® Web API ã«ã¤ã„ã¦ã¯ Deno ç’°å¢ƒã§ã‚‚åŒä¸€åã® API ã¨ã—ã¦ä½¿ç”¨ã§ãã¾ã™ã€‚ãƒžãƒ‹ãƒ¥ã‚¢ãƒ«ã«ã¯è¤‡æ•°ã‚¹ãƒ¬ãƒƒãƒ‰ã§åˆ†é›¢ã—ã¦ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’èµ°ã‚‰ã›ã‚‹ã“ã¨ãŒå¯èƒ½ã¨è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

> Workers can be used to **run code on multiple threads**. Each instance of Worker is **run on a separate thread**, dedicated only to that worker.
> ([Workers | Manual | Deno](https://deno.land/manual@v1.20.4/runtime/workers) ã‚ˆã‚Šå¼•ç”¨ã€å¤ªå­—ã¯ç­†è€…å¼·èª¿)

Worker API ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’åˆ†å²ã•ã›ã¦æœ¬å½“ã®ä¸¦åˆ—(parallel)å‡¦ç†ãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã‚ã‘ã§ã™ãŒã€ES2017 ã§ã¯ãƒ“ãƒ«ãƒˆã‚¤ãƒ³ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦ [SharedArrayBuffer](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer) ã‚„ [Atomic](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Atomics) ã¨ã„ã£ãŸæ©Ÿèƒ½ãŒã•ã‚‰ã«è¿½åŠ ã•ã‚Œã€è¤‡æ•°ã‚¹ãƒ¬ãƒƒãƒ‰é–“ã§ã®ãƒ¡ãƒ¢ãƒªå…±æœ‰ãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸãã†ã§ã™ã€‚

https://hacks.mozilla.org/2016/05/a-taste-of-javascripts-new-parallel-primitives/

# ã€ŒéžåŒæœŸå‡¦ç†ã€ã®å†…è¨³

ã ã„ãŸã„ã®è©±ã¯åˆ†ã‹ã£ãŸã¨æ€ã„ã¾ã™ã®ã§ã€è§£é‡ˆã®è©±ã¨ã—ã¦ã¾ã¨ã‚ã¦ãŠãã¾ã™ã€‚

éžåŒæœŸ API ã®å®Ÿæ…‹ã¯ç’°å¢ƒãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ä¸¦åˆ—çš„ã«è¡Œã†æ©Ÿèƒ½ã§ã‚ã‚Šã€ãã®å‡¦ç†çµæžœã‹ã‚‰å–å¾—ã§ãã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰(ã‚³ãƒ¼ãƒ«ã‚¹ã‚¿ãƒƒã‚¯)ã«é€šçŸ¥ã•ã›ã¾ã™ã€‚

åˆ†ã‹ã‚Šã‚„ã™ã„ä¾‹ã§ã¯ã€é€šçŸ¥ã•ã›ã‚‹ã®ã¯ `fetch(url)` ã‹ã‚‰å–å¾—ã—ã¦ããŸãƒ‡ãƒ¼ã‚¿ `Response` ã§ã™ã­ã€‚ã“ã® `Response` ã®ãƒ‡ãƒ¼ã‚¿ã¯ãã®ã¾ã¾ã ã¨ä½¿ãˆãªã„ã®ã§ã€è‰²ã€…ãªå‡¦ç†ã‚’ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚`Response` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ä½¿ã„ãŸã„ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚„ JSON ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã¨ã‹ã€‚ã“ã®**éžåŒæœŸ API ã®å‡¦ç†çµæžœã«å¯¾ã—ã¦ãªã«ã‹ã™ã‚‹ä½œæ¥­**ãŒå®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®ãšã‚Œã¦ã—ã¾ã†ã„ã‚ã‚†ã‚‹éžåŒæœŸå‡¦ç†ã§ã™ã€‚ä¸‹ã®ã‚ˆã†ã« `then()` ãƒ¡ã‚½ãƒƒãƒ‰ã«æ›¸ã‹ã‚ŒãŸã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å½¢å¼ã®å‡¦ç†ãŒã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®é…ç½®ã¨å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒãšã‚Œã‚‹ã®ã§ã“ã‚Œã¯éžåŒæœŸå‡¦ç†ã§ã‚ã‚‹ã¨æ–­è¨€ã§ãã¾ã™ã€‚

```js
console.log("[1]");

// [éžåŒæœŸ API] ã®èµ·å‹•(githubã®APIã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—)
fetch("https://api.github.com/zen")
  .then((response) => { // [å¾Œã§å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°]
    // (å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‹ã‚‰textã‚’å–å¾—)
    return response.text();
  })
  .then((text) => { // [å¾Œã§å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°]
    // (textã‚’ã‚³ãƒ³ã‚½ãƒ¼ãƒ«å‡ºåŠ›)
    console.log("[3]", text);
  });

console.log("[2]");

/* ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¸ã®å‡ºåŠ›ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚‹
[1]
[2]
[3] It's not fully shipped until it's fast.
*/
```

`fetch()` API ã‹ã‚‰ã¯è¿”ã‚Šå€¤ã¨ã—ã¦ Promise ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒè¿”ã£ã¦ãã¾ã™ã€‚è©³ã—ãã¯ã€Ž[ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã®åŒæœŸå®Ÿè¡Œã¨éžåŒæœŸå®Ÿè¡Œ](4-epasync-callback-is-sync-or-async)ã€ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã§è§£èª¬ã—ã¾ã™ãŒã€ã“ã® Promise ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«å¯¾ã—ã¦ `then()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã¤ãªã’ã¦ã„ãå½¢å¼ã‚’ **Promise chain** ã¨å‘¼ã³ã¾ã™ã€‚

Promise chain ã‚‚éžåŒæœŸå‡¦ç†ã®ç¯„ç–‡ã«å«ã¾ã‚Œã¾ã™ãŒã€ã“ã®ã‚ˆã†ã«ã€ŒéžåŒæœŸå‡¦ç†ã€ã¨ã„ã†ãƒ†ãƒ¼ãƒžã®ç¯„ç–‡ã«è‰²ã€…ãªã‚‚ã®ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨è‡ªä½“ãŒéžåŒæœŸå‡¦ç†ã®å­¦ç¿’ã«ãŠã‘ã‚‹æ··ä¹±è¦å› ã®ï¼‘ã¤ã¨ãªã£ã¦ã„ã¾ã™ã€‚å®Ÿã¯ã€ŒéžåŒæœŸå‡¦ç†ã€ã‚’èªžã‚‹éš›ã«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¤‡æ•°ã®ã‚«ãƒ†ã‚´ãƒªã«åˆ†è§£ã§ãã¾ã™ã€‚

- (1) `setTimeout()` ã‚„ `fetch()` ãªã©ã®éžåŒæœŸ API
  ðŸ‘‰ ã•ã‚‰ã«ã‚¿ã‚¤ãƒ—ãŒã‚ã‚Šãã‚Œãžã‚Œã§è€ƒãˆæ–¹ã‚„å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒç•°ãªã‚‹
- (2) `then()`ã€`catch()`ã€`finally()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚„ä¸Šè¨˜ã®éžåŒæœŸ API ã«ç™»éŒ²ã—ã¦éžåŒæœŸçš„ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°(å®Ÿéš›ã«ã¯ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã®å®Ÿè¡Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ)
- (3) `await` å¼ã®å‰å¾Œã®å‡¦ç†(å®Ÿéš›ã«ã¯ async é–¢æ•°ã®å®Ÿè¡Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ)

(2) ã¨ (3) ã¯è¿‘ã„ã®ã§ã™ãŒã€å®Ÿè¡Œã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®è€ƒãˆæ–¹ãŒç•°ãªã‚‹ã®ã§åŽ³å¯†ã«åŒã˜ã§ã‚ã‚‹ã¨ã¯è¨€ãˆã¾ã›ã‚“ã€‚ãã—ã¦ã€(1) ã¯ä»–ã®ï¼’ã¤ã¨æ¯”ã¹ã¦å…¨ãç•°ãªã‚Šã¾ã™ã—ã€(1) ã®ä¸­ã§ã‚‚ç¨®é¡žãŒã‚ã‚Šã¾ã™ã€‚ãã†ã„ã†è¨³ã§ã€ã€ŒéžåŒæœŸå‡¦ç†ã€ã¨ã„ã†å˜èªžã§ã¾ã¨ã‚ã¦çµ±ä¸€çš„ã«ç†è§£ã—ã‚ˆã†ã¨ã™ã‚‹ã¨**å†…éƒ¨çš„ãªèª¬æ˜Žã®è¾»è¤„ãŒåˆã‚ãªããªã£ã¦è¨³ãŒã‚ã‹ã‚‰ãªããªã£ã¦ã—ã¾ã†**ã‚ã‘ã§ã™ã€‚Promise ã®è©±ã‚’ã—ã¦ã„ãŸã¨æ€ã£ã¦ã„ãŸã‚‰å…¨ç„¶é•ã†éžåŒæœŸ API ã®è©±ã ã£ãŸã¿ãŸã„ãªã“ã¨ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã‚‰ã¯æœ¬å½“ã«å…¨ç„¶é•ã†ã®ã§æ··ãœã¦èªžã£ã¦ã—ã¾ã†ã¨çŸ›ç›¾ãŒèµ·ãã¾ã™ã€‚ã€ŒéžåŒæœŸå‡¦ç†ã€ã¨ã„ã†ï¼‘ã¤ã®å˜èªžã§æ‰±ãŠã†ã¨ã™ã‚‹ã®ã¯åˆå­¦è€…ã«ã¯ã‹ãªã‚Šã‚­ãƒ„ãã€æœ€åˆã‹ã‚‰è¤‡æ•°ã®ç¨®é¡žãŒã‚ã‚‹ã¨ã„ã†ã“ã¨ã‚’èªè­˜ã—ãŸä¸Šã§åˆ†å‰²ã—ã¦ç†è§£ã—ãŸæ–¹ãŒè‰¯ã„ã§ã™ã€‚

(1) ã®ã€ŒéžåŒæœŸ APIã€ã¯éžåŒæœŸå‡¦ç†ã‹ã©ã†ã‹ã¨ã„ã†ã¨ã€æœ€åˆã¯**ã‚€ã—ã‚ä¸¦åˆ—å‡¦ç†**ã¨ã—ã¦ã¿ãªã—ãŸæ–¹ãŒç†è§£ã—ã‚„ã™ã„ã§ã™ã€‚ãŸã ã—ã€ä¸Šã§è¿°ã¹ãŸã‚ˆã†ã«åŽ³å¯†ãªä¸¦åˆ—(parallel)å‡¦ç†ã§ã‚ã‚‹ã¨ä¿¡ã˜ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€‚ã‚ãã¾ã§éžåŒæœŸ API ã«ã€ŒåŒæ™‚ã«è¤‡æ•°ã®ã“ã¨ãŒã§ãã‚‹ã€æ€§è³ªãŒã‚ã‚Šã€Œä¸¦åˆ—çš„ãªä½œæ¥­ã€ã‚’è¡Œãˆã‚‹ç¨‹åº¦ã®ã‚‚ã®ã§ã‚ã‚‹ã¨è€ƒãˆã¦ãã ã•ã„ã€‚

:::message
åŽ³å¯†ã«ä¸¦åˆ—(parallel)ã§ã¯ãªã„ã®ã«ä¸¦åˆ—çš„ãªã‚‚ã®ã§ã‚ã‚‹ã¨ç†è§£ã—ãŸæ–¹ãŒã„ã„ã®ã¯ã€å…¥ã‚Œãªã„å ´åˆã«æ¯”ã¹ã¦å¼Šå®³ãŒå°‘ãªã„ã¨å€‹äººçš„ã«è€ƒãˆã¦ã„ã‚‹ã‹ã‚‰ã§ã™ã€‚ã“ã‚Œã¯è‡ªåˆ†ãŒã€Œä¸¦åˆ—ã€æ¦‚å¿µã‚’å…¥ã‚Œãªã„ã¨ã‚€ã—ã‚æ··ä¹±ã—ã¦ç†è§£ãŒé€²ã¾ãªã‹ã£ãŸãŸã‚ã§ã™ã€‚ä¸¦åˆ—ã®åŽ³å¯†ãªå®šç¾©ã¯éžåŒæœŸå‡¦ç†ã«ã¤ã„ã¦ã‚ã‚‹ç¨‹åº¦ç†è§£ã—ã¦ã‹ã‚‰ã§ã‚‚è‰¯ã„ã¨æ€ã„ã¾ã™ã€‚
:::

ä¸€æ–¹ã€(2) ã¨ (3) ã¯åŽ³å¯†ãªä¸¦è¡Œ(concurrent)å‡¦ç†ã¨ãªã‚Šã¾ã™ã€‚ã“ã®è¾ºã‚ŠãŒæœ¬å½“ã«ã‚„ã£ã‹ã„ãªã“ã¨ã«è¤‡é›‘ã§ã™ã€‚

å…·ä½“çš„ãªèª¬æ˜Žã‚’ã™ã‚‹ã¨ã€éžåŒæœŸ API ã®èµ·å‹•è‡ªä½“ã¯ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®é…ç½®ã«æ²¿ã£ã¦ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’ãšã‚‰ã•ãšã«é–‹å§‹ã—ã¾ã™ãŒã€æ™‚é–“çš„ã«ã¯ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å‡¦ç†ã‚’(ä¸¦åˆ—çš„ã«)ç¶™ç¶šã—ã¤ã¤ã€ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã¯åˆ¥ã® JS ã‚³ãƒ¼ãƒ‰ã®å‡¦ç†ãŒã§ãã¦ã„ã¾ã™ã€‚ãã—ã¦ã€éžåŒæœŸ API ã®çµæžœã‹ã‚‰ç”Ÿã˜ãŸãƒ‡ãƒ¼ã‚¿ã«å¯¾ã—ã¦å¾Œã§ä½•ã‹ã™ã‚‹ã¨ã„ã†ã®ãŒã‚ˆãèªè­˜ã•ã‚Œã‚‹éžåŒæœŸå‡¦ç†ã§ã™ã€‚ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®é…ç½®ã«æ²¿ã£ãŸé †ç•ªã¨ã¯ãšã‚ŒãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§(éžåŒæœŸã«)å‡¦ç†ã•ã‚Œã¾ã™ã€‚

```js
// ä¸Šã‹ã‚‰ä¸‹ã«ä¸€è¡Œãšã¤å®Ÿè¡Œã•ã‚Œã‚‹ã®ãŒåŸºæœ¬ã§ãã“ã‹ã‚‰ãšã‚Œã‚‹ã®ãŒéžåŒæœŸå‡¦ç†

cnsole.log("[1] åŒæœŸå®Ÿè¡Œ: ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®é…ç½®ã§ã¯æœ€åˆ");

// éžåŒæœŸ API ã®èµ·å‹•(ã‚¿ã‚¤ãƒžãƒ¼ã®èµ·å‹•è‡ªä½“)ã¯åŒæœŸçš„(ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒãšã‚Œãªã„)ã ãŒã€ãã®å¾Œã‚‚ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ä¸¦åˆ—çš„ã«ã€Œæ™‚é–“ã‚’æ¸¬ã‚‹ä½œæ¥­ã€ã‚’ç¶™ç¶šã™ã‚‹
setTimeout(() => {
  // ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®é…ç½®ä¸Šã®é †ç•ªã¨å‡¦ç†é †ç•ªãŒãšã‚Œã‚‹
  console.log("[3] éžåŒæœŸå®Ÿè¡Œ: ã“ã‚Œã¯ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°");
  // æŒ‡å®šæ™‚é–“ãŒçµŒéŽã—ãŸã‚‰ã“ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°[éžåŒæœŸå‡¦ç†]ã‚’å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«ä¼ãˆã‚‹
}, 1000);

// API å‡¦ç†ãŒç¶™ç¶šçš„ã«è£ã§å®Ÿè¡Œã•ã‚Œã¤ã¤ã‚‚ã€æ¬¡ã®ã‚³ãƒ¼ãƒ‰ãŒå®Ÿè¡Œã§ãã‚‹
console.log("[2] åŒæœŸå®Ÿè¡Œ: ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®é…ç½®ã§ã¯æœ€å¾Œ");

/* ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¸ã®å‡ºåŠ›
[1] åŒæœŸå®Ÿè¡Œ: ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®é…ç½®ã§ã¯æœ€åˆ
[2] åŒæœŸå®Ÿè¡Œ: ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®é…ç½®ã§ã¯æœ€å¾Œ
[3] éžåŒæœŸå®Ÿè¡Œ: ã“ã‚Œã¯ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°
*/
```

API ã‚’ä»‹ã—ãŸä½œæ¥­ã‚’ç’°å¢ƒãŒä»£ã‚ã‚Šã«ä¸¦åˆ—çš„ã«è¡Œã£ã¦ã„ã‚‹é–“ã‚‚ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã§åˆ¥ã®ä½œæ¥­ã‚’ç¶šã‘ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ã®ãŒéžåŒæœŸå‡¦ç†ã®å¤§ããªç›®çš„(å˜ä½“ã§è¦‹ã‚Œã°ã€éžåŒæœŸ API ã®ç›®çš„ã¨ã„ã£ãŸæ–¹ãŒæ­£ã—ã„)ã§ã—ãŸã€‚

ã€ŒéžåŒæœŸå‡¦ç†ã€ã‚’ã‚ˆã‚Šãƒžã‚¯ãƒ­çš„ã«åˆ†é¡žã™ã‚‹ãªã‚‰ã€æ¬¡ã®ã‚ˆã†ã«ãªã‚Šã¾ã™(ä¸Šã§æŒ™ã’ãŸï¼‘~ï¼“ã®ã‚«ãƒ†ã‚´ãƒªã‚’æ›´ã«æŠ½è±¡åŒ–ã—ãŸåˆ†é¡žã§ã™)ã€‚

- (A) éžåŒæœŸ API(ç’°å¢ƒã®æ©Ÿèƒ½): `setTimeout()` ã‚„ `fetch()` ã¨ã„ã£ãŸã‚°ãƒ­ãƒ¼ãƒãƒ«ã«åˆ©ç”¨ã§ãã‚‹ãƒ¡ã‚½ãƒƒãƒ‰
  ðŸ‘‰ **èµ·å‹•å¾Œã¯ç’°å¢ƒã«ã‚ˆã£ã¦ä¸¦åˆ—çš„ã«ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å‡¦ç†ã•ã‚Œã‚‹**
- (B) éžåŒæœŸã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã§æ›¸ã‹ã‚ŒãŸé–¢æ•°(ECMAScript ã®é–¢æ•°): éžåŒæœŸ API ã®å‡¦ç†çµæžœã‚’ä½¿ã£ãŸå¾Œã«ãªã«ã‹å‡¦ç†ã™ã‚‹ä½œæ¥­ã§ã‚ã‚Šã€éžåŒæœŸ API ã«æ¸¡ã™ Callback ã‚„ Promise chainã€async/await ã§è¨˜è¿°ã•ã‚Œã‚‹
  ðŸ‘‰ **ã‚¤ãƒ™ãƒ³ãƒˆãƒ«ãƒ¼ãƒ—ã®æ©Ÿæ§‹ã«ã‚ˆã£ã¦ä¸¦è¡Œ(concurrent)ã«ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã§å‡¦ç†ã•ã‚Œã‚‹**

ä¸€èˆ¬çš„ã«ã€ŒéžåŒæœŸå‡¦ç†ã€ã®åç›®ã§è§£èª¬ã•ã‚Œã‚‹ã®ã¯ (B) ã®æ–¹ã§ã™ã€‚(A) ã®è©±ã‹ (B) ã®è©±ãªã®ã‹ã§ã‹ãªã‚Šé•ã†ã¨ã„ã†äº‹å®ŸãŒã‚ã‚‹ã®ã§æ°—ã‚’ã¤ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚(A) ãŒå­˜åœ¨ã—ã¦ã„ã‚‹ã“ã¨ã«æ³¨æ„ã‚’æ‰•ã‚ãªã„ã§ (B) ã«æ³¨è¦–ã—ã¦ã—ã¾ã†ã“ã¨ã§ã€å¤§ããªå‹˜é•ã„ã¨æ··ä¹±ã‚’ç”Ÿã‚€ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

ã—ã‹ã‚‚**ç¾å®Ÿçš„ã«ã¯ (A) ã¨ (B) ãŒå˜ä½“ã§ä½¿ã‚ã‚Œã‚‹ã“ã¨ã¯ãªãã€ä¸¡æ–¹ãŒçµ„ã¿åˆã‚ã•ã‚Œã¦ä½¿ã‚ã‚Œã‚‹ã®ã§éžå¸¸ã«ã‚„ã‚„ã“ã—ã„ã“ã¨ã«ãªã£ã¦ã„ã¾ã™**ã€‚ã¤ã¾ã‚Šã€(B) éžåŒæœŸã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã§æ›¸ã‹ã‚ŒãŸé–¢æ•°ã®ä¸­ã§ (A) éžåŒæœŸ API ãŒåˆ©ç”¨ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ãªçµ¡ã¿åˆã£ãŸçŠ¶æ…‹ã«ãªã‚‹ã“ã¨ãŒæ™®é€šã§ã™ã€‚é€†ã« (A) ã®å¼•æ•°ã« (B) ã¨ã„ã†ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’æ¸¡ã™å ´åˆã‚‚ã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°ã€`setTimeout(callback, delay)` ã® `callback` ã¯ (B) ã§ã‚ã‚Šã€`setTimeout()` è‡ªä½“ãŒ (A) ã§ã™ã€‚ã“ã®æ™‚ `setTimeout()` ã®ã‚¿ã‚¤ãƒžãƒ¼ã«ã‚ˆã‚‹ã€Œæ™‚é–“ã‚’å›³ã‚‹ä½œæ¥­ã€ã¯ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ä¸¦åˆ—çš„ã«è¡Œã‚ã‚Œã€æŒ‡å®šæ™‚é–“çµŒéŽå¾Œã«ã¯ç™»éŒ²ã—ã¦ãŠã„ãŸã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã¯ã‚¤ãƒ™ãƒ³ãƒˆãƒ«ãƒ¼ãƒ—ã§ä¸¦è¡Œ(concurrent)ã«å‡¦ç†ã•ã‚Œã‚‹ã¨ã„ã†å…·åˆã§ã™ã€‚

ã¤ã¾ã‚Šã€ä¸¡æ–¹ãŒä¸€ä½“ã¨ãªã£ã¦å‡¦ç†ã‚’å®Ÿç¾ã—ã¦ã„ãã‚ã‘ã§ã™ã€‚

![setTimeoutã®ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ](/images/js-async/img_setTimeout-mechanism.png)

JavaScript ã¯ã“ã®ã‚ˆã†ã« ECMAScript ã¨ç’°å¢ƒå®Ÿè£…ã® API(å®Ÿè¡Œç’°å¢ƒã®å›ºæœ‰æ©Ÿèƒ½) ã‚’çµ„ã¿åˆã‚ã›ãŸã‚‚ã®ã¨ã—ã¦è€ƒãˆã¾ã™ã€‚å®Ÿéš›ã€`console.log()` ãªã©ã‚‚ API ã§ã™ã—ã€JavaScript ã¯ API ãŒç„¡ã„ã¨å¤§ã—ãŸã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚

![JSã¨ECMAã®é–¢ä¿‚æ€§](/images/js-async/img_js-ecma-relationship.jpg)

è©±ã‚’æˆ»ã™ã¨ã€éžåŒæœŸ API ã®å‡¦ç†ã¯ç’°å¢ƒãŒä¸¦åˆ—çš„ã«è¡Œã£ã¦ãã‚Œã‚‹ã®ã§ã€éžåŒæœŸ API ã®å‡¦ç†çµæžœã‚’ä½¿ã£ã¦ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã®å½¢ã§ãªã«ã‹å‡¦ç†ã—ãŸã„å ´åˆã«ã¯ä»–ã®åŒæœŸå‡¦ç†ã¨ã¯ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’ãšã‚‰ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã­ã€‚æœ¬è³ªçš„ã«ã¯ (A) éžåŒæœŸ API ã‚’ä½¿ã„ãŸã„ãŒãŸã‚ã« (B) éžåŒæœŸã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã®é–¢æ•°ã‚’æ›¸ãå¿…è¦ãŒã‚ã‚‹ã¨ã„ã†è©±ã«ãªã‚Šã¾ã™ã€‚

![fetchã®ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ](/images/js-async/img_fetch-mechanism.png)

ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ `fetch()` API ã§ãƒ‡ãƒ¼ã‚¿å–å¾—ã—ãªãŒã‚‰ `setTimeout()` API ã§æŒ‡å®šã—ãŸé…å»¶æ™‚é–“ 1000 ãƒŸãƒªç§’ã‚’è¨ˆæ¸¬ã—ã€æ™‚é–“çµŒéŽå¾Œã«ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¸ãƒ†ã‚­ã‚¹ãƒˆå‡ºåŠ›ã‚’ã—ã¦ã„ã¾ã™ã€‚**ç’°å¢ƒã®æ©Ÿèƒ½ã§ã‚ã‚‹éžåŒæœŸ API(Non-blocking API)ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ã‹ã‚‰åŒæ™‚ã«è¤‡æ•°ã®ã“ã¨ãŒã§ãã¾ã™**ã€‚

:::message
éžåŒæœŸ API ã¯ Node ã®æ–‡è„ˆã§ã¯ **Non-blocking API** (ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ã—ãªã„ API)ã¨å‘¼ã°ã‚Œã‚‹ã“ã¨ãŒå¤šã„ã§ã™ãŒã€`fetch()` ã‚„ `setTimeout()` ãªã©ã®éžåŒæœŸã® Web API ã‚‚ Non-blocking API ã§ã™ã€‚
:::

ã€Œ**åŒæ™‚ã«è¤‡æ•°ã®ã“ã¨ã‚’ã‚„ã‚‹ã“ã¨ã§åŠ¹çŽ‡çš„ãªå‡¦ç†ãŒã—ãŸã„**ã€ã¨ã„ã†ç›®çš„ã‚’é”æˆã™ã‚‹ãŸã‚ã«éžåŒæœŸ API ã‚’ä½¿ç”¨ã—ã€å¾Œç¶šã®é–¢é€£ã™ã‚‹å‡¦ç†ã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ã«éžåŒæœŸå‡¦ç†ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã§ã‚ã‚‹ Callback ã‚„ Promise chain, async/await ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```js
console.log("sync"); // ç’°å¢ƒãŒæä¾›ã™ã‚‹ API(åŒæœŸçš„ã«å®Ÿè¡Œã•ã‚Œã‚‹)

// ç’°å¢ƒãŒæä¾›ã™ã‚‹éžåŒæœŸ API(ä¸¦åˆ—çš„ã«ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚’è¡Œã„ã€å–å¾—æˆåŠŸã—ã¦å®‰å®šåŒ–ã—ãŸã‚‰ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã¸ chain ã—ãŸ then ãƒ¡ã‚½ãƒƒãƒ‰ã§ç™»éŒ²ã—ã¦ãŠã„ãŸã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å–å¾—ãƒ‡ãƒ¼ã‚¿ã¨ã¨ã‚‚ã«é€šçŸ¥ã—ã¦å®Ÿè¡Œã™ã‚‹)
fetch("https://api.github.com/zen") // Promise ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒè¿”ã£ã¦ãã‚‹
  .then((response) => { // ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°(éžåŒæœŸçš„ã«å®Ÿè¡Œã•ã‚Œã‚‹)
    return response.text();
  })
  .then((text) => { // ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°(éžåŒæœŸçš„ã«å®Ÿè¡Œã•ã‚Œã‚‹)
    console.log(text);
  });

// ç’°å¢ƒãŒæä¾›ã™ã‚‹éžåŒæœŸ API(ä¸¦åˆ—çš„ã«ã‚¿ã‚¤ãƒžãƒ¼ã‚’èµ°ã‚‰ã›ã€æŒ‡å®šæ™‚é–“ãŒçµŒéŽã—ãŸã‚‰ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã¸ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’é€šçŸ¥ã—ã¦å®Ÿè¡Œã™ã‚‹)
setTimeout(() => { // ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°(éžåŒæœŸçš„ã«å®Ÿè¡Œã•ã‚Œã‚‹)
  console.log("async code");
}, 1000);

console.log("sync"); // ç’°å¢ƒãŒæä¾›ã™ã‚‹ API(åŒæœŸçš„ã«å®Ÿè¡Œã•ã‚Œã‚‹)
```

æ³¨æ„ç‚¹ã¨ã—ã¦ã€`fetch()` ã‚„ `setTimeout()` ã¯ã€ŒéžåŒæœŸé–¢æ•°ã€ã¨å‘¼ç§°ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã‚‰ã¯ç’°å¢ƒã‹ã‚‰æä¾›ã•ã‚Œã‚‹é–¢æ•°ã§ã‚ã‚ŠéžåŒæœŸ API ã§ã‚ã‚‹ãŸã‚ã€ŒéžåŒæœŸé–¢æ•°ã€ã¨å‘¼ã¶ã“ã¨ã«é–“é•ã„ã§ã¯ãªã„ã§ã™ãŒã€æ··ä¹±ã—ã‚„ã™ã„è¡¨ç¾ã¨ãªã£ã¦ã„ã¾ã™ã€‚ä¾‹ãˆã°ã€`async` ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦å®£è¨€ã•ã‚ŒãŸ async function ã®ã“ã¨ã‚‚ã€ŒéžåŒæœŸé–¢æ•°ã€ã¨å‘¼ã¶ã®ã§éžå¸¸ã«ç´›ã‚‰ã‚ã—ã„ã“ã¨ã«ãªã‚Šã¾ã™ã€‚å­¦ç¿’ã®ä¸Šã§ã¯ `setTimeout()` ã¨ async function ã‚’**åŒã˜å‘¼ã³æ–¹ã§åŒä¸€è¦–ã™ã¹ãã§ã¯ãªã„**ã®ã§åˆ†ã‘ã¦è€ƒãˆã‚‹ã‚ˆã†ã«ã—ã¾ã™(è€ƒãˆæ–¹ãŒå…¨ãç•°ãªã‚‹ã‚‚ã®ã‚’åŒä¸€ã®å‘¼ã³æ–¹ã§èªè­˜ã™ã‚‹ã¨æ··ä¹±ã—ã¾ã™)ã€‚

ã“ã®æœ¬ã§ã¯ã€ŒéžåŒæœŸé–¢æ•°ã€ã¨è¨€ã£ã¦ã„ãŸã‚‰ `async` ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ä½¿ã£ã¦å®£è¨€ãƒ»å®šç¾©ã•ã‚ŒãŸé–¢æ•°ã®ã“ã¨ã‚’æŒ‡ã—ã€ECMAScript ã®ç¯„ç–‡ã§ã¯ãªãç’°å¢ƒã®æ©Ÿèƒ½ãªã‚‰ã°ã€ŒéžåŒæœŸ APIã€ã¨ã—ã¦å‘¼ã‚“ã§ã„ã‚‹ã®ã§æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ãŸã ã—ã€ŒéžåŒæœŸé–¢æ•°ã€ã¨ã„ã†å‘¼ç§°ã‚‚ã‚ã‚‹ç†ç”±ã‹ã‚‰æŽ¡ç”¨ã™ã¹ãã§ãªã„ã¨è€ƒãˆã¦ã„ã‚‹ã®ã§ async function ã®ã“ã¨ã‚‚ãªã‚‹ã¹ãã€Œasync é–¢æ•°ã€ã¨å‘¼ã¶ã‚ˆã†ã«ã—ã¾ã™ã€‚

ã“ã®æœ¬ã§ã¯ `setTimeout()` ã®ã“ã¨ã‚’ã€ŒéžåŒæœŸé–¢æ•°ã€ã¨å‘¼ã°ãªã„ã‚ˆã†ã«ã—ã¾ã™ãŒã€ä»–ã®è§£èª¬ãªã©ã§ãã®ã‚ˆã†ã«èª­ã‚“ã§ã„ã‚‹å ´åˆã«ã¯ãã®æ„å‘³ã‚’ã€Œãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ã—ãªã„é–¢æ•°ã€ã§ã‚ã‚‹ã¨è§£é‡ˆã—ã¦ãã ã•ã„ã€‚

# ã€ŒéžåŒæœŸ APIã€ã®ç¨®é¡ž

ã€ŒéžåŒæœŸå‡¦ç†ã€ã¨ã„ã†ã®ã¯è¤‡æ•°ã®è¦ç´ ãŒçµ¡ã¿åˆã£ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã£ãŸè¨³ã§ã™ãŒã€ãã®è¦ç´ ã®ï¼‘ã¤ã§ã‚ã‚‹ã€ŒéžåŒæœŸ APIã€ã«ã‚‚æ›´ã«ç¨®é¡žãŒã‚ã‚Šã¾ã™ã€‚ä¸Šã®ã‚³ãƒ¼ãƒ‰ã§ã‚ã’ãŸã‚ˆã†ã« `fetch()` ã¨ `setTimeout()` ã¯éžåŒæœŸ API ã§ã™ãŒã€è£ã®ç«‹è„šã™ã‚‹ä»•çµ„ã¿ãŒç•°ãªã‚Šã¾ã™ã€‚

`setTimeout()` ã¯ã‚¿ã‚¹ã‚¯ã‚’ç™ºè¡Œã—ã¾ã™ãŒã€`fetch()` ã¯ Promise ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¿”ã™ãŸã‚(é–“æŽ¥çš„ã«)ãƒžã‚¤ã‚¯ãƒ­ã‚¿ã‚¹ã‚¯ã‚’ç™ºè¡Œã—ã¾ã™ã€‚

:::message alert
å¾Œè¿°ã—ã¾ã™ãŒã€`setTimeout()` ã«å¯¾ã—ã¦ã‚ˆã‚Šæ­£ç¢ºã«å¯¾æ¯”ã§ãã‚‹ API ã¯ `fetch()` ã§ã¯ãªã `queueMicrotask()` ã§ã™ã€‚`setTimeout()` ã¯ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ã‚¿ã‚¹ã‚¯ã‚­ãƒ¥ãƒ¼ã¸ã¨ç™ºè¡Œã—ã€`queueMicrotask()` ã¯ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ãƒžã‚¤ã‚¯ãƒ­ã‚¿ã‚¹ã‚¯ã‚­ãƒ¥ãƒ¼ã¸ã¨ç™ºè¡Œã—ã¾ã™ã€‚

```js
console.log("[1] ðŸ¦– sync");

setTimeout(() => { // éžåŒæœŸçš„ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°
  console.log("[4] ðŸµ async: callback to task queue");
});
queueMicrotask(() => { // éžåŒæœŸçš„ã«å®Ÿè¡Œã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°
  console.log("[3] ðŸ¶ async: callback to microtask queue");
});

console.log("[2] ðŸ¦– sync");

/* ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã¸ã®å‡ºåŠ›ã¯æ¬¡ã®ã‚ˆã†ã«ãªã‚‹
[1] ðŸ¦– sync
[2] ðŸ¦– sync
[3] ðŸ¶ async: callback to microtask queue
[4] ðŸµ async: callback to task queue
*/
```
:::

ã€ŒéžåŒæœŸå‡¦ç†(ã¨ã„ã†ãƒ†ãƒ¼ãƒž)ã€ã‚’å®Ÿç¾ã™ã‚‹ãŸã‚ã®æ©Ÿæ§‹ã¨ã—ã¦ã€ã‚¿ã‚¹ã‚¯ã¯å¤ã„æ–¹å¼ã§ã€ãƒžã‚¤ã‚¯ãƒ­ã‚¿ã‚¹ã‚¯ã¯æ–°ã—ã„æ–¹å¼ã§ã™ã€‚ãƒžã‚¤ã‚¯ãƒ­ã‚¿ã‚¹ã‚¯ã¯ Promise å‡¦ç†ã®ãŸã‚ã«å°Žå…¥ã•ã‚ŒãŸæ–°ã—ã„æ©Ÿæ§‹ã§ã‚ã‚Šã€`fetch()` API ã¯ã“ã®ãƒžã‚¤ã‚¯ãƒ­ã‚¿ã‚¹ã‚¯ã®ä»•çµ„ã¿ã«ç«‹è„šã—ãŸéžåŒæœŸ API ã¨ãªã‚Šã¾ã™ã€‚`fetch()` ã¯å‡¦ç†çµæžœã¨ãªã‚‹å€¤ã‚’å…¥ã‚Œè¾¼ã‚“ã  Promise ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¿”ã—ã¦ãã¾ã™ã€‚ã“ã‚Œã¯ **Promise-based API** ã¨å‘¼ã°ã‚Œã‚‹ãƒ¢ãƒ€ãƒ³ãªéžåŒæœŸ API ã®ä»•çµ„ã¿ã§ã™ã€‚

> Many modern Web APIs are promise-based, including WebRTC, Web Audio API, Media Capture and Streams, and many more.
> ([How to use promises - Learn web development | MDN](https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Asynchronous/Promises#conclusion) ã‚ˆã‚Šå¼•ç”¨)

æ–°ã—ã„éžåŒæœŸ API ã¯ Promise ã‚’åˆ©ç”¨ã—ã¦ãŠã‚Šã€MDN ã§ã¯éžåŒæœŸ API ã®ç†æƒ³ãŒ Promise ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¿”ã™é–¢æ•°(ã¤ã¾ã‚Š Promise-based API)ã§ã‚ã‚‹ã¨ç¤ºå”†ã•ã‚Œã¦ã„ã¾ã™ã€‚

> ç†æƒ³çš„ã«ã¯ã€ã™ã¹ã¦ã®éžåŒæœŸé–¢æ•°ã¯ãƒ—ãƒ­ãƒŸã‚¹ã‚’è¿”ã™ã¯ãšã§ã™ãŒã€æ®‹å¿µãªãŒã‚‰ API ã®ä¸­ã«ã¯ã„ã¾ã ã«å¤ã„ã‚„ã‚Šæ–¹ã§æˆåŠŸ/å¤±æ•—ç”¨ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’æ¸¡ã—ã¦ã„ã‚‹ã‚‚ã®ãŒã‚ã‚Šã¾ã™ã€‚é¡•è‘—ãªä¾‹ã¨ã—ã¦ã¯ `setTimeout()` é–¢æ•°ãŒã‚ã‚Šã¾ã™ã€‚
> ([ãƒ—ãƒ­ãƒŸã‚¹ã®ä½¿ç”¨ - JavaScript | MDN](https://developer.mozilla.org/ja/docs/Web/JavaScript/Guide/Using_promises#%E5%8F%A4%E3%81%84%E3%82%B3%E3%83%BC%E3%83%AB%E3%83%90%E3%83%83%E3%82%AF_api_%E3%82%92%E3%83%A9%E3%83%83%E3%83%97%E3%81%99%E3%82%8B_promise_%E3%81%AE%E4%BD%9C%E6%88%90) ã‚ˆã‚Šå¼•ç”¨)

éžåŒæœŸ API ã®ç†æƒ³ã¯ Promise ã‚’è¿”ã™é–¢æ•°ã§ã‚ã‚Šã€å®Ÿéš› Node ã®å¾Œç™ºã§ã‚ã‚‹ãƒ¢ãƒ€ãƒ³ãªãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç’°å¢ƒã§ã‚ã‚‹ Deno ã§ã¯ã€åŸºæœ¬çš„ã«ã™ã¹ã¦ã®éžåŒæœŸã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ Promise ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¿”ã—ã¾ã™ã€‚Deno ã¯ Promise-based API ã‚’åŸºè»¸ã«é–‹ç™ºã•ã‚Œã¦ã„ã‚‹è¨³ã§ã™ã€‚

> All async actions in Deno return a promise. Thus Deno provides different APIs than Node.
> ([Introduction | Deno Manual](https://deno.land/manual/introduction#comparison-to-nodejs) ã‚ˆã‚Šå¼•ç”¨)

ãã‚Œã§ã¯ã€éžåŒæœŸ API ã«ã¤ã„ã¦ä¸€æ—¦ã¾ã¨ã‚ã¦ãŠãã¾ã™ã€‚

Promise-based API ã¯ Promise ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¿”ã™ãŸã‚ã€Promise ã‚’ä»‹ã—ãŸé€æ¬¡å‡¦ç†ãªã©ã«ä½¿ã‚ã‚Œã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯ãƒžã‚¤ã‚¯ãƒ­ã‚¿ã‚¹ã‚¯ã¨ã—ã¦ç™ºè¡Œã•ã‚Œã¾ã™ã€‚ã“ã‚Œã‚‰ã® API ã¯ Promise é–¢é€£ã®å‡¦ç†ã«ä½¿ã‚ã‚Œã‚‹è£ã®ä»•çµ„ã¿ã§ã‚ã‚‹ãƒžã‚¤ã‚¯ãƒ­ã‚¿ã‚¹ã‚¯ã«ç«‹è„šã—ã¦ã„ã‚‹ãŸã‚ã€ã€Œ**ãƒžã‚¤ã‚¯ãƒ­ã‚¿ã‚¹ã‚¯ãƒ™ãƒ¼ã‚¹ã®éžåŒæœŸ API**ã€ã¨ã§ã‚‚å‘¼ã¹ã‚‹ä»£ç‰©ã§ã™ã€‚

ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ã‚¿ã‚¹ã‚¯ã¨ã—ã¦ç™ºè¡Œã™ã‚‹ã‚¿ã‚¤ãƒ—ã§ã‚ã‚‹æ—§å¼ã®éžåŒæœŸ API ã¯ç«‹è„šã™ã‚‹ä»•çµ„ã¿ãŒã‚¿ã‚¹ã‚¯ã§ã‚ã‚‹ãŸã‚ã€ã€Œ**ã‚¿ã‚¹ã‚¯ãƒ™ãƒ¼ã‚¹ã®éžåŒæœŸ API**ã€ã¨å‘¼ã¹ã¾ã™ã­ã€‚

ã¨ã„ã†ã“ã¨ã§ã€éžåŒæœŸ API ã¯ãã‚ŒãŒç«‹è„šã™ã‚‹ä»•çµ„ã¿ã‹ã‚‰æ¬¡ã®ã‚ˆã†ã«åˆ†ã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

- (1) ã‚¿ã‚¹ã‚¯ãƒ™ãƒ¼ã‚¹ã®éžåŒæœŸ API
  - ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ã‚¿ã‚¹ã‚¯ã¨ã—ã¦ç™ºè¡Œã™ã‚‹
  - ä¾‹: `setTimeout()` ã‚„ `setInerval()` ãªã©
- (2) ãƒžã‚¤ã‚¯ãƒ­ã‚¿ã‚¹ã‚¯ãƒ™ãƒ¼ã‚¹ã®éžåŒæœŸ API
  - (A) ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ãƒžã‚¤ã‚¯ãƒ­ã‚¿ã‚¹ã‚¯ã¨ã—ã¦ç™ºè¡Œã™ã‚‹éžåŒæœŸ API
    - ä¾‹: `queueMicrotask()` ã‚„ `MutationObserver()` ãªã©
  - (B) Promise-based API
    - Promise ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¿”ã—ã€ãã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®ä¸­ã« API ã®å‡¦ç†çµæžœ(å–å¾—ãƒ‡ãƒ¼ã‚¿ãªã©)ã‚’å…¥ã‚Œã¦ãŠã
    - ä¾‹: `fetch()` ã‚„ `Blob.text()` ãªã©

:::message alert
ã€Ž[ã‚¿ã‚¹ã‚¯ã‚­ãƒ¥ãƒ¼ã¨ãƒžã‚¤ã‚¯ãƒ­ã‚¿ã‚¹ã‚¯ã‚­ãƒ¥ãƒ¼](d-epasync-task-microtask-queues)ã€ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã§è§£èª¬ã—ã¾ã™ãŒã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’ãã®ã¾ã¾ãƒžã‚¤ã‚¯ãƒ­ã‚¿ã‚¹ã‚¯ã¨ã—ã¦ç™ºè¡Œã™ã‚‹éžåŒæœŸ API ã«ã¯ `queueMicrotask()` ã¨ `MutationObserver()` ãŒã‚ã‚‹ã®ã§æ³¨æ„ã—ã¦ãã ã•ã„ã€‚Promise-based API ã¯ Promise ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’è¿”ã—ã¾ã™ãŒã€ãƒžã‚¤ã‚¯ãƒ­ã‚¿ã‚¹ã‚¯ãŒåˆ©ç”¨ã•ã‚Œã‚‹ã®ã¯è¿”ã•ã‚Œã‚‹ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã« `.then(cb)` ã§ãƒã‚§ãƒ¼ãƒ³ã—ã¦ã€å±¥è¡ŒçŠ¶æ…‹ã«ç§»è¡Œã—ãŸå¾Œã§ç™ºè¡Œã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã«å¯¾ã—ã¦ãªã®ã§ã€ãƒžã‚¤ã‚¯ãƒ­ã‚¿ã‚¹ã‚¯ã‚’ãã®ã¾ã¾ç›´æŽ¥ç™ºè¡Œã™ã‚‹ã‚ã‘ã§ã¯ãªã„ã§ã™ã€‚
:::

éžåŒæœŸå‡¦ç†ã®å­¦ç¿’ã§ã®ãƒˆãƒ©ãƒƒãƒ—ã¨ã—ã¦ã€éžåŒæœŸ API ã«ã¯ã“ã®ã‚ˆã†ã«ç¨®é¡žãŒã‚ã‚‹ã“ã¨ã«æ°—ã‚’ã¤ã‘ãªãã¦ã¯ã„ã‘ã¾ã›ã‚“ã€‚ã€ŒéžåŒæœŸå‡¦ç†ã€ã«åˆ†é¡žãŒã‚ã£ãŸã®ã«ã€ŒéžåŒæœŸ APIã€ã«ã‚‚åˆ†é¡žãŒã‚ã‚‹è¨³ãªã®ã§éžå¸¸ã«è¤‡é›‘ã«ãªã£ã¦ã„ã¾ã™ã€‚ä¸Šã®ï¼’ã¤ã®ã‚¿ã‚¤ãƒ—ã®éžåŒæœŸ API ã¯ç«‹è„šã™ã‚‹è£ã®ä»•çµ„ã¿ãŒç•°ãªã‚‹ãŸã‚ã€**ãã‚Œãžã‚Œå®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚„è€ƒãˆæ–¹ãŒç•°ãªã‚Šã¾ã™**ã€‚ã“ã‚Œã‚’èªè­˜ã—ã¦å‡¦ç†ã®é †ç•ªã‚’äºˆæ¸¬ã§ãã‚‹ã‚ˆã†ã«å¿…è¦ãªã®ãŒã€**ã‚¤ãƒ™ãƒ³ãƒˆãƒ«ãƒ¼ãƒ—**ã‚„ã‚¿ã‚¹ã‚¯ã‚­ãƒ¥ãƒ¼ãƒ»ãƒžã‚¤ã‚¯ãƒ­ã‚¿ã‚¹ã‚¯ã‚­ãƒ¥ãƒ¼ã®æ¦‚å¿µã§ã™ã€‚ã“ã‚Œã‚‰ã®æ¦‚å¿µã‚’ç†è§£ã—ãªã„é™ã‚Šã€è¤‡é›‘ãªå‡¦ç†é †ç•ªã¨ãªã‚‹ã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡Œé †åºäºˆæ¸¬ã‚„ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã‚’è¡Œã†ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚

# ã€ŒéžåŒæœŸã€ã¨ã„ã†æ¦‚å¿µ

ã“ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã®ç· ã‚ã¨ã—ã¦ã€æ”¹ã‚ã¦ã€ŒéžåŒæœŸã€ã¨ã„ã†æ¦‚å¿µã‚’ç¢ºèªã—ã¦ãŠãã¾ã™ã€‚ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã®ã©ã“ã‚’æŽ¢ã—ã¦ã‚‚ãƒ•ãƒ¯ãƒ•ãƒ¯ã—ã¦ã„ã‚‹æ¦‚å¿µãªã®ã§ã™ãŒã€ã€ŒéžåŒæœŸ(asynchronous)ã€ã®æ¦‚å¿µãŒ MDN ã§ã©ã®ã‚ˆã†ã«èª¬æ˜Žã•ã‚Œã¦ã„ã‚‹ã‹ã‚’è¦‹ã‚‹ã¨æ¬¡ã®ã‚ˆã†ã«è¨˜è¼‰ã•ã‚Œã¦ã„ã¾ã™ã€‚

> The term asynchronous refers to two or more objects or events not existing or happening at the same time (**or multiple related things happening without waiting for the previous one to complete**).
> ([Asynchronous - MDN Web Docs Glossary: Definitions of Web-related terms | MDN](https://developer.mozilla.org/en-US/docs/Glossary/Asynchronous) ã‚ˆã‚Šå¼•ç”¨ã€å¤ªå­—ã¯ç­†è€…å¼·èª¿)

ä¸Šã®æ–‡ç« ã¯ MDN ã®æ—¥æœ¬èªžç‰ˆã¨è‹±èªžç‰ˆã§è§£é‡ˆãŒãªãœã‹é£Ÿã„é•ã£ã¦ã„ã‚‹ã‚ˆã†ã«æ€ãˆã‚‹ã®ã§ã‚ªãƒªã‚¸ãƒŠãƒ«ã®è‹±èªžç‰ˆã‚’æŒã£ã¦ãã¦ã„ã¾ã™ã€‚å¤ªå­—éƒ¨åˆ†ã§å¼·èª¿ã—ãŸã€Œ**è¤‡æ•°ã®é–¢é€£ã™ã‚‹äº‹è±¡ãŒå‰ã®äº‹è±¡ã®å®Œäº†ã‚’å¾…ãŸãšã«èµ·ãã‚‹**ã€ã¨ã„ã†ã®ãŒå€‹äººçš„ã«ã¯å”¯ä¸€ä¿¡é ¼ã§ãã‚‹å®šç¾©ã ã¨è€ƒãˆã¦ã„ã¾ã™ã€‚

ã“ã‚Œã«ã‚ˆã£ã¦ã€ŒéžåŒæœŸ APIã€ãŒåŒæ™‚ã«è¤‡æ•°ã®ã“ã¨ãŒã§ãã‚‹æ€§è³ªã‚’æŒã£ã¦ã„ã‚‹ã«ã‚‚é–¢ã‚ã‚‰ãšãã®å‘¼ç§°ãŒã€Œä¸¦åˆ— API(Parallel API)ã€ã§ã¯ãªãã€ã€ŒéžåŒæœŸ API(Asynchronous API)ã€ã«ãªã£ã¦ã„ã‚‹èª¬æ˜ŽãŒä»˜ãã¾ã™ã€‚

ã‚ã‚‹ã„ã¯ nodejs.dev ã§ã®å®šç¾©ã‚’è¦‹ã¦ã¿ã‚‹ã¨æ¬¡ã®ã‚ˆã†ã«èª¬æ˜Žã•ã‚Œã¦ã„ã¾ã™ã€‚

> Asynchronous means that things can happen independently of the main program flow.
> ([JavaScript Asynchronous Programming and Callbacks](https://nodejs.dev/learn/javascript-asynchronous-programming-and-callbacks) ã‚ˆã‚Šå¼•ç”¨)

ãªã‚‹ã»ã©ã€éžåŒæœŸ(Asynchronous)ã¨ã¯ã€Œ**ãƒ¡ã‚¤ãƒ³ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãƒ•ãƒ­ãƒ¼ã‹ã‚‰ç‹¬ç«‹ã—ã¦ç‰©äº‹ãŒèµ·ãã†ã‚‹ã“ã¨**ã€ã¨ã®ã“ã¨ã§ã™ã€‚ã“ã‚Œã‚‚ã€Œè¤‡æ•°ã®é–¢é€£ã™ã‚‹å‡¦ç†ãŒå‰ã®å‡¦ç†ã®å®Œäº†ã‚’å¾…ãŸãšã«èµ·ãã‚‹ã€ã®è¨€ã„æ›ãˆã«è¿‘ã„ã§ã™ã­ã€‚

ç†è§£ã—ã‚„ã™ãä»Šã¾ã§ã® JavaScript ã®æ–‡è„ˆã§å…·ä½“çš„ãªæƒ…å ±ã‚’è£œã†ã¨ã€ã‚ã‚‹å‡¦ç†ãŒå˜ä¸€ã‚¹ãƒ¬ãƒƒãƒ‰ã¨ã—ã¦ã®ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰(ãƒ¡ã‚¤ãƒ³ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãƒ•ãƒ­ãƒ¼)ã®å¤–ã€ã¤ã¾ã‚Š JavaScript ã‚¨ãƒ³ã‚¸ãƒ³ã®å¤–ã§ã‚ã‚‹ç’°å¢ƒã®ã©ã“ã‹ã§ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã«å®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ãŒã€ŒéžåŒæœŸã€ã§ã‚ã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚

ä¸Šã®èª¬æ˜Žã¯ã™ã“ã—æ‹¡å¤§è§£é‡ˆã§ã™ãŒã€ã€ŒéžåŒæœŸ(Asynchronous)ã€ã¨ã¯ã¾ã•ã«ã€Œ**éžåŒæœŸ API ã®æ€§è³ªãã®ã‚‚ã®**ã€ã‚ã‚‹ã„ã¯ã€Œ**éžåŒæœŸ API ã‚’ä½¿ç”¨ã™ã‚‹ã“ã¨ã§èµ·ãã‚‹äº‹è±¡ãã®ã‚‚ã®**ã€ã‚’æŒ‡ã—ã¦ã„ãŸã‚ã‘ã§ã™ã€‚

ã€ŒéžåŒæœŸã€ãŒä½•ãŸã‚‹ã‹å¾ã€…ã«è¦‹ãˆã¦ããŸã®ã§ã€ã“ã“ã‹ã‚‰ã¯ã€ŒéžåŒæœŸã€ã®æ¦‚å¿µãŒæŽ´ã¿ã¥ã‚‰ã„åŽŸå› ã‚’è§£èª¬ã—ã¾ã™ã€‚

ã“ã®æœ¬ã§ã‚‚é•·ã‚‰ãå‹˜é•ã„ã—ã¦ã„ãŸã®ã§ã™ãŒã€éžåŒæœŸå‡¦ç†ã®ãƒ†ãƒ¼ãƒžã§èªžã‚‰ã‚Œã‚‹ Promise ã‚„ async é–¢æ•°ã®å‡¦ç†ãã®ã‚‚ã®ã¯å¿…ãšã—ã‚‚ã€ŒéžåŒæœŸ(asynchronous)ã€ã®æ€§è³ªã‚’ç™ºç¾ã—ã¾ã›ã‚“ã€‚async é–¢æ•°(éžåŒæœŸé–¢æ•°)ã¨ã„ã†åå‰ãªã®ã«ã§ã™ã€‚ãã‚Œã‚‰ã¯**ã‚ã‚‹ç‰¹å®šã®çŠ¶æ³ä¸‹ã§ã®ã¿**ã€ŒéžåŒæœŸã€ã®æ€§è³ªãŒç™ºæ®ã•ã‚Œã¾ã™ã€‚

async é–¢æ•°ã«ã¤ã„ã¦ã¯ã€Ž[Promise chain ã‹ã‚‰ async é–¢æ•°ã¸](14-epasync-chain-to-async-await)ã€ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã§è©³ã—ãè§£èª¬ã—ã¾ã™ãŒã€async é–¢æ•°ã¨ã„ã†ã®ã¯å†…éƒ¨ã« await å¼ãŒã‚ã‚‹æ™‚ã«é™ã£ã¦ã€ŒéžåŒæœŸã€ã¨ãªã‚Šã¾ã™(ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ `console.log()` ã®å¼•æ•°ã®ç•ªå·ãŒå®Ÿè¡Œã—ãŸéš›ã®å‡ºåŠ›ã®é †ç•ªã«ãªã‚Šã¾ã™)ã€‚

```js
console.log("ðŸ¦– [1]");
// async é–¢æ•°ã®å³æ™‚å®Ÿè¡Œ(ã‚¢ãƒ­ãƒ¼é–¢æ•°ã§ã®æ›¸ãæ–¹)
(async () => {
  console.log("ðŸµ [2]");
  await 1;
  console.log("ðŸ‘» [4]");
})();
// await å¼ãŒã‚ã‚Œã° async é–¢æ•°ã¯å®Œäº†ã›ãšã«ãã®å¤–ã®å‡¦ç†ãŒè¡Œã‚ã‚Œã‚‹ã®ã§ã€ŒéžåŒæœŸã€ã®ç¾è±¡ãŒèµ·ãã¦ã„ã‚‹
console.log("ðŸ¦• [3]");

/* å‡ºåŠ›çµæžœ
ðŸ¦– [1]
ðŸµ [2]
ðŸ¦• [3]
ðŸ‘» [4]
*/
```

:::details å³æ™‚å®Ÿè¡Œé–¢æ•°ã®è£œè¶³
`(async () => {})();` ã¨ã„ã†ä¸Šã®æ›¸ãæ–¹ã¯å³æ™‚å®Ÿè¡Œé–¢æ•°ã®æ›¸ãæ–¹ã«ãªã‚Šã¾ã™ã€‚å³æ™‚å®Ÿè¡Œã«ã¯ã„ãã¤ã‹æ›¸ãæ–¹ãŒã‚ã‚‹ã®ã§æ³¨æ„ã—ã¦ãã ã•ã„ã€‚

```js
// ç„¡åé–¢æ•°ã®å³æ™‚å®Ÿè¡Œ
(function() {
  // ...å‡¦ç†å†…å®¹
})();

// async ç‰ˆã®ç„¡åé–¢æ•°ã®å³æ™‚å®Ÿè¡Œ
(async function() {
  // ...å‡¦ç†å†…å®¹
})();

// ã‚¢ãƒ­ãƒ¼é–¢æ•°ã®å³æ™‚å®Ÿè¡Œ
(() => {
  // ...å‡¦ç†å†…å®¹
})();

// async ç‰ˆã®ã‚¢ãƒ­ãƒ¼é–¢æ•°ã®å³æ™‚å®Ÿè¡Œ
(async () => {
  // ...å‡¦ç†å†…å®¹
})();
```

å³æ™‚å®Ÿè¡Œé–¢æ•°ã¯æ™®é€šã«é–¢æ•°ã‚’å®šç¾©ã—ã¦ã™ãå‘¼ã³å‡ºã™ã®ã¨å¤§ã—ãŸå·®ã¯ãªã„ã§ã™ãŒã€ã‚³ãƒ¼ãƒ‰é‡ã‚‚æ¸›ã£ã¦åˆ†ã‹ã‚Šã‚„ã™ãè¨˜è¿°ã—ã‚„ã™ã„ã®ã§ã“ã®æ›¸ãæ–¹ã‚’å¤šç”¨ã—ã¦ã„ã¾ã™ã€‚

```js
// ã‚¢ãƒ­ãƒ¼é–¢æ•°ã§ã® async é–¢æ•°ã®å®šç¾©
const Fn = async () => {
  // ...å‡¦ç†å†…å®¹
};
Fn(); // ã™ãå‘¼ã³å‡ºã—

// ä¸Šã¨ã‚„ã£ã¦ã„ã‚‹ã“ã¨ã¨å¤§ã—ã¦å¤‰ã‚ã‚Šãªã„
(async () => {
  // ...å‡¦ç†å†…å®¹
})();
```

é–¢æ•°å¼ã‚„ã‚¢ãƒ­ãƒ¼é–¢æ•°ã«ã¤ã„ã¦ã¯åˆ¥é€”ã€Ž[Promise ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã¨ Executor é–¢æ•°](3-epasync-promise-constructor-executor-func#é–¢æ•°å¼ã¨ã‚¢ãƒ­ãƒ¼é–¢æ•°ã®è£œè¶³)ã€ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã§è§£èª¬ã—ã¦ã„ã¾ã™ã€‚
:::

æ¬¡ã®ã‚ˆã†ã« await å¼ãŒé–¢æ•°å†…éƒ¨ã«ç„¡ã‘ã‚Œã°ãã®ã¾ã¾å®Œäº†ã—ã¦ã‹ã‚‰é–¢æ•°ã®æ¬¡ã®å‡¦ç†ãŒè¡Œã‚ã‚Œã‚‹ã®ã§ã€ŒåŒæœŸã€ã§ã™ã€‚

```js
console.log("ðŸ¦– [1]");
(async () => {
  console.log("ðŸµ [2]");
  1;
  console.log("ðŸ‘» [3]");
})();
// await å¼ãŒç„¡ã‘ã‚Œã° async é–¢æ•°ãŒå®Œäº†ã—ã¦ã‹ã‚‰ãã®å¤–ã®å‡¦ç†ãŒè¡Œã‚ã‚Œã‚‹ã®ã§ã“ã®å ´åˆã¯ã€ŒåŒæœŸã€ã§ã‚ã‚‹
console.log("ðŸ¦• [4]");

/* å‡ºåŠ›çµæžœ
ðŸ¦– [1]
ðŸµ [2]
ðŸ‘» [3]
ðŸ¦• [4]
*/
```

Promise ã‚‚å¾Œç¶šã® `then()` ãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚ã‚‹å ´åˆã€ã¤ã¾ã‚Š Promise chain ã¨ãªã£ã¦ã„ã‚‹å ´åˆã«é™ã£ã¦ã€ŒéžåŒæœŸã€ã¨ãªã‚Šã¾ã™ã€‚

```js
console.log("ðŸ¦– [1]");
new Promise(resolve => {
  console.log("ðŸµ [2]");
  resolve();
}).then(() => console.log("ðŸ‘» [4]"));
// Promise chain ã®å‡¦ç†ã¯å®Œäº†ã›ãšã«ãã®å¤–ã®å‡¦ç†ãŒè¡Œã‚ã‚Œã‚‹ã®ã§ã€ŒéžåŒæœŸã€ã®ç¾è±¡ãŒèµ·ãã¦ã„ã‚‹
console.log("ðŸ¦• [3]");

/* å‡ºåŠ›çµæžœ
ðŸ¦– [1]
ðŸµ [2]
ðŸ¦• [3]
ðŸ‘» [4]
*/
```

å˜ä¸€ã® Promise ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ãã®ã¾ã¾ç”Ÿæˆã™ã‚‹ã ã‘ã§ã¯ã€ŒéžåŒæœŸã€ã«ã¯ãªã‚Šã¾ã›ã‚“ã€‚

```js
console.log("ðŸ¦– [1]");
new Promise(resolve => {
  console.log("ðŸµ [2]");
  resolve();
  console.log("ðŸ‘» [3]");
});
// Promise ã®å‡¦ç†ãŒå®Œäº†ã—ã¦ã‹ã‚‰ãã®å¤–ã®å‡¦ç†ãŒè¡Œã‚ã‚Œã‚‹ã®ã§ã“ã®å ´åˆã¯ã€ŒåŒæœŸã€ã§ã‚ã‚‹
console.log("ðŸ¦• [4]");

/* å‡ºåŠ›çµæžœ
ðŸ¦– [1]
ðŸµ [2]
ðŸ‘» [3]
ðŸ¦• [4]
*/
```

ã€ŒéžåŒæœŸ(asynchronous)ã€ã®æ€§è³ªã‚’å¸¸ã«ç™ºç¾ã—ã†ã‚‹ã®ã¯ã€ŒéžåŒæœŸ APIã€ã§ã™ãŒã€ãã®å‡¦ç†ã‚’å˜ä½“ã§è¦–ãŸæ™‚ã«å®Ÿéš›ã«ã€ŒéžåŒæœŸã€ã«ãªã£ã¦ã„ã‚‹ã‹ã¯åˆ†ã‹ã‚Šã¾ã›ã‚“ã€‚ä¾‹ãˆã°ã€æ¬¡ã®ã‚ˆã†ãªçŸ­ã„ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚ã‚Œã°å¾Œç¶šã®å‡¦ç†ãŒç„¡ã„ã®ã§ã“ã®å‡¦ç†ã‚’è¦‹ã¦ã‚‚ã€ŒéžåŒæœŸã€ã§ã‚ã‚‹ã¨ã¯è¨€ãˆã¾ã›ã‚“ã€‚

```js:ã“ã‚Œã—ã‹æ›¸ã‹ã‚Œã¦ã„ãªã„ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
// githubã‹ã‚‰ãƒ‡ã‚¶ã‚¤ãƒ³æ€æƒ³ã‚’å–å¾—ã—ã¦ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›ã™ã‚‹ã ã‘
fetch("https://api.github.com/zen")
  .then(response => response.text())
  .then(text => console.log(text));
// ã‚³ãƒ¼ãƒ‰é…ç½®ã¨å®Ÿè¡Œãƒ»å®Œäº†ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒã‚ºãƒ¬ã¦ã„ãªã„(ä¸Šã‹ã‚‰ä¸‹ã«è¡Œã‚ã‚Œã¦ã„ã)
```

ã€ŒéžåŒæœŸã€ã®ç¾è±¡ãŒèµ·ãã¦ã„ã‚‹ã¨è¨€ãˆã‚‹ã®ã¯ä»–ã®ã‚³ãƒ¼ãƒ‰ã¨ã®é–¢ä¿‚æ€§ãŒã‚ã£ã¦ã®ã“ã¨ã§ã™ã€‚æ¬¡ã®ã‚ˆã†ã« `fetch()` ã‹ã‚‰å§‹ã¾ã‚‹ä¸€é€£ã® Promise chain ã®å¾Œã«ä½•ã‚‰ã‹ã®å‡¦ç†ãŒæ›¸ã‹ã‚Œã¦ã„ã‚Œã°ã€ã“ã‚Œã‚’å®Ÿè¡Œã—ãŸéš›ã«ã¯ã€ŒéžåŒæœŸã€ã§ã‚ã‚‹ã¨è¨€ãˆã¾ã™ã€‚

```js:ã“ã‚Œã—ã‹æ›¸ã‹ã‚Œã¦ã„ãªã„ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
fetch("https://api.github.com/zen")
  .then(response => response.text())
  .then(text => console.log(text));
// ä¸Šã®å‡¦ç†ã®å®Œäº†ã‚’å¾…ãŸãšã«ãã®å¤–ã®å‡¦ç†ãŒè¡Œã‚ã‚Œã‚‹ã®ã§ã€ŒéžåŒæœŸã€ã®ç¾è±¡ãŒèµ·ãã¦ã„ã‚‹
console.log("ä¸Šã®å‡¦ç†ã®å®Œäº†ã‚’å¾…ãŸãšã«ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›");
```

ã€ŒéžåŒæœŸã€ã¨ã„ã†æ¦‚å¿µãŒæŽ´ã¿ã¥ã‚‰ã„ã®ã¯ã€ã“ã®ã‚ˆã†ã«çŠ¶æ³ã«å¿œã˜ã¦ãã®ç¾è±¡ãŒèµ·ããŸã‚Šèµ·ããªã‹ã£ãŸã‚Šã™ã‚‹ãŸã‚ã§ã™ã€‚

ã€ŒéžåŒæœŸã€ã¨ã„ã†æ€§è³ªã‚’æŒã£ãŸã€Œå‡¦ç†ã€ãŒãã‚Œå˜ä½“ã§å­˜åœ¨ã™ã‚‹è¨³ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ä»–ã®ã‚³ãƒ¼ãƒ‰ã¨ã®é–¢ä¿‚æ€§ãŒã‚ã£ã¦å§‹ã‚ã¦æˆã‚Šç«‹ã¤äº‹è±¡ã‚’æŒ‡ã—ç¤ºã™æ¦‚å¿µã§ã‚ã‚Šã€éžåŒæœŸ API ã«ã¤ã„ã¦ã‚‚ã€Œ**ãã®æ€§è³ªã‚’ç™ºç¾ã—ã†ã‚‹**ã€ã¨ã„ã†è§£é‡ˆãŒå¦¥å½“ã§ã™ã€‚MDN ã®å®šç¾©ã€Œè¤‡æ•°ã®é–¢é€£ã™ã‚‹äº‹è±¡ãŒå‰ã®äº‹è±¡ã®å®Œäº†ã‚’å¾…ãŸãšã«èµ·ãã‚‹ã€ã‚’ãƒ™ãƒ¼ã‚¹ã«ã—ã¦è€ƒãˆã‚‹ã¨ã“ã†ãªã‚Šã¾ã™ã€‚

æ¬¡ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã§è©³ç´°ã«è§£èª¬ã—ã¾ã™ãŒã€ç¾å®Ÿçš„ã«ã¯ Callback ã‚„ Promise chainã€async/await ã¯éžåŒæœŸ API ã®çµ¡ã‚€å‡¦ç†ã‚’è¡Œã†éš›ã«å¿…è¦ãªã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã§ã‚ã‚Šã€çŠ¶æ³ã«å¿œã˜ã¦ã€ŒéžåŒæœŸã€ã®æ€§è³ªã‚’ç™ºç¾ã—ã¾ã™ã€‚ã—ã‹ã—ã€å˜ä½“ã§åˆ©ç”¨ã™ã‚‹ã“ã¨ã¯ã»ã¨ã‚“ã©ãªãã€éžåŒæœŸ API ã‚’èµ·ç‚¹ã«ã—ãŸä¸€é€£ã®å¾Œç¶šå‡¦ç†ã®é †åºã‚’åˆ¶å¾¡ã™ã‚‹ãŸã‚ã®æ–¹æ³•ã¨ã—ã¦åˆ©ç”¨ã•ã‚Œã¾ã™ã€‚

ã“ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã®å†’é ­ã§ã€ŒéžåŒæœŸå‡¦ç†ã€ã¨ã¯ã€Œå®Ÿè¡Œã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒãšã‚Œã¦ã—ã¾ã†å‡¦ç†ã€ã§ã‚ã‚‹ã¨ã„ã†æ—¨ã‚’æ›¸ãã¾ã—ãŸãŒã€ãã‚Œã¯éƒ¨åˆ†çš„ãªè§£é‡ˆã«éŽãŽã¾ã›ã‚“ã§ã—ãŸã€‚å®Ÿéš›ã«ã¯ã€Œè¤‡æ•°ã®é–¢é€£ã™ã‚‹äº‹è±¡ãŒå‰ã®äº‹è±¡ã®å®Œäº†ã‚’å¾…ãŸãšã«èµ·ãã‚‹ã€ãŒã€ŒéžåŒæœŸã€ã®æ­£ã—ã„è§£é‡ˆã§ã‚ã‚Šã€éžåŒæœŸ API ã‚’ä½¿ã†éš›ã«æ›¸ã‹ã–ã‚‹è² ãˆãªã„ Promise chain ãªã©ã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã«ã‚ˆã£ã¦ä»˜éšçš„ã«ã§ã¦ãã‚‹ã€Œå®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒã‚³ãƒ¼ãƒ‰ã®é…ç½®ã¨ãšã‚Œã‚‹å‡¦ç†ã€ã¯ã€ŒéžåŒæœŸã€ã®ä¸€éƒ¨ã§ã‚ã‚‹ã¨ã„ã†è¨³ã§ã™ã€‚

```js:ã“ã‚Œã—ã‹æ›¸ã‹ã‚Œã¦ã„ãªã„ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
fetch("https://api.github.com/zen") // èµ·å‹•ã•ã›ã¦ç’°å¢ƒãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§è¡Œã† API å‡¦ç†[éžåŒæœŸ API]
  .then(response => response.text()) // å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒé…ç½®ã¨ãšã‚Œã‚‹[thenã«ç™»éŒ²ã•ã‚ŒãŸã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°]
  .then(text => console.log(text)); // å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒé…ç½®ã¨ãšã‚Œã‚‹[thenã«ç™»éŒ²ã•ã‚ŒãŸã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°]
// ä¸Šã®å‡¦ç†ã®å®Œäº†ã‚’å¾…ãŸãšã«ãã®å¤–ã®å‡¦ç†ãŒè¡Œã‚ã‚Œã‚‹ã®ã§ã€ŒéžåŒæœŸã€ã®ç¾è±¡ãŒèµ·ãã¦ã„ã‚‹
console.log("ä¸Šã®å‡¦ç†ã®å®Œäº†ã‚’å¾…ãŸãšã«ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«å‡ºåŠ›");
```

ãã—ã¦ã“ã®ä»˜éšçš„ã«ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã®ãšã‚Œã‚‹å‡¦ç†ãŒå®Ÿéš›ã«è¡Œã‚ã‚Œã‚‹ãŸã‚ã®æ©Ÿæ§‹ãŒã‚¤ãƒ™ãƒ³ãƒˆãƒ«ãƒ¼ãƒ—ã§ã™ã€‚

ã“ã®ã‚ˆã†ãªè¨³ã§ã€å®Ÿã¯ã€ŒéžåŒæœŸã€ã®æ¦‚å¿µã‚’æœ€åˆã‹ã‚‰ç›´æŽ¥çš„ã«ç†è§£ã—ã‚ˆã†ã¨ã™ã‚‹ã¨æ§˜ã€…ãªè¦å› ã§æ·±ã¿ã«ãƒãƒžã£ã¦ã—ã¾ã„ç†è§£ã™ã‚‹ã®ãŒé›£ã—ã„ã§ã™ã€‚è‰²ã€…ãªè¦ç´ ãŒé–¢ã‚ã£ã¦ãã‚‹ä¸Šã«ã€çŠ¶æ³ã«å¿œã˜ã¦ã€ŒéžåŒæœŸã€ã‹ã€ŒåŒæœŸã€ã‹å¤‰ã‚ã£ã¦ãã‚‹ã®ã§ã€æ­£ã—ãè§£èª¬ã—ã‚ˆã†ã¨ã—ãŸã‚Šã€æ­£ã—ãç†è§£ã—ã‚ˆã†ã¨ã™ã‚‹ã»ã©åˆå­¦è€…ã«ã¨ã£ã¦ç†è§£ãŒå›°é›£ã¨ãªã‚‹æ¦‚å¿µã«ãªã£ã¦ã„ã¾ã™ã€‚çŸ›ç›¾ã—ã¦ã„ã‚‹ã‚ˆã†ã§ã™ãŒã€ç›´æŽ¥çš„ã«æ­£ã—ãç†è§£ã—ãªã„æ–¹ãŒæœ€åˆã¯ç†è§£ãŒé€²ã¿ã¾ã™ã€‚

ã€ŒéžåŒæœŸ APIã€ã«ã¤ã„ã¦ã‚‚ã€ã“ã‚Œã“ããŒã€ŒéžåŒæœŸã€ã®æ€§è³ªã‚’ç™ºç¾ã—ã†ã‚‹ã‚‚ã®ã ã£ãŸè¨³ãªã®ã§ã™ãŒã€ã“ã‚Œã‚‚æœ€åˆã¯ã€Œä¸¦åˆ—(parallel)ã€ã§ã‚ã‚‹ã¨ã‚ãˆã¦èª¤è§£ã—ãŸæ–¹ãŒç†è§£ã¯é€²ã¿ã¾ã™ã€‚ã¨ã¯è¨€ãˆã€èª¤è§£ã—ã¦ã„ã‚‹ã“ã¨è‡ªä½“ã‚’çŸ¥ã£ã¦ãŠãã“ã¨ã¯é‡è¦ã§ã™ã€‚

:::message
> éžåŒæœŸå‡¦ç†ãã®ã‚‚ã®ã¯ç¢ºã‹ã«ä¸¦åˆ—å‡¦ç†ã§ã¯ã‚ã‚Šã¾ã›ã‚“ãŒã€ã€Œ**API ã‚’ä»‹ã—ã¦ç’°å¢ƒã«å§”ä»»ã—ãŸä½œæ¥­ã¯ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ä¸¦åˆ—ã«è¡Œã‚ã‚Œã€ãã‚ŒãŒå®Œäº†ã—ãŸã‚‰ä½•ã‹ã‚’ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã§éžåŒæœŸçš„ã«è¡Œã†**ã€ã¨ã„ã†ã‚ˆã†ã«ã€ç’°å¢ƒå…¨ä½“ã§ã¯ã€ŒéžåŒæœŸ APIã€+ã€ŒéžåŒæœŸå‡¦ç†ã€ã¨ã—ã¦ã€Œä¸¦åˆ—ã€ã¨ã€ŒéžåŒæœŸã€ã®**ä¸¡æ–¹ãŒçµ„ã¿åˆã‚ã•ã£ã¦èµ·ãã¦ã„ã‚‹**ã¨ã„ã†ä»•çµ„ã¿ã‚’ç†è§£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

å†’é ­ã§ã¯ä¸Šã®ã‚ˆã†ã«èª¬æ˜Žã—ã¦ã„ã¾ã—ãŸãŒã€å®Ÿéš›ã¯ã™ã¹ã¦ã€ŒéžåŒæœŸã€ã®æ¦‚å¿µã«ã¾ã¤ã‚ã‚‹è©±ã§ã‚ã£ãŸè¨³ã§ã™ã€‚æœ€åˆã®èª¬æ˜Žã§ã¯å†…è¨³ãŒè¤‡é›‘ãªãŸã‚ã€ŒéžåŒæœŸ API = ä¸¦åˆ—ã€ã‹ã¤ã€Œ`then()` ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚„ `await` å¼ã®å‰å¾Œ = å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒã‚³ãƒ¼ãƒ‰é…ç½®ã¨ãšã‚Œã¦ã—ã¾ã†éžåŒæœŸå‡¦ç†ã€ã¨ã¿ãªã—ã¦ã„ã¾ã—ãŸ(ã“ã‚Œã«ã¤ã„ã¦ã¯ç­†è€…ã®å‹˜é•ã„ã‚‚ã‚ã‚Šã¾ã—ãŸðŸ˜…)ã€‚éžåŒæœŸ API ãŒä¸¦åˆ—çš„ä½œæ¥­ã‚’è¡Œãˆã‚‹ã®ã¯éžåŒæœŸ API ãã®ã‚‚ã®ã®ã€ŒéžåŒæœŸã®ç¾è±¡ã‚’èµ·ã“ã—ã†ã‚‹ã€ã¨ã„ã†æ€§è³ªã«ç›´çµã—ã¦ã„ã¾ã—ãŸã€‚

ã€ŒéžåŒæœŸå‡¦ç†ã€ã¨ã„ã†ç”¨èªžã‚’ä»Šã‚ã‚‹çŸ¥è­˜ã§å®Œç’§ã«èª¬æ˜Žã™ã‚‹ãªã‚‰ã€ã„ã‚ã‚†ã‚‹éžåŒæœŸå‡¦ç†ã¨ã¯ã€Œ**è¤‡æ•°ã®é–¢é€£ã™ã‚‹äº‹è±¡ãŒå‰ã®äº‹è±¡ã®å®Œäº†ã‚’å¾…ãŸãšã«èµ·ãã‚‹éžåŒæœŸã¨ã„ã†ç¾è±¡ã‚’å¼•ãèµ·ã“ã™å¯èƒ½æ€§ã®ã‚ã‚‹ API å‡¦ç†ã‚„ãã®å®Ÿè¡Œã«ä»˜éšã—ã¦èµ·ãã‚‹å¾Œç¶šã®é–¢é€£ã™ã‚‹å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒã‚³ãƒ¼ãƒ‰é…ç½®ã¨ã‚ºãƒ¬ã¦ã—ã¾ã†å¯èƒ½æ€§ã®ã‚ã‚‹å‡¦ç†ã®ã“ã¨ã€ã‚ã‚‹ã„ã¯ãã‚Œã‚‰ã™ã¹ã¦ã‚’ã¾ã¨ã‚ã¦èªè­˜ã™ã‚‹ãŸã‚ã®å‘¼ç§°**ã€ã§ã‚ã‚‹ã¨è¨€ãˆã¾ã™ã€‚ã€Œå¯èƒ½æ€§ãŒã‚ã‚‹ã€ã¨è¨€ã£ã¦ã„ã‚‹ã®ã¯çŠ¶æ³æ¬¡ç¬¬ã§åŒæœŸã«ãªã‚‹ã“ã¨ã‚‚ã‚ã‚‹ã‹ã‚‰ã§ã™ã€‚

ã“ã‚“ãªå®šç¾©ã ã¨ç´›ã‚‰ã‚ã—ãæ‰±ã„ãšã‚‰ã„ã®ã§ã€ä¸Šã§è¿°ã¹ãŸã‚ˆã†ã«ã“ã®æœ¬ã§ã¯éžåŒæœŸ API (ç’°å¢ƒã®æ©Ÿèƒ½)ãªã‚‰æ˜Žç¢ºã«ã€ŒéžåŒæœŸ APIã€ã§ã‚ã‚‹ã“ã¨ã‚’å¼·èª¿ã—ã¦å‘¼ç§°ã—ã€ãã‚Œä»¥å¤–ã®éžåŒæœŸã«ã¾ã¤ã‚ã‚‹å‡¦ç†ã‚„ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹(Promise chain ã‚„ async/await ãªã©)ã¯ã¾ã¨ã‚ã¦ã€ŒéžåŒæœŸå‡¦ç†ã€ã¨ã—ã¦å‘¼ç§°ã—ã¾ã™(å¯èƒ½ãªå ´åˆã¯ãªã‚‹ã¹ãè©³ç´°ã«å‘¼ç§°ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™)ã€‚

- (A) éžåŒæœŸ API (ç’°å¢ƒã®æ©Ÿèƒ½):
  ðŸ‘‰ã€Œç’°å¢ƒã€ã«ã‚ˆã£ã¦ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ã€Œä¸¦åˆ—çš„ã«ã€å‡¦ç†ã•ã‚Œã‚‹ãŸã‚çµæžœçš„ã«ã€ŒåŒæ™‚ã«è¤‡æ•°ã®ã“ã¨ãŒã§ãã¦åŠ¹çŽ‡ãŒã‚ˆã„ã€
- (B) éžåŒæœŸå‡¦ç† (Promise chain ã‚„ async/await ãªã©ã®éžåŒæœŸã«é–¢ã™ã‚‹ã‚ã‚‰ã‚†ã‚‹å‡¦ç†ã‚„ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã¾ã¨ã‚ã¦å‘¼ç§°):
  ðŸ‘‰ ã€Œã‚¤ãƒ™ãƒ³ãƒˆãƒ«ãƒ¼ãƒ—ã®æ©Ÿæ§‹ã€ã«ã‚ˆã£ã¦ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã€Œä¸¦è¡Œ(concurrent)ã«ã€å‡¦ç†ã•ã‚Œã‚‹ãŸã‚å®Ÿè¡Œã‚„å®Œäº†ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒã‚³ãƒ¼ãƒ‰é…ç½®ã¨ã‚ºãƒ¬ã‚‹ ECMAScript ã®é–¢æ•°ã«ä¸»ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹

åŸºæœ¬çš„ã«ã¯ã€ŒéžåŒæœŸ API ã‹ã©ã†ã‹ã€ãŒé‡è¦ã¨ãªã‚‹åˆ†ã‘æ–¹ãªã®ã§ã€éžåŒæœŸ API ã‹ãã‚Œä»¥å¤–ã¨ã„ã†åˆ†ã‘æ–¹ãŒè‰¯ã„ã§ã—ã‚‡ã†ã€‚
:::

ã€ŒéžåŒæœŸã€ã¨ã„ã†æ¦‚å¿µã‚’ç›´æŽ¥çš„ã«ç†è§£ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ãŸã‚ã«ã¯ã€ä¸Šè¨˜ã®ã‚ˆã†ã«éžåŒæœŸã®ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ã‚„ç’°å¢ƒã«ã¾ã¤ã‚ã‚‹è‰²ã€…ãªçŸ¥è­˜ãŒå¿…è¦ã¨ãªã‚‹ã®ã§ã€æœ€åˆã®ã†ã¡ã¯ã€Œãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ã€ã¨ã„ã£ãŸå‘¨è¾ºã®æ¦‚å¿µã‚„å¯¾ç«‹ã™ã‚‹ã€ŒåŒæœŸã€ã®æ¦‚å¿µã‹ã‚‰ç†è§£ã™ã‚‹ã“ã¨ã§å¤–å½¢ã‚’æŽ´ã‚“ã§ã„ã£ãŸæ–¹ãŒã‚ˆã„ã§ã™(ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ç­‰ã«ã¤ã„ã¦ã¯æ¬¡ã®ãƒãƒ£ãƒ—ã‚¿ãƒ¼ã§è©³ã—ãè§£èª¬ã—ã¾ã™)ã€‚

ã¨ã„ã†ã“ã¨ã§ã€éžåŒæœŸã§ã‚ã‚‹ã‹ã©ã†ã‹ã®èªè­˜æ–¹æ³•ã¯ã‚·ãƒ³ãƒ—ãƒ«ã«ä»¥ä¸‹ã®ã‚‚ã®ã¨ãªã‚Šã¾ã™ã€‚

> **ãƒ–ãƒ­ãƒƒã‚­ãƒ³ã‚°ã™ã‚‹ãªã‚‰åŒæœŸã€‚åŒæœŸã§ãªã„ãªã‚‰éžåŒæœŸã€‚å®Ÿè¡Œã‚¿ã‚¤ãƒŸãƒ³ã‚°ãŒã‚³ãƒ¼ãƒ‰é…ç½®ã¨ã‚ºãƒ¬ã¦ã—ã¾ã†ã‚‚ã®ã‚‚éžåŒæœŸã¨ã¿ãªã™ã€‚**

ã¨ã‚Šã‚ãˆãšã¯ã“ã®è€ƒãˆæ–¹ã«ä¹—ã‚‹ã“ã¨ã§ç‰©äº‹ã‚’ã‚·ãƒ³ãƒ—ãƒ«ã«ã—ã¦ç†è§£ã§ãã¾ã™ã€‚
